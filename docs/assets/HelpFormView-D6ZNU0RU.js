import{c as U,r as l,j as e,S as z,n as Me}from"./index-DBXkWCLS.js";import{u as ze,c as Ee,l as Le,a as Ie,e as Te,M as De,T as Oe,L as me}from"./TileLayer-D_qsWxCk.js";import{B as j}from"./Button-BRkmOIV9.js";import{I as oe,T as ie}from"./Input-Cb4un1zL.js";import{t as c}from"./translations-DeR-J9wz.js";import{C as Re}from"./clock-MGE4jsla.js";import{C as Be}from"./circle-check-big-CPIgPDBj.js";import{R as P}from"./refresh-cw-Gk3wvlGr.js";import{M as Pe}from"./message-square-Dj-f6TYY.js";import{A as Ue}from"./arrow-left-cQpRBPyt.js";import{X as Fe}from"./x-Sldg548w.js";import{O as He}from"./octagon-alert-QRDSCsqC.js";import{G as ce}from"./globe-DOwHdAZ6.js";import{N as qe}from"./navigation-BjL0HAVy.js";import{M as Q}from"./map-pin-AV7l3b0a.js";import{T as Je}from"./triangle-alert-mL0WtJLm.js";import{D as de}from"./droplets-CyeAfODq.js";import{S as Ke}from"./shield-LRQvnVVA.js";import{Z as Ye}from"./zap-B266P70k.js";import"./index-Cu0yPAYF.js";/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=[["path",{d:"M10 10H6",key:"1bsnug"}],["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.28a1 1 0 0 0-.684-.948l-1.923-.641a1 1 0 0 1-.578-.502l-1.539-3.076A1 1 0 0 0 16.382 8H14",key:"lrkjwd"}],["path",{d:"M8 8v4",key:"1fwk8c"}],["path",{d:"M9 18h6",key:"x1upvd"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]],We=U("ambulance",Ve);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=[["path",{d:"M12 3q1 4 4 6.5t3 5.5a1 1 0 0 1-14 0 5 5 0 0 1 1-3 1 1 0 0 0 5 0c0-2-1.5-3-1.5-5q0-2 2.5-4",key:"1slcih"}]],Ge=U("flame",Xe);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=[["line",{x1:"2",x2:"5",y1:"12",y2:"12",key:"bvdh0s"}],["line",{x1:"19",x2:"22",y1:"12",y2:"12",key:"1tbv5k"}],["line",{x1:"12",x2:"12",y1:"2",y2:"5",key:"11lu5j"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}],["circle",{cx:"12",cy:"12",r:"7",key:"fim9np"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Ze=U("locate-fixed",Qe);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],_e=U("wifi",$e);function et(){return ze().map}function tt(u){const r=et();return l.useEffect(function(){return r.on(u),function(){r.off(u)}},[r,u]),r}const st=Ee(function({position:r,...o},a){const v=new Le.Marker(r,o);return Ie(v,Te(a,{overlayContainer:v}))},function(r,o,a){o.position!==a.position&&r.setLatLng(o.position),o.icon!=null&&o.icon!==a.icon&&r.setIcon(o.icon),o.zIndexOffset!=null&&o.zIndexOffset!==a.zIndexOffset&&r.setZIndexOffset(o.zIndexOffset),o.opacity!=null&&o.opacity!==a.opacity&&r.setOpacity(o.opacity),r.dragging!=null&&o.draggable!==a.draggable&&(o.draggable===!0?r.dragging.enable():r.dragging.disable())}),at="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAABSCAMAAAAhFXfZAAAC91BMVEVMaXEzeak2f7I4g7g3g7cua5gzeKg8hJo3grY4g7c3grU0gLI2frE0daAubJc2gbQwd6QzeKk2gLMtd5sxdKIua5g1frA2f7IydaM0e6w2fq41fK01eqo3grgubJgta5cxdKI1f7AydaQydaMxc6EubJgvbJkwcZ4ubZkwcJwubZgubJcydqUydKIxapgubJctbJcubZcubJcvbJYubJcvbZkubJctbJctbZcubJg2f7AubJcrbZcubJcubJcua5g3grY0fq8ubJcubJdEkdEwhsw6i88vhswuhcsuhMtBjMgthMsrg8srgss6is8qgcs8i9A9iMYtg8spgcoogMo7hcMngMonf8olfso4gr8kfck5iM8jfMk4iM8he8k1fro7itAgesk2hs8eecgzfLcofssdeMg0hc4cd8g2hcsxeLQbdsgZdcgxeLImfcszhM0vda4xgckzhM4xg84wf8Yxgs4udKsvfcQucqhUndROmdM1fK0wcZ8vb5w0eqpQm9MzeKhXoNVcpdYydKNWn9VZotVKltJFjsIwcJ1Rms9OlslLmtH///8+kc9epdYzd6dbo9VHkMM2f7FHmNBClM8ydqVcpNY9hro3gLM9hLczealQmcw3fa46f7A8gLMxc6I3eagyc6FIldJMl9JSnNRSntNNl9JPnNJFi75UnM9ZodVKksg8kM45jc09e6ZHltFBk883gbRBh7pDk9EwcaBzn784g7dKkcY2i81Om9M7j85Llc81is09g7Q4grY/j9A0eqxKmdFFltBEjcXf6fFImdBCiLxJl9FGlNFBi78yiMxVndEvbpo6js74+vx+psPP3+o/ks5HkcpGmNCjwdZCkNDM3ehYoNJEls+lxNkxh8xHks0+jdC1zd5Lg6r+/v/H2ufz9/o3jM3t8/edvdM/k89Th61OiLBSjbZklbaTt9BfptdjmL1AicBHj8hGk9FAgK1dkLNTjLRekrdClc/k7fM0icy0y9tgp9c4jc2NtM9Dlc8zicxeXZn3AAAAQ3RSTlMAHDdTb4yPA+LtnEQmC4L2EmHqB7XA0d0sr478x4/Yd5i1zOfyPkf1sLVq4Nh3FvjxopQ2/STNuFzUwFIwxKaejILpIBEV9wAABhVJREFUeF6s1NdyFEcY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",nt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAFgUlEQVR4Aa1XA5BjWRTN2oW17d3YaZtr2962HUzbDNpjszW24mRt28p47v7zq/bXZtrp/lWnXr337j3nPCe85NcypgSFdugCpW5YoDAMRaIMqRi6aKq5E3YqDQO3qAwjVWrD8Ncq/RBpykd8oZUb/kaJutow8r1aP9II0WmLKLIsJyv1w/kqw9Ch2MYdB++12Onxee/QMwvf4/Dk/Lfp/i4nxTXtOoQ4pW5Aj7wpici1A9erdAN2OH64x8OSP9j3Ft3b7aWkTg/Fm91siTra0f9on5sQr9INejH6CUUUpavjFNq1B+Oadhxmnfa8RfEmN8VNAsQhPqF55xHkMzz3jSmChWU6f7/XZKNH+9+hBLOHYozuKQPxyMPUKkrX/K0uWnfFaJGS1QPRtZsOPtr3NsW0uyh6NNCOkU3Yz+bXbT3I8G3xE5EXLXtCXbbqwCO9zPQYPRTZ5vIDXD7U+w7rFDEoUUf7ibHIR4y6bLVPXrz8JVZEql13trxwue/uDivd3fkWRbS6/IA2bID4uk0UpF1N8qLlbBlXs4Ee7HLTfV1j54APvODnSfOWBqtKVvjgLKzF5YdEk5ewRkGlK0i33Eofffc7HT56jD7/6U+qH3Cx7SBLNntH5YIPvODnyfIXZYRVDPqgHtLs5ABHD3YzLuespb7t79FY34DjMwrVrcTuwlT55YMPvOBnRrJ4VXTdNnYug5ucHLBjEpt30701A3Ts+HEa73u6dT3FNWwflY86eMHPk+Yu+i6pzUpRrW7SNDg5JHR4KapmM5Wv2E8Tfcb1HoqqHMHU+uWDD7zg54mz5/2BSnizi9T1Dg4QQXLToGNCkb6tb1NU+QAlGr1++eADrzhn/u8Q2YZhQVlZ5+CAOtqfbhmaUCS1ezNFVm2imDbPmPng5wmz+gwh+oHDce0eUtQ6OGDIyR0uUhUsoO3vfDmmgOezH0mZN59x7MBi++WDL1g/eEiU3avlidO671bkLfwbw5XV2P8Pzo0ydy4t2/0eu33xYSOMOD8hTf4CrBtGMSoXfPLchX+J0ruSePw3LZeK0juPJbYzrhkH0io7B3k164hiGvawhOKMLkrQLyVpZg8rHFW7E2uHOL888IBPlNZ1FPzstSJM694fWr6RwpvcJK60+0HCILTBzZLFNdtAzJaohze60T8qBzyh5ZuOg5e7uwQppofEmf2++DYvmySqGBuKaicF1blQjhuHdvCIMvp8whTTfZzI7RldpwtSzL+F1+wkdZ2TBOW2gIF88PBTzD/gpeREAMEbxnJcaJHNHrpzji0gQCS6hdkEeYt9DF/2qPcEC8RM28Hwmr3sdNyht00byAut2k3gufWNtgtOEOFGUwcXWNDbdNbpgBGxEvKkOQsxivJx33iow0Vw5S6SVTrpVq11ysA2Rp7gTfPfktc6zhtXBBC+adRLshf6sG2RfHPZ5EAc4sVZ83yCN00Fk/4kggu40ZTvIEm5g24qtU4KjBrx/BTTH8ifVASAG7gKrnWxJDcU7x8X6Ecczhm3o6YicvsLXWfh3Ch1W0k8x0nXF+0fFxgt4phz8QvypiwCCFKMqXCnqXExjq10beH+UUA7+nG6mdG/Pu0f3LgFcGrl2s0kNNjpmoJ9o4B29CMO8dMT4Q5ox8uitF6fqsrJOr8qnwNbRzv6hSnG5wP+64C7h9lp30hKNtKdWjtdkbuPA19nJ7Tz3zR/ibgARbhb4AlhavcBebmTHcFl2fvYEnW0ox9xMxKBS8btJ+KiEbq9zA4RthQXDhPa0T9TEe69gWupwc6uBUphquXgf+/FrIjweHQS4/pduMe5ERUMHUd9xv8ZR98CxkS4F2n3EUrUZ10EYNw7BWm9x1GiPssi3GgiGRDKWRYZfXlON+dfNbM+GgIwYdwAAAAASUVORK5CYII=",lt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAQAAAACach9AAACMUlEQVR4Ae3ShY7jQBAE0Aoz/f9/HTMzhg1zrdKUrJbdx+Kd2nD8VNudfsL/Th///dyQN2TH6f3y/BGpC379rV+S+qqetBOxImNQXL8JCAr2V4iMQXHGNJxeCfZXhSRBcQMfvkOWUdtfzlLgAENmZDcmo2TVmt8OSM2eXxBp3DjHSMFutqS7SbmemzBiR+xpKCNUIRkdkkYxhAkyGoBvyQFEJEefwSmmvBfJuJ6aKqKWnAkvGZOaZXTUgFqYULWNSHUckZuR1HIIimUExutRxwzOLROIG4vKmCKQt364mIlhSyzAf1m9lHZHJZrlAOMMztRRiKimp/rpdJDc9Awry5xTZCte7FHtuS8wJgeYGrex28xNTd086Dik7vUMscQOa8y4DoGtCCSkAKlNwpgNtphjrC6MIHUkR6YWxxs6Sc5xqn222mmCRFzIt8lEdKx+ikCtg91qS2WpwVfBelJCiQJwvzixfI9cxZQWgiSJelKnwBElKYtDOb2MFbhmUigbReQBV0Cg4+qMXSxXSyGUn4UbF8l+7qdSGnTC0XLCmahIgUHLhLOhpVCtw4CzYXvLQWQbJNmxoCsOKAxSgBJno75avolkRw8iIAFcsdc02e9iyCd8tHwmeSSoKTowIgvscSGZUOA7PuCN5b2BX9mQM7S0wYhMNU74zgsPBj3HU7wguAfnxxjFQGBE6pwN+GjME9zHY7zGp8wVxMShYX9NXvEWD3HbwJf4giO4CFIQxXScH1/TM+04kkBiAAAAAElFTkSuQmCC",rt=({current:u,total:r})=>{const o=Math.min(100,Math.max(0,u/r*100));return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex justify-between text-xs font-semibold uppercase text-slate-500 mb-2",children:[e.jsxs("span",{children:["Step ",u," of ",r]}),e.jsxs("span",{children:[Math.round(o),"%"]})]}),e.jsx("div",{className:"h-2 w-full bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-brand-500 transition-all duration-500 ease-out rounded-full",style:{width:"".concat(o,"%")}})})]})};delete me.Icon.Default.prototype._getIconUrl;me.Icon.Default.mergeOptions({iconRetinaUrl:at,iconUrl:nt,shadowUrl:lt});const ot=({marker:u,onPick:r})=>(tt({click:o=>{r({lat:o.latlng.lat,lng:o.latlng.lng})}}),u?e.jsx(st,{position:[u.lat,u.lng]}):null),xe={isSafe:null,location:"",emergencyType:"",isInjured:null,injuryDetails:"",situationDescription:"",canEvacuate:null,hazardsPresent:null,hazardDetails:"",peopleCount:1,petsPresent:null,hasWater:null,hasFood:null,hasMeds:null,hasPower:null,hasPhone:null,needsTransport:null,vulnerableGroups:[],medicalConditions:"",damageType:"",consentToShare:!0},zt=({setView:u})=>{const[r,o]=l.useState(1),[a,v]=l.useState(xe),[Z,F]=l.useState(!1),[ue,$]=l.useState(!1),[C,I]=l.useState("idle"),[H,fe]=l.useState(""),[q,_]=l.useState(null),[J,b]=l.useState(null),[ee,T]=l.useState(!1),[g,h]=l.useState(!0),[w,D]=l.useState(null),[be,E]=l.useState(""),[M,p]=l.useState(!1),[k,te]=l.useState(!navigator.onLine),K=l.useRef(!1),Y=l.useRef(null),V=l.useRef(0),[O,R]=l.useState(!1),[he,L]=l.useState(null),[W,se]=l.useState(!1),ge=l.useRef(null),[ae,it]=l.useState(!1);l.useEffect(()=>{o(1),v(xe),F(!1),$(!1),I("idle"),_(null),b(null),T(!1),h(!0),D(null),E(""),p(!1),K.current=!1,Y.current=null,V.current=0},[]),l.useEffect(()=>{var x;const t=z.getProfile();fe(t.emergencyContactPhone||""),(x=navigator.permissions)==null||x.query({name:"geolocation"}).then(N=>{N.state==="granted"&&h(!0)});const s=()=>te(!1),n=()=>te(!0);return window.addEventListener("online",s),window.addEventListener("offline",n),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",n)}},[]),l.useEffect(()=>{if(K.current)return;const t=z.getLastKnownLocation();t&&(K.current=!0,v(s=>s.location?s:{...s,location:t.location}),E(new Date(t.timestamp).toLocaleTimeString()),h(!1),p(!1))},[]);const B=t=>{const s=t.match(/^\s*(-?\d+(?:\.\d+)?)\s*,\s*(-?\d+(?:\.\d+)?)\s*$/);if(!s)return null;const n=Number(s[1]),x=Number(s[2]);return!Number.isFinite(n)||!Number.isFinite(x)||Math.abs(n)>90||Math.abs(x)>180?null:{lat:n,lng:x}},ne=async()=>{const t=String(a.location||"").trim();if(!t)return;const s=B(t);if(s){h(!1),p(!1),L(s),R(!0),b(null);return}se(!0);try{const n=[async()=>{const d=await fetch("https://nominatim.openstreetmap.org/search?format=jsonv2&addressdetails=1&q=".concat(encodeURIComponent(t),"&limit=1"),{headers:{Accept:"application/json"}});if(!d.ok)throw new Error("nominatim_failed");const i=await d.json(),f=Array.isArray(i)?i[0]:null;return f?{lat:Number(f.lat),lng:Number(f.lon)}:null},async()=>{var y;const d=await fetch("https://photon.komoot.io/api/?q=".concat(encodeURIComponent(t),"&limit=1"),{headers:{Accept:"application/json"}});if(!d.ok)throw new Error("photon_failed");const i=await d.json(),f=Array.isArray(i==null?void 0:i.features)?i.features[0]:null,S=Array.isArray((y=f==null?void 0:f.geometry)==null?void 0:y.coordinates)?f.geometry.coordinates:null;return S&&S.length===2?{lat:Number(S[1]),lng:Number(S[0])}:null},async()=>{const d=await fetch("https://geocode.maps.co/search?q=".concat(encodeURIComponent(t),"&limit=1"),{headers:{Accept:"application/json"}});if(!d.ok)throw new Error("mapsco_failed");const i=await d.json(),f=Array.isArray(i)?i[0]:null;return f?{lat:Number(f.lat),lng:Number(f.lon)}:null}];let x=NaN,N=NaN;for(const d of n)try{const i=await d();if(i&&Number.isFinite(i.lat)&&Number.isFinite(i.lng)){x=i.lat,N=i.lng;break}}catch(i){}if(!Number.isFinite(x)||!Number.isFinite(N)){b("Address not found. Try a more specific address.");return}const A={lat:x,lng:N};h(!1),p(!1),L(A),R(!0),b(null),m({location:"".concat(x.toFixed(6),", ").concat(N.toFixed(6))}),E(new Date().toLocaleTimeString())}catch(n){b("Map search failed. Please try again.")}finally{se(!1)}},pe=()=>{const t="tel:911";try{window.location.href=t}catch(s){}try{window.open(t,"_self")}catch(s){alert("Please dial 911 immediately from the nearest available phone.")}},le=l.useMemo(()=>{const t=B(a.location||"");if(t)return t;const s=z.getLastKnownLocation();return(s!=null&&s.location?B(s.location):null)||{lat:37.7749,lng:-122.4194}},[a.location]);l.useEffect(()=>{if(!O)return;const t=B(a.location||"");t&&L(t)},[a.location,O]);const X=async()=>{p(!1),b("Location services unavailable. Please enter address manually.")};l.useEffect(()=>{let t;const s=()=>{b(null),T(!1),p(!1);const n=A=>{const{latitude:d,longitude:i,accuracy:f}=A.coords,S=Date.now(),y=Number.isFinite(f)?Math.round(f):null,G=Y.current,Ae=y!==null&&(G===null||y<=G+5),Se=S-V.current>3e4;if(Ae||Se){Y.current=y!=null?y:G,V.current=S;const re="".concat(d.toFixed(6),", ").concat(i.toFixed(6));v(Ce=>({...Ce,location:re})),D(y),E(new Date().toLocaleTimeString()),b(null),T(!1),p(!1),q&&z.updateRequestLocation(q,re)}},x=A=>{let d="Location unavailable",i=!1;switch(A.code){case 1:d="GPS denied. Please enter address manually.",T(!0),X(),i=!0;break;case 2:d="Signal weak. Please enter address manually.",X(),i=!0;break;case 3:d="GPS Timeout. Retrying...";break;default:d="GPS Error"}!M&&!i&&b(d),D(null),i&&h(!1)},N={enableHighAccuracy:!0,maximumAge:0,timeout:2e4};t=navigator.geolocation.watchPosition(n,x,N)};return g&&"geolocation"in navigator?s():g&&!("geolocation"in navigator)&&(b("GPS not supported. Using Network Location."),X(),h(!1)),()=>{t&&navigator.geolocation.clearWatch(t)}},[g,q]),l.useEffect(()=>()=>{var t;if(ae){const s=(t=ge.current)==null?void 0:t.srcObject;s==null||s.getTracks().forEach(n=>n.stop())}},[ae]);const m=t=>{v(s=>({...s,...t}))},Ne=()=>o(t=>Math.min(t+1,5)),je=()=>o(t=>Math.max(t-1,1)),ye=async()=>{F(!0);const t=z.getLastKnownLocation(),s=a.location||(t==null?void 0:t.location)||"";s&&!a.location&&v(n=>({...n,location:s}));try{const n=await z.submitRequest({...a,location:s});_(n.id),a.emergencyContactPhone&&(I("sending"),Me({contactName:a.emergencyContactName,contactPhone:a.emergencyContactPhone,userName:a.fullName,emergencyType:a.emergencyType,description:a.situationDescription,location:s,requestId:n.id}).then(()=>I("sent")).catch(x=>{console.warn("Emergency contact notify failed",x),I("failed")})),$(!0)}catch(n){console.error(n),alert("Failed to submit request. Saved locally; will retry when online.")}finally{F(!1)}},ve=()=>{const t=H.replace(/[^\d+]/g,""),s=a.isSafe===null?"Unknown Status":a.isSafe?"Safe":"IN DANGER",n=a.emergencyType||"Emergency",x=a.location||"GPS Unavailable",N=a.situationDescription?"- ".concat(a.situationDescription):"",A="I used the AERA app to request emergency assistance.\n\nType: ".concat(n," ").concat(N,"\nLocation: ").concat(x,"\nStatus: ").concat(s),d=navigator.userAgent.match(/iPhone|iPad|iPod/i)?"&":"?";window.location.href="sms:".concat(t).concat(d,"body=").concat(encodeURIComponent(A))},we=t=>{let s=0,n="bg-slate-300";return t<=15?(s=4,n="bg-green-500"):t<=30?(s=3,n="bg-green-500"):t<=60?(s=2,n="bg-yellow-500"):(s=1,n="bg-red-500"),e.jsxs("div",{className:"flex items-end gap-1 h-3",role:"img","aria-label":"GPS Signal Strength: ".concat(s," of 4 bars"),children:[e.jsx("div",{className:"w-1 rounded-sm ".concat(s>=1?n:"bg-slate-200"," h-1.5")}),e.jsx("div",{className:"w-1 rounded-sm ".concat(s>=2?n:"bg-slate-200"," h-2")}),e.jsx("div",{className:"w-1 rounded-sm ".concat(s>=3?n:"bg-slate-200"," h-2.5")}),e.jsx("div",{className:"w-1 rounded-sm ".concat(s>=4?n:"bg-slate-200"," h-3")})]})},ke=t=>t?t<=15?"Excellent Signal":t<=30?"Good Signal":t<=60?"Fair Signal":"Weak Signal":"";return ue?e.jsxs("div",{className:"min-h-screen bg-white flex flex-col items-center justify-center p-8 text-center animate-fade-in pb-safe",children:[e.jsxs("div",{className:"w-24 h-24 rounded-full flex items-center justify-center mb-6 relative ".concat(k?"bg-amber-100":"bg-green-100"),children:[e.jsx("div",{className:"absolute inset-0 rounded-full border-4 ".concat(k?"border-amber-500/30":"border-green-500/30"," animate-[ping_2s_ease-out_infinite]")}),k?e.jsx(Re,{size:48,className:"text-amber-600 relative z-10"}):e.jsx(Be,{size:48,className:"text-green-700 relative z-10"})]}),e.jsx("h2",{className:"text-3xl font-extrabold text-slate-900 mb-2",children:k?"Saved to Outbox":c("help.success_title")}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 text-blue-900 px-4 py-3 rounded-xl text-sm font-bold mb-8 flex flex-col items-center gap-2 max-w-xs mx-auto animate-pulse",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{size:18,className:"animate-spin"}),"Live Location Sharing Active"]}),e.jsx("span",{className:"font-mono text-xs bg-white/60 px-2 py-1 rounded text-blue-800 border border-blue-100",children:a.location||"Locating..."})]}),k&&e.jsx("p",{className:"text-slate-800 font-medium mb-8 max-w-sm",children:"Your report has been saved to your device. It will automatically upload to responders as soon as you connect to the internet."}),H&&!k&&C!=="idle"&&e.jsxs("div",{className:"text-sm font-bold px-4 py-3 rounded-xl border max-w-xs mx-auto ".concat(C==="sent"?"bg-green-50 text-green-800 border-green-200":C==="failed"?"bg-amber-50 text-amber-800 border-amber-200":"bg-slate-50 text-slate-700 border-slate-200"),children:[C==="sent"&&"Emergency contact notified via SMS.",C==="failed"&&"Unable to notify emergency contact. You can continue.",C==="sending"&&"Notifying emergency contact..."]}),e.jsxs("div",{className:"w-full space-y-4",children:[H&&e.jsxs(j,{fullWidth:!0,onClick:ve,className:"bg-slate-900 hover:bg-slate-800 text-white",children:[e.jsx(Pe,{className:"mr-2",size:20}),c("help.text_contact")]}),e.jsx(j,{fullWidth:!0,variant:"outline",onClick:()=>u("DASHBOARD"),className:"border-slate-300 text-slate-900 font-bold",children:c("help.return_dash")})]})]}):e.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col pb-safe",children:[e.jsxs("div",{className:"bg-white border-b border-slate-200 p-4 sticky top-0 z-20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:()=>r===1?u("DASHBOARD"):je(),className:"p-2 -ml-2 text-slate-600 hover:text-slate-900",children:e.jsx(Ue,{size:24})}),e.jsx("h1",{className:"font-bold text-xl text-slate-900",children:c("help.title")}),e.jsx("button",{onClick:()=>u("DASHBOARD"),className:"p-2 -mr-2 text-slate-400 hover:text-red-600 transition-colors",title:c("btn.cancel"),children:e.jsx(Fe,{size:24})})]}),e.jsx(rt,{current:r,total:5})]}),e.jsxs("div",{className:"flex-1 p-6 space-y-8 animate-fade-in overflow-y-auto pb-32",children:[r===1&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-xl font-bold text-slate-900",children:c("help.safe_q")}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("button",{onClick:()=>m({isSafe:!0}),className:"p-4 rounded-xl border-2 font-bold transition-all ".concat(a.isSafe===!0?"border-brand-600 bg-brand-50 text-brand-800":"border-slate-300 bg-white text-slate-700"),children:c("help.yes_safe")}),e.jsx("button",{onClick:()=>m({isSafe:!1}),className:"p-4 rounded-xl border-2 font-bold transition-all ".concat(a.isSafe===!1?"border-red-600 bg-red-50 text-red-800":"border-slate-300 bg-white text-slate-700"),children:c("help.no_danger")})]})]}),a.isSafe===!1&&e.jsxs("div",{className:"bg-red-600 text-white p-6 rounded-xl shadow-xl animate-pulse space-y-4 border-4 border-red-800",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(He,{size:48,className:"text-white"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-extrabold uppercase tracking-wider",children:"Immediate Danger"}),e.jsx("p",{className:"font-medium text-red-100",children:"Do not rely solely on this app."})]})]}),e.jsx(j,{fullWidth:!0,size:"xl",className:"bg-white text-red-700 hover:bg-red-50 font-black text-2xl shadow-lg",onClick:pe,children:"CALL 911 NOW"}),e.jsx("p",{className:"text-center text-sm font-bold opacity-80",children:"If you cannot call, continue filling this form."})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:c("help.location")}),g&&e.jsxs("span",{className:"flex items-center gap-1 text-[10px] font-bold text-green-600 bg-green-50 px-2 py-0.5 rounded border border-green-100 animate-pulse",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"})," LIVE TRACKING"]}),M&&e.jsxs("span",{className:"flex items-center gap-1 text-[10px] font-bold text-amber-600 bg-amber-50 px-2 py-0.5 rounded border border-amber-100",children:[e.jsx(ce,{size:10})," APPROX (IP)"]})]}),e.jsx(oe,{placeholder:g?c("help.detecting"):c("help.manual"),value:a.location||"",onChange:t=>{h(!1),p(!1),L(null),m({location:t.target.value})},onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),ne())},className:"bg-white font-mono text-sm border-slate-300 text-slate-900 font-semibold pr-24 ".concat(g?"border-brand-500 ring-1 ring-brand-500":M?"border-amber-500 ring-1 ring-amber-500":ee?"border-red-500":""),error:!g&&!M&&!a.location&&J&&!ee?J:void 0}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs("button",{type:"button",onClick:()=>{ne()},disabled:W||!String(a.location||"").trim(),className:"inline-flex items-center gap-2 text-xs font-bold text-brand-700 bg-brand-50 hover:bg-brand-100 px-3 py-1.5 rounded-full",children:[W?e.jsx(P,{size:12,className:"animate-spin"}):e.jsx(qe,{size:12})," ",W?"Searchingâ€¦":"Search Map"]}),e.jsxs("button",{type:"button",onClick:()=>{R(t=>!t),h(!1),p(!1)},className:"inline-flex items-center gap-2 text-xs font-bold text-slate-700 bg-slate-100 hover:bg-slate-200 px-3 py-1.5 rounded-full",children:[e.jsx(Q,{size:12})," ",O?"Hide Map":"Drop a Pin"]}),e.jsxs("button",{type:"button",onClick:()=>{h(!0),R(!1)},className:"inline-flex items-center gap-2 text-xs font-bold text-brand-700 bg-brand-50 hover:bg-brand-100 px-3 py-1.5 rounded-full",children:[e.jsx(Ze,{size:12})," Use GPS"]})]})]}),O&&e.jsxs("div",{className:"mt-3 rounded-xl overflow-hidden border border-slate-200 shadow-sm",children:[e.jsxs("div",{className:"bg-slate-50 px-3 py-2 text-xs font-semibold text-slate-600 flex items-center gap-2",children:[e.jsx(Q,{size:12})," Tap the map to set your exact location"]}),e.jsx("div",{className:"h-64 w-full",children:e.jsxs(De,{center:[le.lat,le.lng],zoom:14,scrollWheelZoom:!0,className:"h-full w-full",children:[e.jsx(Oe,{attribution:"Â© OpenStreetMap contributors",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(ot,{marker:he,onPick:t=>{h(!1),p(!1),L(t);const s="".concat(t.lat.toFixed(6),", ").concat(t.lng.toFixed(6));m({location:s}),D(null),E(new Date().toLocaleTimeString()),b(null)}})]})})]}),g&&w!==null&&e.jsxs("div",{className:"bg-slate-100 rounded-lg p-3 border border-slate-200 -mt-2 shadow-inner",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[we(w),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-bold text-slate-700 uppercase tracking-wider leading-none mb-0.5",children:ke(w)}),e.jsxs("p",{className:"text-xs text-slate-500 font-mono leading-none",children:["Â± ",w,"m precision"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-1 justify-end text-[10px] text-slate-400 font-bold uppercase mb-0.5",children:[e.jsx(_e,{size:10})," Last Update"]}),e.jsx("p",{className:"text-xs text-slate-600 font-mono font-bold leading-none",children:be})]})]}),w>50&&e.jsxs("div",{className:"flex items-center gap-1.5 mt-2 bg-amber-50 p-1.5 rounded border border-amber-100",children:[e.jsx(Je,{size:12,className:"text-amber-600"}),e.jsx("p",{className:"text-[10px] text-amber-700 font-bold",children:"Signal weak. Move outdoors or near windows for better precision."})]})]}),g&&!J&&w===null&&!M&&e.jsxs("p",{className:"text-xs text-brand-600 font-medium -mt-2 animate-pulse flex items-center gap-1",children:[e.jsx(P,{size:12,className:"animate-spin"})," Acquiring satellite lock..."]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-xl font-bold text-slate-900",children:c("help.what_need")}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:[{id:"Medical",icon:e.jsx(We,{size:24}),color:"red"},{id:"Fire",icon:e.jsx(Ge,{size:24}),color:"orange"},{id:"Flood",icon:e.jsx(de,{size:24}),color:"blue"},{id:"Police",icon:e.jsx(Ke,{size:24}),color:"slate"}].map(t=>e.jsxs("button",{onClick:()=>m({emergencyType:t.id}),className:"p-4 rounded-xl border flex flex-col items-center gap-2 transition-all ".concat(a.emergencyType===t.id?"border-".concat(t.color,"-600 bg-").concat(t.color,"-50 text-").concat(t.color,"-900 ring-2 ring-").concat(t.color,"-600 ring-offset-1"):"border-slate-300 bg-white text-slate-700 hover:border-slate-400"),children:[t.icon,e.jsx("span",{className:"font-bold text-lg",children:t.id})]},t.id))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-xl font-bold text-slate-900",children:c("help.injured_q")}),e.jsx("div",{className:"flex gap-4",children:["Yes","No"].map(t=>{const s=t==="Yes";return e.jsx(j,{type:"button",variant:a.isInjured===s?"primary":"outline",onClick:()=>m({isInjured:s}),className:"flex-1 font-bold ".concat(a.isInjured!==s?"border-slate-300 text-slate-700":""),children:t==="Yes"?"Yes":"No"},t)})})]})]}),r===2&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(ie,{label:c("help.situation"),placeholder:"E.g. Water is rising rapidly, trapped in attic...",value:a.situationDescription,onChange:t=>m({situationDescription:t.target.value}),className:"border-slate-300 text-slate-900"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-lg font-bold text-slate-900",children:c("help.evac_q")}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(j,{variant:a.canEvacuate===!0?"primary":"outline",onClick:()=>m({canEvacuate:!0}),className:"flex-1 font-bold",children:"Yes"}),e.jsx(j,{variant:a.canEvacuate===!1?"danger":"outline",onClick:()=>m({canEvacuate:!1}),className:"flex-1 font-bold",children:"No"})]})]}),e.jsx(oe,{type:"number",label:c("help.people_count"),min:1,value:a.peopleCount,onChange:t=>m({peopleCount:parseInt(t.target.value)}),className:"border-slate-300 text-slate-900 font-bold"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-lg font-bold text-slate-900",children:c("help.pets_q")}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(j,{variant:a.petsPresent===!0?"primary":"outline",onClick:()=>m({petsPresent:!0}),className:"flex-1 font-bold",children:"Yes"}),e.jsx(j,{variant:a.petsPresent===!1?"secondary":"outline",onClick:()=>m({petsPresent:!1}),className:"flex-1 font-bold",children:"No"})]})]})]}),r===3&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-slate-900",children:c("help.resources_title")}),e.jsx("p",{className:"text-slate-600 font-medium text-base",children:c("help.resources_desc")}),[{key:"hasWater",label:"Clean Water",icon:e.jsx(de,{size:18})},{key:"hasFood",label:"Food",icon:e.jsx("span",{className:"text-lg",children:"ðŸ¥«"})},{key:"hasMeds",label:"Medications",icon:e.jsx("span",{className:"text-lg",children:"ðŸ’Š"})},{key:"hasPower",label:"Electricity",icon:e.jsx(Ye,{size:18})},{key:"hasPhone",label:"Phone Service",icon:e.jsx("span",{className:"text-lg",children:"ðŸ“¶"})}].map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white rounded-xl border border-slate-300 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-slate-100 rounded-lg text-slate-700",children:t.icon}),e.jsx("span",{className:"font-bold text-slate-900",children:t.label})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>m({[t.key]:!0}),className:"px-4 py-2 rounded-lg text-sm font-bold transition-colors ".concat(a[t.key]===!0?"bg-green-100 text-green-800 border border-green-200":"bg-slate-100 text-slate-500 border border-slate-200"),children:"Yes"}),e.jsx("button",{onClick:()=>m({[t.key]:!1}),className:"px-4 py-2 rounded-lg text-sm font-bold transition-colors ".concat(a[t.key]===!1?"bg-red-100 text-red-800 border border-red-200":"bg-slate-100 text-slate-500 border border-slate-200"),children:"No"})]})]},t.key))]}),r===4&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-lg font-bold text-slate-900",children:c("help.vuln_title")}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:["Elderly","Infants","Disabled","Pregnant"].map(t=>e.jsx("button",{onClick:()=>{const s=a.vulnerableGroups,n=s.includes(t)?s.filter(x=>x!==t):[...s,t];m({vulnerableGroups:n})},className:"p-3 rounded-lg border text-sm font-bold transition-all ".concat(a.vulnerableGroups.includes(t)?"bg-brand-50 border-brand-500 text-brand-800":"bg-white border-slate-300 text-slate-600"),children:t},t))})]}),e.jsx(ie,{label:c("help.medical_cond"),placeholder:"Diabetes, requires dialysis, wheelchair user...",value:a.medicalConditions,onChange:t=>m({medicalConditions:t.target.value}),className:"border-slate-300"})]}),r===5&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-slate-900",children:c("help.review")}),e.jsxs("div",{className:"bg-white rounded-xl border border-slate-300 p-4 space-y-4 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between border-b border-slate-100 pb-2",children:[e.jsx("span",{className:"text-slate-600 font-medium",children:"Emergency Type"}),e.jsx("span",{className:"font-bold text-slate-900",children:a.emergencyType||"Not specified"})]}),e.jsxs("div",{className:"flex justify-between border-b border-slate-100 pb-2",children:[e.jsx("span",{className:"text-slate-600 font-medium",children:"People Count"}),e.jsx("span",{className:"font-bold text-slate-900",children:a.peopleCount})]}),e.jsxs("div",{className:"flex justify-between border-b border-slate-100 pb-2",children:[e.jsx("span",{className:"text-slate-600 font-medium",children:"Injuries"}),e.jsx("span",{className:"font-bold text-slate-900",children:a.isInjured?"Yes":"No"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-slate-600 font-medium",children:"Location"}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"block font-bold truncate max-w-[150px] font-mono text-xs text-slate-900",children:a.location||"Pending..."}),g?e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs("span",{className:"text-[10px] text-green-700 font-bold flex items-center justify-end gap-1",children:[e.jsx(P,{size:10,className:"animate-spin"})," Live"]}),w&&e.jsxs("span",{className:"text-[10px] text-slate-500 font-mono",children:["Â±",w,"m"]})]}):M?e.jsxs("span",{className:"text-[10px] text-amber-600 font-bold flex items-center justify-end gap-1",children:[e.jsx(ce,{size:10})," Network (Approx)"]}):e.jsxs("span",{className:"text-[10px] text-slate-500 font-bold flex items-center justify-end gap-1",children:[e.jsx(Q,{size:10})," Manual/Frozen"]})]})]})]})]})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-white border-t border-slate-200 z-30",children:e.jsx("div",{className:"max-w-md mx-auto flex gap-4",children:r<5?e.jsx(j,{fullWidth:!0,onClick:Ne,size:"lg",className:"font-bold text-lg",children:c("btn.next")}):e.jsx(j,{fullWidth:!0,size:"lg",disabled:Z,onClick:ye,className:"bg-red-600 hover:bg-red-700 font-bold text-lg shadow-lg shadow-red-200",children:Z?k?"Saving...":"Sending...":k?"Save for Sync":c("help.submit_btn")})})})]})};export{zt as HelpFormView};
