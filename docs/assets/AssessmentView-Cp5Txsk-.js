import{c as f,r as a,S as de,j as e,B as xe,C as Z,H as me,D as he}from"./index-CJzEU5Yr.js";import{B as m}from"./Button-CnRUMJhP.js";import{T as pe}from"./Input-BlISMA55.js";import{t as V}from"./translations-Btzq2RVP.js";import{A as q}from"./arrow-left-BvMvYESN.js";import{R as X}from"./refresh-cw-Cb_tqlw-.js";import{L as J}from"./loader-circle-C2oGxQGC.js";import{T as ue}from"./triangle-alert-D1dmY0gz.js";import{M as be}from"./map-pin-CUrl_rxU.js";import{S as Q}from"./sparkles-Ec3XciqQ.js";import{X as fe}from"./x-pd8-DY5F.js";import{C as ge}from"./circle-check-big-CYJ0xDz3.js";import{D as je}from"./droplets-CeBxQewb.js";import{Z as Ne}from"./zap-_Dq53VUE.js";/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m14.31 8 5.74 9.94",key:"1y6ab4"}],["path",{d:"M9.69 8h11.48",key:"1wxppr"}],["path",{d:"m7.38 12 5.74-9.94",key:"1grp0k"}],["path",{d:"M9.69 16 3.95 6.06",key:"libnyf"}],["path",{d:"M14.31 16H2.83",key:"x5fava"}],["path",{d:"m16.62 12-5.74 9.94",key:"1vwawt"}]],ye=f("aperture",ve);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],ke=f("camera",we);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=[["path",{d:"M10 8h.01",key:"1r9ogq"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M14 8h.01",key:"1primd"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"M18 8h.01",key:"emo2bl"}],["path",{d:"M6 8h.01",key:"x9i8wu"}],["path",{d:"M7 16h10",key:"wp8him"}],["path",{d:"M8 12h.01",key:"czm47f"}],["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}]],Ae=f("keyboard",Se);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=[["path",{d:"M13.73 4a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"14u9p9"}]],Ce=f("triangle",Re),ee="Analysis: Detected significant shingle loss on approximately 40% of the visible roof surface. Potential water intrusion points identified near the chimney. Estimated Severity: High.",Ge=({setView:g})=>{const se=s=>{const t=String(s||"GENERAL_USER").toUpperCase();return["ADMIN","CONTRACTOR","LOCAL_AUTHORITY","FIRST_RESPONDER","GENERAL_USER","INSTITUTION_ADMIN","STATE_ADMIN","COUNTY_ADMIN","ORG_ADMIN","MEMBER"].includes(t)?t:"GENERAL_USER"},[h,j]=a.useState(1),[n,te]=a.useState(null),[o,M]=a.useState(1),[D,T]=a.useState(""),[N,ae]=a.useState("GENERAL_USER"),[i,I]=a.useState(!1),[p,P]=a.useState(null),[O,le]=a.useState([]),[U,_]=a.useState({}),[u,v]=a.useState(!1),[c,y]=a.useState(null),[re,L]=a.useState(!1),l=a.useRef(null),w=a.useRef(null),[k,$]=a.useState(!1),[H,S]=a.useState(null),[B,G]=a.useState(!1),[F,W]=a.useState(null),[A,R]=a.useState(null),oe=[{id:"STRUCTURAL",label:"Structure/Roof",icon:e.jsx(me,{size:32}),color:"blue"},{id:"FLOOD",label:"Water/Flood",icon:e.jsx(je,{size:32}),color:"cyan"},{id:"ELECTRICAL",label:"Power/Gas",icon:e.jsx(Ne,{size:32}),color:"yellow"},{id:"ACCESS",label:"Blocked Road",icon:e.jsx(Ce,{size:32}),color:"orange"}],C=N==="ADMIN"||N==="ORG_ADMIN"||N==="INSTITUTION_ADMIN";a.useEffect(()=>()=>{E()},[]),a.useEffect(()=>{const s=de.getProfile();ae(se(s.role))},[]);const K=async()=>{I(!0),P(null);try{const s=await xe(75);le(s);const t=s.filter(r=>!!r.photoPath).slice(0,20);if(t.length>0){const r=await Promise.all(t.map(async d=>{try{const x=await Z(d.photoPath);return[d.id,x]}catch(x){return[d.id,""]}})),b={};r.forEach(([d,x])=>{x&&(b[d]=x)}),_(b)}else _({})}catch(s){P((s==null?void 0:s.message)||"Unable to load assessment results.")}finally{I(!1)}};a.useEffect(()=>{C&&K()},[C]),a.useEffect(()=>{const s=t=>{u&&(t.code==="Space"||t.code==="Enter")&&(t.preventDefault(),z())};return u&&window.addEventListener("keydown",s),()=>{window.removeEventListener("keydown",s)}},[u]);const E=()=>{l.current&&l.current.srcObject&&(l.current.srcObject.getTracks().forEach(t=>t.stop()),l.current.srcObject=null)},Y=async()=>{y(null),S(null);try{const s=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});v(!0),setTimeout(()=>{l.current&&(l.current.srcObject=s)},100)}catch(s){console.error("Camera denied",s),alert("Could not access camera. Please allow permissions.")}},z=()=>{if(l.current&&w.current){const s=l.current,t=w.current;if(s.readyState<2)return;L(!0),setTimeout(()=>L(!1),150),t.width=s.videoWidth,t.height=s.videoHeight;const r=t.getContext("2d");if(r){r.drawImage(s,0,0,t.width,t.height);const b=t.toDataURL("image/jpeg",.8);setTimeout(()=>{y(b),E(),v(!1),ne()},150)}}},ne=s=>{$(!0),setTimeout(()=>{$(!1),S(ee),T(t=>t+(t?"\n\n":"")+ee),M(3)},2500)},ie=()=>{y(null),S(null),Y()},ce=async()=>{if(n){G(!0),W(null);try{const s=await he({damageType:n,severity:o,description:D,imageDataUrl:c||null});if(s!=null&&s.photo_path)try{const t=await Z(s.photo_path);R(t)}catch(t){R(null)}else R(null);j(3)}catch(s){W((s==null?void 0:s.message)||"Unable to submit assessment.")}finally{G(!1)}}};return C?e.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col pb-safe animate-fade-in",children:[e.jsx("div",{className:"bg-white border-b border-slate-200 p-4 sticky top-0 z-20",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>g("DASHBOARD"),className:"p-2 -ml-2 text-slate-500 hover:text-slate-800",children:e.jsx(q,{size:24})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-bold text-lg text-slate-900",children:V("dash.assess")}),e.jsx("p",{className:"text-xs text-slate-500",children:"Reported Assessment Results"})]})]}),e.jsxs(m,{size:"sm",variant:"outline",onClick:K,disabled:i,children:[e.jsx(X,{size:14,className:"mr-1"})," Refresh"]})]})}),e.jsxs("div",{className:"p-6 space-y-4 flex-1 overflow-y-auto",children:[i&&e.jsxs("div",{className:"bg-white border border-slate-200 rounded-xl p-6 flex items-center gap-3 text-slate-600",children:[e.jsx(J,{size:18,className:"animate-spin"}),"Loading reported assessments..."]}),!i&&p&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 text-red-700 text-sm font-medium",children:p}),!i&&!p&&O.length===0&&e.jsxs("div",{className:"bg-white border border-slate-200 rounded-xl p-8 text-center text-slate-600",children:[e.jsx(ue,{size:24,className:"mx-auto mb-3 text-slate-400"}),"No reported assessments found yet."]}),!i&&!p&&O.map(s=>e.jsxs("div",{className:"bg-white border border-slate-200 rounded-xl p-4 shadow-sm space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-slate-900",children:s.damageType}),e.jsx("p",{className:"text-xs text-slate-500",children:new Date(s.createdAt).toLocaleString()})]}),e.jsx("span",{className:"text-xs font-bold px-2.5 py-1 rounded-full uppercase ".concat(s.severity>=3?"bg-red-100 text-red-700":s.severity===2?"bg-yellow-100 text-yellow-700":"bg-green-100 text-green-700"),children:s.severity>=3?"Critical":s.severity===2?"Moderate":"Minor"})]}),(s.orgName||s.orgCode)&&e.jsxs("p",{className:"text-xs text-slate-600",children:[e.jsx("span",{className:"font-semibold text-slate-700",children:"Organization:"})," ",s.orgName||s.orgCode]}),e.jsxs("p",{className:"text-xs text-slate-600",children:[e.jsx("span",{className:"font-semibold text-slate-700",children:"Reporter:"})," ",s.reporterName,s.reporterPhone?" â€¢ ".concat(s.reporterPhone):""]}),s.location&&e.jsxs("p",{className:"text-xs text-slate-600 flex items-center gap-1",children:[e.jsx(be,{size:12})," ",s.location]}),s.description&&e.jsx("p",{className:"text-sm text-slate-700 bg-slate-50 border border-slate-100 rounded-lg p-3",children:s.description}),U[s.id]&&e.jsx("img",{src:U[s.id],alt:"Damage evidence",className:"w-full max-h-56 object-cover rounded-lg border border-slate-200"})]},s.id))]})]}):e.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col pb-safe animate-fade-in",children:[e.jsx("div",{className:"bg-white border-b border-slate-200 p-4 sticky top-0 z-20",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>h===1?g("DASHBOARD"):j(1),className:"p-2 -ml-2 text-slate-500 hover:text-slate-800",children:e.jsx(q,{size:24})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-bold text-lg text-slate-900",children:V("dash.assess")}),e.jsx("p",{className:"text-xs text-slate-500",children:"Damage Reporting Assistant"})]})]})}),e.jsxs("div",{className:"p-6 space-y-6 flex-1 overflow-y-auto",children:[h===1&&e.jsxs("div",{className:"space-y-6 animate-slide-up",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 mb-2",children:"What was damaged?"}),e.jsx("p",{className:"text-slate-600 text-sm",children:"Select the category that best describes the issue."})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:oe.map(s=>e.jsxs("button",{onClick:()=>{te(s.id),j(2)},className:"p-6 rounded-2xl border-2 flex flex-col items-center gap-3 transition-all hover:scale-[1.02] active:scale-95 ".concat(n===s.id?"border-".concat(s.color,"-500 bg-").concat(s.color,"-50 text-").concat(s.color,"-900 shadow-md"):"border-slate-200 bg-white text-slate-600 hover:border-slate-300"),children:[e.jsx("div",{className:"p-3 rounded-full ".concat(n===s.id?"bg-white":"bg-slate-100"),children:s.icon}),e.jsx("span",{className:"font-bold",children:s.label})]},s.id))}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-xl border border-purple-100 flex gap-3 items-start",children:[e.jsx(Q,{className:"text-purple-600 shrink-0 mt-1",size:20}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-purple-900 text-sm",children:"AI Assisted Mode"}),e.jsx("p",{className:"text-xs text-purple-700 mt-1",children:"Take a photo in the next step, and our AI will automatically assess the severity and type of damage for you."})]})]})]}),h===2&&e.jsxs("div",{className:"space-y-6 animate-slide-up",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-bold text-slate-900 uppercase tracking-wider",children:"1. Visual Evidence"}),e.jsxs("div",{className:"border-2 border-slate-300 rounded-xl bg-black min-h-[240px] relative overflow-hidden shadow-sm",children:[e.jsx("canvas",{ref:w,className:"hidden"}),re&&e.jsx("div",{className:"absolute inset-0 bg-white z-50 transition-opacity duration-150 ease-out"}),u?e.jsxs("div",{className:"relative w-full h-full flex flex-col items-center justify-center bg-black group",children:[e.jsx("video",{ref:l,autoPlay:!0,playsInline:!0,muted:!0,onClick:z,className:"w-full h-full object-cover absolute inset-0 cursor-pointer"}),e.jsx("div",{className:"absolute bottom-4 left-0 right-0 flex justify-center z-10 pointer-events-none",children:e.jsx("button",{onClick:s=>{s.stopPropagation(),z()},className:"w-16 h-16 bg-white rounded-full border-4 border-slate-300 flex items-center justify-center hover:scale-105 active:scale-95 transition-transform shadow-lg pointer-events-auto",title:"Take Photo (Spacebar)",children:e.jsx("div",{className:"w-12 h-12 bg-red-600 rounded-full"})})}),e.jsx("div",{className:"absolute top-4 right-4 z-10 pointer-events-none",children:e.jsx("button",{onClick:s=>{s.stopPropagation(),E(),v(!1)},className:"bg-black/50 text-white p-2 rounded-full backdrop-blur pointer-events-auto hover:bg-black/70",children:e.jsx(fe,{size:20})})}),e.jsx("div",{className:"absolute top-4 left-4 z-10 pointer-events-none",children:e.jsxs("span",{className:"bg-black/50 text-white text-[10px] px-2 py-1 rounded backdrop-blur font-bold uppercase flex items-center gap-1",children:[e.jsx(Ae,{size:10,className:"hidden md:block"})," Click or Press Space"]})})]}):c?e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("img",{src:c,alt:"Damage Evidence",className:"w-full h-full object-cover"}),k&&e.jsxs("div",{className:"absolute inset-0 bg-black/60 flex flex-col items-center justify-center text-white backdrop-blur-sm",children:[e.jsx(J,{size:48,className:"animate-spin mb-3 text-brand-400"}),e.jsx("span",{className:"font-bold text-lg animate-pulse",children:"AI Analyzing Structure..."})]}),!k&&e.jsx("div",{className:"absolute bottom-4 right-4",children:e.jsxs(m,{size:"sm",onClick:ie,className:"bg-white text-slate-900 hover:bg-slate-100 font-bold shadow-lg",children:[e.jsx(X,{size:16,className:"mr-2"})," Retake"]})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-60 bg-slate-100 text-slate-400",children:[e.jsx(ke,{size:48,className:"mb-3 opacity-50"}),e.jsx("p",{className:"font-bold text-slate-600",children:"No Evidence Added"}),e.jsx("p",{className:"text-xs mb-4",children:"Photos help prioritize your claim"}),e.jsxs(m,{onClick:Y,className:"font-bold bg-slate-800 text-white hover:bg-slate-700",children:[e.jsx(ye,{size:18,className:"mr-2"})," Open Camera"]})]})]}),H&&!k&&e.jsxs("div",{className:"bg-indigo-50 border border-indigo-200 p-4 rounded-xl animate-slide-up shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-indigo-700 font-bold text-xs uppercase tracking-wide",children:[e.jsx(Q,{size:16})," Gemini AI Assessment"]}),e.jsxs("p",{className:"text-sm text-indigo-900 leading-relaxed font-medium",children:['"',H,'"']})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-bold text-slate-900 uppercase tracking-wider",children:"2. Severity Level"}),e.jsx("div",{className:"flex gap-2",children:[{lvl:1,label:"Minor",color:"green"},{lvl:2,label:"Moderate",color:"yellow"},{lvl:3,label:"Severe",color:"red"}].map(s=>e.jsx("button",{onClick:()=>M(s.lvl),className:"flex-1 py-3 rounded-xl border-2 font-bold text-sm transition-all ".concat(o===s.lvl?"bg-".concat(s.color,"-100 border-").concat(s.color,"-500 text-").concat(s.color,"-800 shadow-sm ring-1 ring-").concat(s.color,"-500"):"bg-white border-slate-200 text-slate-400 hover:border-slate-300"),children:s.label},s.lvl))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-bold text-slate-900 uppercase tracking-wider",children:"3. Details"}),e.jsx(pe,{placeholder:"Add additional notes here...",value:D,onChange:s=>T(s.target.value),className:"min-h-[100px] border-slate-300 focus:border-brand-500"})]}),e.jsx(m,{fullWidth:!0,size:"lg",className:"shadow-lg mt-4 bg-brand-600 hover:bg-brand-700 font-bold",onClick:ce,disabled:B,children:B?"Submitting...":"Submit Assessment"}),F&&e.jsx("p",{className:"text-xs text-red-600 font-semibold mt-2",children:F})]}),h===3&&e.jsxs("div",{className:"flex flex-col items-center justify-center text-center space-y-6 animate-fade-in pt-10",children:[e.jsx("div",{className:"w-24 h-24 bg-green-100 rounded-full flex items-center justify-center text-green-600 mb-2 shadow-inner",children:e.jsx(ge,{size:48})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"Report Filed"}),e.jsx("p",{className:"text-slate-600 font-medium",children:"Your damage assessment has been logged."})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl w-full text-left border border-slate-200 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between mb-3 border-b border-slate-100 pb-2",children:[e.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase",children:"Case ID"}),e.jsxs("span",{className:"text-xs font-mono font-bold text-slate-900",children:["DMG-",Math.floor(Math.random()*1e4)]})]}),(A||c)&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-xs font-bold text-slate-500 uppercase mb-2",children:"Photo Preview"}),e.jsx("img",{src:A||c||"",alt:"Submitted damage",className:"w-full max-h-56 object-cover rounded-lg border border-slate-200"}),A&&e.jsx("p",{className:"text-[10px] text-slate-500 mt-1",children:"Private link expires in 1 hour."})]}),e.jsxs("div",{className:"flex justify-between mb-3 border-b border-slate-100 pb-2",children:[e.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase",children:"Type"}),e.jsx("span",{className:"text-sm font-bold text-slate-900",children:n})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase",children:"Est. Severity"}),e.jsx("span",{className:"text-xs font-bold px-3 py-1 rounded-full uppercase ".concat(o===3?"bg-red-100 text-red-700":o===2?"bg-yellow-100 text-yellow-700":"bg-green-100 text-green-700"),children:o===3?"Critical":o===2?"Moderate":"Minor"})]})]}),e.jsx(m,{fullWidth:!0,variant:"outline",onClick:()=>g("DASHBOARD"),className:"border-slate-300 text-slate-700 font-bold",children:"Return to Dashboard"})]})]})]})};export{Ge as AssessmentView};
