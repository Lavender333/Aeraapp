import{c as P,r,j as e,S as x,i as he,f as Wt,e as Jt,h as Kt,k as Qt,l as Gs,m as ze,o as Ee,p as Pe,q as ue,s as Zt,t as Xt,u as ea,v as sa,w as qs,x as ta,d as aa,y as ts,z as la,A as na}from"./index-CJzEU5Yr.js";import{T as Ys,I}from"./Input-BlISMA55.js";import{B as d}from"./Button-CnRUMJhP.js";import{H as ra}from"./HouseholdManager-ClllYexm.js";import{C as Me}from"./check-Bo9A-7LG.js";import{s as Ws}from"./supabaseClient-B4Qx1bZD.js";import{t as as}from"./translations-Btzq2RVP.js";import{X as ia}from"./x-pd8-DY5F.js";import{A as T}from"./arrow-left-BvMvYESN.js";import{D as ls}from"./download-CDRmzJn9.js";import{C as Js}from"./circle-check-big-CYJ0xDz3.js";import{A as oa,U as ns}from"./users-ZMkFcCYZ.js";import{C as pe}from"./copy-Xk1H1Rjz.js";import{S as rs}from"./shield-check-e7FEkpgI.js";import{M as Ks}from"./map-pin-CUrl_rxU.js";import{U as is}from"./user-jnEtzzBn.js";import{T as da}from"./truck-DXMNKKFf.js";import{M as ca}from"./mail-DBqRjF6g.js";import{P as os}from"./phone-CIamh-IK.js";import{S as Qs}from"./search-DuOucN67.js";import{B as Le}from"./building-2-DB6iRbBB.js";import{A as Zs,R as xa}from"./radio-BfeAXirp.js";import{H as Xs,S as ma}from"./save-CJzrS06H.js";import{G as ha}from"./globe-DkfSO5zk.js";import{L as et}from"./lock-xScy7UZd.js";import{F as st,C as be}from"./file-text-2_Wm7TNF.js";import{L as tt}from"./loader-circle-C2oGxQGC.js";/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ua=[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],pa=P("ban",ua);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ba=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],at=P("circle-x",ba);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ga=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],fa=P("database",ga);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ja=[["path",{d:"M21 21H8a2 2 0 0 1-1.42-.587l-3.994-3.999a2 2 0 0 1 0-2.828l10-10a2 2 0 0 1 2.829 0l5.999 6a2 2 0 0 1 0 2.828L12.834 21",key:"g5wo59"}],["path",{d:"m5.082 11.09 8.828 8.828",key:"1wx5vj"}]],Na=P("eraser",ja);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const va=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],lt=P("link",va);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ya=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],wa=P("log-out",ya);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sa=[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]],Ca=P("pen-tool",Sa);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ka=[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]],ds=P("printer",ka);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ia=[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]],Aa=P("refresh-ccw",Ia);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ra=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Da=P("square-check-big",Ra),nt=({onSave:v,className:b})=>{const j=r.useRef(null),[ge,te]=r.useState(!1),[fe,ae]=r.useState(!1);r.useEffect(()=>{const h=j.current;if(h){const u=h.getBoundingClientRect();h.width=u.width,h.height=u.height;const w=h.getContext("2d");w&&(w.lineWidth=2,w.lineCap="round",w.strokeStyle="#000")}},[]);const g=h=>{const u=j.current;if(!u)return{x:0,y:0};const w=u.getBoundingClientRect();let L,D;return"touches"in h?(L=h.touches[0].clientX,D=h.touches[0].clientY):(L=h.clientX,D=h.clientY),{x:L-w.left,y:D-w.top}},A=h=>{var w;h.preventDefault(),te(!0);const u=(w=j.current)==null?void 0:w.getContext("2d");if(u){const{x:L,y:D}=g(h);u.beginPath(),u.moveTo(L,D)}},y=h=>{var w;if(!ge)return;h.preventDefault();const u=(w=j.current)==null?void 0:w.getContext("2d");if(u){const{x:L,y:D}=g(h);u.lineTo(L,D),u.stroke(),ae(!0)}},le=()=>{te(!1)},l=()=>{const h=j.current,u=h==null?void 0:h.getContext("2d");h&&u&&(u.clearRect(0,0,h.width,h.height),ae(!1))},C=()=>{if(j.current){const h=j.current.toDataURL("image/png");v(h)}};return e.jsxs("div",{className:"space-y-3 ".concat(b),children:[e.jsxs("div",{className:"border-2 border-slate-300 rounded-xl overflow-hidden bg-white shadow-inner relative",children:[e.jsx("canvas",{ref:j,className:"w-full h-40 touch-none cursor-crosshair block",onMouseDown:A,onMouseMove:y,onMouseUp:le,onMouseLeave:le,onTouchStart:A,onTouchMove:y,onTouchEnd:le}),e.jsx("div",{className:"absolute bottom-2 left-4 text-xs text-slate-300 pointer-events-none font-bold uppercase select-none",children:"Sign Here"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(d,{variant:"outline",onClick:l,size:"sm",className:"flex-1 text-slate-500 border-slate-300",children:[e.jsx(Na,{size:16,className:"mr-2"})," Clear"]}),e.jsxs(d,{onClick:C,size:"sm",disabled:!fe,className:"flex-1 font-bold bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(Me,{size:16,className:"mr-2"})," Apply Signature"]})]})]})},za=async v=>{const b=Ws.channel("notifications").on("postgres_changes",{event:"*",schema:"public",table:"notifications"},j=>v(j)).subscribe();return()=>{Ws.removeChannel(b)}},rt=v=>{if(!v)return v;const b=v.replace(/[^\d]/g,""),j=b.length;return j<4?b:j<7?"(".concat(b.slice(0,3),") ").concat(b.slice(3)):"(".concat(b.slice(0,3),") ").concat(b.slice(3,6),"-").concat(b.slice(6,10))},it=v=>{const b=String(v||"").toUpperCase().replace(/[–—−]/g,"-").replace(/[^A-Z0-9-]/g,"").replace(/-+/g,"-");return b.length<=2||b.includes("-")?b:"".concat(b.slice(0,2),"-").concat(b.slice(2))},Ea=v=>{const b=String(v||"").replace(/\D/g,"");if(b.length<4)return v;const j=b.slice(-4);return"***-***-".concat(j)},Pa=[{id:"ADMIN",label:"Administrator",description:"Full system access and user management.",permissions:{canViewPII:!0,canDispatchDrone:!0,canApproveFunds:!0,canManageInventory:!0,canBroadcastAlerts:!0}},{id:"FIRST_RESPONDER",label:"First Responder",description:"Field access to location data and medical info.",permissions:{canViewPII:!0,canDispatchDrone:!1,canApproveFunds:!1,canManageInventory:!1,canBroadcastAlerts:!0}},{id:"LOCAL_AUTHORITY",label:"Local Authority",description:"Oversight of alerts and population tracking.",permissions:{canViewPII:!1,canDispatchDrone:!1,canApproveFunds:!0,canManageInventory:!1,canBroadcastAlerts:!0}},{id:"CONTRACTOR",label:"Contractor",description:"Logistics and repair management.",permissions:{canViewPII:!1,canDispatchDrone:!1,canApproveFunds:!1,canManageInventory:!0,canBroadcastAlerts:!1}},{id:"INSTITUTION_ADMIN",label:"Institution Admin",description:"Manage community members and hub inventory.",permissions:{canViewPII:!1,canDispatchDrone:!1,canApproveFunds:!1,canManageInventory:!0,canBroadcastAlerts:!0}},{id:"GENERAL_USER",label:"General User",description:"Standard access to report emergencies.",permissions:{canViewPII:!1,canDispatchDrone:!1,canApproveFunds:!1,canManageInventory:!1,canBroadcastAlerts:!1}}],ol=({setView:v})=>{const j=r.useRef(null),ge=r.useRef(null),te=r.useRef(null),fe=r.useRef(null),ae=r.useRef(null),[g,A]=r.useState({profile:!1,household:!1,contacts:!1,community:!1,security:!1}),[y,le]=r.useState({profile:!1,household:!1,contacts:!1,community:!1,security:!1}),[l,C]=r.useState({id:"",fullName:"",phone:"",address:"",householdMembers:1,household:[],zipCode:"",petDetails:"",medicalNeeds:"",medicationDependency:!1,insulinDependency:!1,oxygenPoweredDevice:!1,mobilityLimitation:!1,transportationAccess:!0,financialStrain:!1,consentPreparednessPlanning:!1,emergencyContactName:"",emergencyContactPhone:"",emergencyContactRelation:"",communityId:"",role:"GENERAL_USER",language:"en",active:!0,notifications:{push:!0,sms:!0,email:!0}}),h=String(l.role||"").toUpperCase(),u=["ADMIN","STATE_ADMIN","COUNTY_ADMIN","ORG_ADMIN","INSTITUTION_ADMIN"].includes(h),L=String(l.address||"").trim().length>0&&!1,D=l.addressVerifiedAt?new Date(l.addressVerifiedAt).toLocaleString():null,[V,R]=r.useState("MAIN"),[ot,W]=r.useState(!1),[je,cs]=r.useState(!1),[z,B]=r.useState(null),[J,E]=r.useState(null),[xs,ms]=r.useState(!1),[hs,Oe]=r.useState(null),[M,O]=r.useState("IDLE"),[F,ne]=r.useState([]),[dt,La]=r.useState(!1),[us,U]=r.useState(-1),[Ne,Ue]=r.useState("ALL_USERS"),[ps,ct]=r.useState(()=>x.getRoles()||Pa),[_e,$e]=r.useState([]),[bs,xt]=r.useState(""),[m,ve]=r.useState(null),[S,mt]=r.useState(null),[Te,ye]=r.useState([]),[re,ht]=r.useState(""),[p,we]=r.useState(null),[Ve,Be]=r.useState([]),[ut,gs]=r.useState(!1),[ie,Se]=r.useState([]),[f,Fe]=r.useState(null),[He,fs]=r.useState({}),[Ge,js]=r.useState(!1),[qe,Ns]=r.useState(!1),[vs,Ce]=r.useState(null),[ke,K]=r.useState(null),[Ie,ys]=r.useState(""),[ws,_]=r.useState(null),[Ss,H]=r.useState(null),[Cs,ks]=r.useState(!1),[Is,Q]=r.useState([]),[As,k]=r.useState(null),[Rs,G]=r.useState(null),[oe,Z]=r.useState(null),[Ds,X]=r.useState([]),[zs,ee]=r.useState([]),[Ye,Ae]=r.useState([]),[pt,Es]=r.useState(!1),[q,se]=r.useState([]),[We,Ps]=r.useState(null),[bt,Ls]=r.useState(!1),de=s=>{A(t=>({...t,[s]:!t[s]}))},ce=s=>{le(t=>({...t,[s]:!t[s]}))},xe=s=>{A(a=>({...a,[s]:!0}));const t=s==="profile"?ge:s==="contacts"?te:s==="household"?fe:s==="community"?j:ae;window.setTimeout(()=>{var a;(a=t.current)==null||a.scrollIntoView({behavior:"smooth",block:"start"})},50)},gt=()=>{const s=x.getProfile();s.role||(s.role="GENERAL_USER"),s.language||(s.language="en"),s.active===void 0&&(s.active=!0),s.household||(s.household=[]),C(s),Oe(null),Ce(null),K(null),_(null),H(null),G(null),k(null),E(null),s.addressVerified?O("VALID"):(s.address&&s.address.length>5,O("IDLE")),ne([]),U(-1)},ft=async()=>{if(g.security||g.household){await yt();return}await vt()},[Ms,Je]=r.useState(""),Ke=s=>{C(a=>({...a,householdId:s.householdId,householdCode:s.householdCode,householdName:s.householdName,householdRole:s.householdRole}));const t=x.getProfile();x.saveProfile({...t,householdId:s.householdId,householdCode:s.householdCode,householdName:s.householdName,householdRole:s.householdRole})};r.useEffect(()=>{const s=x.getProfile();if(s.role||(s.role="GENERAL_USER"),s.language||(s.language="en"),s.active===void 0&&(s.active=!0),s.household||(s.household=[]),typeof s.zipCode!="string"&&(s.zipCode=""),typeof s.medicationDependency!="boolean"&&(s.medicationDependency=!1),typeof s.insulinDependency!="boolean"&&(s.insulinDependency=!1),typeof s.oxygenPoweredDevice!="boolean"&&(s.oxygenPoweredDevice=!1),typeof s.mobilityLimitation!="boolean"&&(s.mobilityLimitation=!1),typeof s.transportationAccess!="boolean"&&(s.transportationAccess=!0),typeof s.financialStrain!="boolean"&&(s.financialStrain=!1),typeof s.consentPreparednessPlanning!="boolean"&&(s.consentPreparednessPlanning=!1),C(s),s.addressVerified?O("VALID"):s.address&&s.address.length>5&&O("IDLE"),s.communityId&&s.role!=="INSTITUTION_ADMIN"){const t=x.getOrganization(s.communityId);t&&B(t.name)}},[]),r.useEffect(()=>{let s=!0;return(async()=>{try{const[a,n]=await Promise.all([Wt(),Jt()]);if(!s)return;if(a||n){const o={...x.getProfile(),...a||{},...n||{}};x.saveProfile(o),C(o),O(o.addressVerified?"VALID":"IDLE")}const i=await Kt();if(!s)return;if(i)Ke(i);else{const c=await Qt();if(!s)return;Ke(c)}try{const c=await Gs();s&&Ae(c)}catch(c){s&&Ae([])}}catch(a){}})(),()=>{s=!1}},[]),r.useEffect(()=>{!u&&V!=="MAIN"&&R("MAIN")},[u,V]),r.useEffect(()=>{if(sessionStorage.getItem("settingsScrollTarget")!=="TRUSTED_COMMUNITY")return;const t=window.setTimeout(()=>{var a;A(n=>({...n,community:!0})),(a=j.current)==null||a.scrollIntoView({behavior:"smooth",block:"start"}),sessionStorage.removeItem("settingsScrollTarget")},150);return()=>window.clearTimeout(t)},[]),r.useEffect(()=>{const s=Array.isArray(l.household)?l.household.length:0,t=Math.max(1,s+1);l.householdMembers!==t&&C(a=>({...a,householdMembers:t}))},[l.household,l.householdMembers]),r.useEffect(()=>{let s=!0;return(async()=>{if(!l.householdId){Q([]);return}try{const a=await ze();s&&Q(a)}catch(a){s&&Q([])}})(),()=>{s=!1}},[l.householdId]),r.useEffect(()=>{let s=!0;return(async()=>{try{const a=await Gs();s&&Ae(a)}catch(a){s&&Ae([])}})(),()=>{s=!1}},[l.householdId,l.householdRole]),r.useEffect(()=>{let s=!0;return(async()=>{l.householdId||(X([]),ee([]));try{const[a,n]=await Promise.all([Ee(),Pe()]);if(!s)return;X(a),ee(n)}catch(a){if(!s)return;X([]),ee([])}try{const a=await ue(50);s&&se(a)}catch(a){s&&se([])}})(),()=>{s=!1}},[l.householdId,l.householdRole]),r.useEffect(()=>{let s=null,t=!0;return(async()=>{try{s=await za(async()=>{if(t)try{const[n,i,c]=await Promise.all([ue(50),Ee(),Pe()]);if(!t)return;se(n),X(i),ee(c)}catch(n){}})}catch(n){s=null}})(),()=>{t=!1,s&&s()}},[]),r.useEffect(()=>{if(p){const s=x.getOrgMembers(p.id);Be(s),x.fetchOrgMembersRemote(p.id).then(({members:t,fromCache:a})=>{Be(t),gs(a)}).catch(()=>gs(!0))}else Be([])},[p]);const Os=s=>/^[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}$/.test(s)?(Oe(null),!0):(Oe("Invalid format. Use 555-123-4567"),!1),Us=async s=>{},jt=()=>{ne([]),U(-1),Qe(l.address)},Nt=s=>{if(s.key==="Escape"){ne([]),U(-1);return}if(F.length===0){s.key==="Enter"&&(s.preventDefault(),Qe(l.address));return}if(s.key==="ArrowDown"){s.preventDefault(),U(t=>(t+1)%F.length);return}if(s.key==="ArrowUp"){s.preventDefault(),U(t=>t<=0?F.length-1:t-1);return}s.key==="Enter"&&(s.preventDefault(),(F[us]||F[0])&&Us())};r.useEffect(()=>{String(l.address||"").trim();{ne([]),U(-1);return}},[l.address,l.addressVerified,void 0]);const Qe=async s=>{var a;if(((a=s!=null?s:l.address)!=null?a:"").trim().length<5){O("IDLE");return}{O("IDLE");return}},vt=async()=>{const s=String(l.address||"").trim();if(!Os(l.phone)){A(t=>({...t,profile:!0})),alert("Please fix phone number errors before saving.");return}if(s.length>0,M==="INVALID"){A(t=>({...t,profile:!0})),alert("Please verify your address.");return}js(!0),Ce(null);try{await ts({fullName:l.fullName,phone:l.phone,email:l.email,address:l.address,addressLine1:l.addressLine1,addressLine2:l.addressLine2,city:l.city,state:l.state,zip:l.zipCode,latitude:l.latitude,longitude:l.longitude,googlePlaceId:l.googlePlaceId,addressVerified:!!l.addressVerified,addressVerifiedAt:l.addressVerifiedAt,emergencyContactName:l.emergencyContactName,emergencyContactPhone:l.emergencyContactPhone,emergencyContactRelation:l.emergencyContactRelation,communityId:l.communityId,role:l.role}),x.saveProfile(l),W(!0),setTimeout(()=>W(!1),2e3)}catch(t){Ce((t==null?void 0:t.message)||"Unable to update profile.")}finally{js(!1)}},yt=async()=>{var t;if(!((t=l.zipCode)!=null&&t.trim())){A(a=>({...a,profile:!0})),K("ZIP is pulled from your Home Address. Verify your address in Identity first.");return}const s=la(l.household||[]);if(!s.ok){A(a=>({...a,household:!0})),K(s.error);return}if(!l.consentPreparednessPlanning){A(a=>({...a,security:!0})),K("You must provide consent before saving Vital Intake.");return}Ns(!0),K(null);try{await na({household:l.household,householdMembers:l.householdMembers,petDetails:l.petDetails,medicalNeeds:l.medicalNeeds,zipCode:l.zipCode,medicationDependency:!!l.medicationDependency,insulinDependency:!!l.insulinDependency,oxygenPoweredDevice:!!l.oxygenPoweredDevice,mobilityLimitation:!!l.mobilityLimitation,transportationAccess:!!l.transportationAccess,financialStrain:!!l.financialStrain,consentPreparednessPlanning:!!l.consentPreparednessPlanning});const a={...l,consentTimestamp:new Date().toISOString()};C(a),x.saveProfile(a),W(!0),setTimeout(()=>W(!1),2e3)}catch(a){K((a==null?void 0:a.message)||"Unable to update vitals.")}finally{Ns(!1)}},N=(s,t)=>{C(a=>{const n={...a,[s]:t};return s==="address"&&(n.addressVerified=!1,n.addressVerifiedAt=void 0,n.googlePlaceId=void 0,n.latitude=void 0,n.longitude=void 0,n.addressLine1=void 0,n.addressLine2=void 0,n.city=void 0,n.state=void 0),n}),s==="communityId"&&(B(null),E(null)),s==="address"&&(O("IDLE"),ne([]),U(-1),Ce(null))},_s=async()=>{const s=String(l.communityId||"").trim().replace(/[–—−]/g,"-").replace(/\s+/g,"").toUpperCase();if(s){cs(!0),E(null),B(null);try{const t=x.getOrganization(s),a=t?{orgCode:s,orgName:t.name}:await aa(s);if(!a){E("Invalid Community ID");return}const n=a.orgName||(t==null?void 0:t.name)||s,i={...l,communityId:s};C(i),x.saveProfile(i),B(n);try{await ts({fullName:i.fullName,phone:i.phone,email:i.email,address:i.address,addressLine1:i.addressLine1,addressLine2:i.addressLine2,city:i.city,state:i.state,zip:i.zipCode,latitude:i.latitude,longitude:i.longitude,googlePlaceId:i.googlePlaceId,addressVerified:!!i.addressVerified,addressVerifiedAt:i.addressVerifiedAt,emergencyContactName:i.emergencyContactName,emergencyContactPhone:i.emergencyContactPhone,emergencyContactRelation:i.emergencyContactRelation,communityId:s,role:i.role})}catch(c){}}catch(t){E("Unable to verify Community ID right now. Please try again.")}finally{cs(!1)}}},wt=async()=>{if(l.communityId){ms(!0),E(null);try{await ts({fullName:l.fullName,phone:l.phone,email:l.email,address:l.address,emergencyContactName:l.emergencyContactName,emergencyContactPhone:l.emergencyContactPhone,emergencyContactRelation:l.emergencyContactRelation,communityId:"",role:l.role});const s={...l,communityId:""};C(s),x.saveProfile(s),B(null),E(null)}catch(s){E((s==null?void 0:s.message)||"Unable to disconnect organization right now.")}finally{ms(!1)}}},Re=s=>{navigator.clipboard.writeText(s),alert("Copied to clipboard")},$s=async(s,t)=>{const a="AERA household invite for ".concat(s),n=encodeURIComponent(t),i=encodeURIComponent(a);if(navigator.share)try{return await navigator.share({title:a,text:t}),{method:"native",copied:!1}}catch(o){if((o==null?void 0:o.name)==="AbortError")return{method:"cancelled",copied:!1}}let c=!1;try{await navigator.clipboard.writeText(t),c=!0}catch(o){c=!1}try{return window.location.href="mailto:?subject=".concat(i,"&body=").concat(n),{method:"email",copied:c}}catch(o){if(c)return{method:"clipboard",copied:c};throw new Error("Unable to open share options on this device.")}},Ze=s=>{const t=(l.householdCode||"").trim().toUpperCase(),a=(s.id||"").replace(/[^A-Z0-9]/gi,"").toUpperCase().slice(-3),i=((s.name||"").replace(/[^A-Z0-9]/gi,"").toUpperCase().slice(0,3)||a||"MEM").padEnd(3,"X").slice(0,3);return t?"".concat(t,"-").concat(i):i},Ts=(l.household||[]).filter(s=>s.loginEnabled),$=r.useMemo(()=>{const s={};return Is.forEach(t=>{t.inviteeMemberRef&&(s[t.inviteeMemberRef]||(s[t.inviteeMemberRef]=t))}),s},[Is]),Xe=r.useMemo(()=>Ds.filter(s=>s.status==="pending"),[Ds]),De=r.useMemo(()=>zs[0]||null,[zs]),Vs=r.useMemo(()=>q.filter(s=>!s.read).length,[q]),St=r.useMemo(()=>{const s={};for(const t of q){if(t.type!=="household_member_reported_safe"&&t.type!=="household_member_reported_danger")continue;const a=t.metadata||{},n=String(a.memberRef||"");!n||s[n]||(s[n]={status:t.type==="household_member_reported_danger"?"DANGER":"SAFE",at:t.createdAt})}return s},[q]),Ct=async s=>{k(null),G(null),Z(s.id);try{if(!he(s.loginPhone||""))throw new Error("".concat(s.name," needs a valid phone number before creating an account invite."));const t=await qs({memberId:s.id,memberName:s.name,inviteePhone:s.loginPhone||"",suggestedCode:Ze(s)}),a="AERA invite for ".concat(s.name,": create or log in to your account, then use invite code ").concat(t.invitationCode," to join this household."),n=await $s(s.name,a);n.method==="cancelled"?k("Share cancelled."):n.method==="native"?k("Invite shared for ".concat(s.name,". Current status: ").concat(t.status,".")):n.copied?k("Invite prepared for ".concat(s.name,". Opened email and copied message.")):k("Invite prepared for ".concat(s.name,". Opened email draft."));const i=await ze();Q(i)}catch(t){G((t==null?void 0:t.message)||"Unable to create invite right now.")}finally{Z(null)}},kt=async s=>{k(null),G(null),Z(s.id);try{if(!he(s.loginPhone||""))throw new Error("".concat(s.name," needs a valid phone number before creating an account invite."));const t=await qs({memberId:s.id,memberName:s.name,inviteePhone:s.loginPhone||"",suggestedCode:Ze(s),forceNew:!0}),a="AERA invite for ".concat(s.name,": create or log in to your account, then use invite code ").concat(t.invitationCode," to join this household."),n=await $s(s.name,a);n.method==="cancelled"?k("Share cancelled."):n.copied?k("New invite generated for ".concat(s.name,". Opened email and copied message.")):k("New invite generated for ".concat(s.name,"."));const i=await ze();Q(i)}catch(t){G((t==null?void 0:t.message)||"Unable to resend invite right now.")}finally{Z(null)}},It=async s=>{const t=$[s.id];if(!(!(t!=null&&t.id)||t.status!=="PENDING")){k(null),G(null),Z(s.id);try{await ta(t.id),k("Invite revoked for ".concat(s.name,"."));const a=await ze();Q(a)}catch(a){G((a==null?void 0:a.message)||"Unable to revoke invite right now.")}finally{Z(null)}}},At=async()=>{_(null),H(null);const s=Ie.trim().toUpperCase();if(s.length<6||s.includes("-")){_("Enter a valid 6-character household code.");return}ks(!0);try{const t=await Xt(s);H(t.message||"Your request has been sent to the household administrator."),ys("");try{const[a,n,i]=await Promise.all([Ee(),Pe(),ue(50)]);X(a),ee(n),se(i)}catch(a){}}catch(t){_((t==null?void 0:t.message)||"Unable to submit join request.")}finally{ks(!1)}},Rt=async s=>{if(!(!s||s===l.householdId)){_(null),H(null),Es(!0);try{await Zt(s);const t=Ye.find(a=>a.householdId===s);t&&Ke({householdId:t.householdId,householdCode:t.householdCode,householdName:t.householdName,householdRole:t.householdRole}),H("Active household updated.")}catch(t){_((t==null?void 0:t.message)||"Unable to switch households right now.")}finally{Es(!1)}}},Bs=async(s,t)=>{_(null),H(null),Ps(s.id);try{await ea(s.id,t);const[a,n,i]=await Promise.all([Ee(),Pe(),ue(50)]);X(a),ee(n),se(i),H(t==="approved"?"Connection successful. This member has been added.":"Request rejected.")}catch(a){_((a==null?void 0:a.message)||"Unable to resolve request right now.")}finally{Ps(null)}},Dt=async()=>{Ls(!0);try{const s=q.filter(a=>!a.read);await Promise.all(s.map(a=>sa(a.id)));const t=await ue(50);se(t)}catch(s){}finally{Ls(!1)}},zt=()=>{x.logoutUser(),v("LOGIN")},Et=()=>{if(!u)return;const s=x.getDB();mt(s),R("DB_VIEWER")},Pt=()=>{if(!u)return;const s=x.getDB();ye(s.organizations),R("ORG_DIRECTORY"),we(null)},Lt=()=>{if(console.info("[AccessControl] openAccessControl clicked",{isAdmin:u}),!u){console.warn("[AccessControl] blocked: not admin");return}const s=x.getDB();console.info("[AccessControl] loading users",{count:Array.isArray(s.users)?s.users.length:0}),$e(Array.isArray(s.users)?s.users:[]),Ue("ALL_USERS"),R("ACCESS_CONTROL"),ve(null)},Mt=()=>{if(!u)return;const s=x.getDB();ye(s.organizations),Je(s.tickerMessage),R("BROADCAST_CONTROL")},Ot=()=>{if(!u)return;const s=x.getAllReplenishmentRequests();Se(s),R("MASTER_INVENTORY")},Ut=(s,t)=>{ct(a=>{const n=a.map(i=>i.id===s?{...i,permissions:{...i.permissions,[t]:!i.permissions[t]}}:i);return x.saveRoles(n),n})},_t=(s,t)=>{u&&$e(a=>{const n=a.map(c=>c.id===s?{...c,role:t}:c),i=n.find(c=>c.id===s);return i&&x.saveProfile(i),n})},$t=(s,t)=>{if(!u)return;const a=!t;x.updateUserStatus(s,a),$e(n=>n.map(i=>i.id===s?{...i,active:a}:i)),ve(n=>n&&n.id===s?{...n,active:a}:n)},Tt=()=>{const s=["ID","Name","Phone","Role","Status","Address","Community ID","Household Size"],t=_e.map(o=>[o.id,'"'.concat(o.fullName.replace(/"/g,'""'),'"'),o.phone,o.role,o.active?"Active":"Inactive",'"'.concat(o.address.replace(/"/g,'""'),'"'),o.communityId||"N/A",o.householdMembers]),a=[s.join(","),...t.map(o=>o.join(","))].join("\n"),n=new Blob([a],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(n),c=document.createElement("a");c.href=i,c.setAttribute("download","AERA_User_Directory_".concat(new Date().toISOString().split("T")[0],".csv")),document.body.appendChild(c),c.click(),document.body.removeChild(c)},Vt=(s,t)=>{const a=!t;x.updateOrgStatus(s,a),ye(n=>n.map(i=>i.id===s?{...i,active:a}:i)),p&&p.id===s&&we(n=>n?{...n,active:a}:null)},Bt=()=>{x.updateSystemTicker(Ms),alert("Global System Alert Updated")},Ft=s=>{x.clearOrgBroadcast(s),ye(t=>t.map(a=>a.id===s?{...a,currentBroadcast:void 0}:a))},es=s=>{C(t=>{const a={...t,language:s};return x.saveProfile(a),a}),W(!0),setTimeout(()=>W(!1),1e3)},Ht=s=>{x.updateReplenishmentRequestStatus(s,"FULFILLED"),Se(t=>t.map(a=>a.id===s?{...a,status:"FULFILLED"}:a))},Gt=s=>{x.updateReplenishmentRequestStatus(s,"PENDING"),Se(t=>t.map(a=>a.id===s?{...a,status:"PENDING"}:a))},Fs=s=>{fs({}),Fe(s)},ss=(s,t)=>{fs(a=>({...a,[s]:t}))},Hs=(s,t)=>{if(f){x.signReplenishmentRequest(f.id,s,t);const a={...f};t==="RELEASE"?(a.signature=s,a.signedAt=new Date().toISOString()):(a.receivedSignature=s,a.receivedAt=new Date().toISOString()),Fe(a),Se(n=>n.map(i=>i.id===f.id?a:i))}},qt=()=>{const s=["Request ID","Org Name","Org ID","Item","Quantity","Status","Date","Provider","Released","Received"],t=ie.map(o=>[o.id,'"'.concat(o.orgName.replace(/"/g,'""'),'"'),o.orgId,'"'.concat(o.item.replace(/"/g,'""'),'"'),o.quantity,o.status,new Date(o.timestamp).toLocaleDateString(),'"'.concat(o.provider.replace(/"/g,'""'),'"'),o.signature?"Yes":"No",o.receivedSignature?"Yes":"No"]),a=[s.join(","),...t.map(o=>o.join(","))].join("\n"),n=new Blob([a],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(n),c=document.createElement("a");c.href=i,c.setAttribute("download","AERA_Master_Inventory_".concat(new Date().toISOString().split("T")[0],".csv")),document.body.appendChild(c),c.click(),document.body.removeChild(c)},Yt=()=>{const s=ie.reduce((Y,me)=>(Y[me.item]=(Y[me.item]||0)+me.quantity,Y),{}),t=["Item Name","Total Quantity"],a=Object.entries(s).map(([Y,me])=>['"'.concat(Y.replace(/"/g,'""'),'"'),me]),n=[t.join(","),...a.map(Y=>Y.join(","))].join("\n"),i=new Blob([n],{type:"text/csv;charset=utf-8;"}),c=URL.createObjectURL(i),o=document.createElement("a");o.href=c,o.setAttribute("download","AERA_Inventory_Tally_".concat(new Date().toISOString().split("T")[0],".csv")),document.body.appendChild(o),o.click(),document.body.removeChild(o)};if(f){const s=x.getOrganization(f.orgId);return e.jsxs("div",{className:"fixed inset-0 z-[100] overflow-y-auto bg-white p-8 font-serif text-black animate-fade-in print:p-0 print:bg-white print:text-black print:static print:overflow-visible",children:[e.jsxs("div",{className:"fixed top-0 left-0 right-0 p-4 bg-slate-900 text-white flex justify-between items-center print:hidden shadow-lg z-50",children:[e.jsx("span",{className:"font-bold",children:"Work Order Preview"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{size:"sm",className:"bg-brand-600 text-white",onClick:()=>window.print(),children:[e.jsx(ds,{size:16,className:"mr-2"})," Print Now"]}),e.jsxs(d,{size:"sm",variant:"secondary",onClick:()=>Fe(null),children:[e.jsx(ia,{size:16,className:"mr-2"})," Close"]})]})]}),e.jsxs("div",{className:"max-w-3xl mx-auto border border-black p-8 mt-16 print:mt-0 print:border-0 print:w-full",children:[e.jsxs("div",{className:"flex justify-between items-start border-b-2 border-black pb-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold uppercase tracking-tight",children:"Work Order"}),e.jsx("p",{className:"text-sm font-bold uppercase mt-1",children:"AERA Logistics Fulfillment"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Order ID:"})," ",f.id]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Printed On:"})," ",new Date().toLocaleDateString()]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Request Date:"})," ",new Date(f.timestamp).toLocaleDateString()]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Provider:"})," ",f.provider]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-8 mb-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold uppercase border-b border-black mb-2 text-sm",children:"Ship To (Organization)"}),e.jsx("p",{className:"text-lg font-bold",children:f.orgName}),e.jsx("p",{children:(s==null?void 0:s.address)||"Address Unknown"}),e.jsx("p",{children:s==null?void 0:s.adminContact}),e.jsx("p",{children:s==null?void 0:s.adminPhone}),e.jsxs("p",{className:"mt-2 text-sm font-mono",children:["ID: ",f.orgId]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold uppercase border-b border-black mb-2 text-sm",children:"Fulfillment Instructions"}),e.jsx("p",{className:"text-sm mb-2",children:"Please pick and pack the items listed below. Ensure quality check is performed before release."}),e.jsxs("div",{className:"border border-black p-2 text-center mt-4",children:[e.jsx("p",{className:"text-xs uppercase font-bold",children:"Priority Status"}),e.jsx("p",{className:"text-xl font-bold",children:"URGENT"})]})]})]}),e.jsx("div",{className:"mb-12",children:e.jsxs("table",{className:"w-full border-collapse border border-black",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-slate-100 print:bg-slate-200",children:[e.jsx("th",{className:"border border-black p-2 text-left w-12 print:text-black",children:"#"}),e.jsx("th",{className:"border border-black p-2 text-left print:text-black",children:"Requested Item"}),e.jsx("th",{className:"border border-black p-2 text-center w-24 print:text-black",children:"Qty Req"}),e.jsx("th",{className:"border border-black p-2 text-center w-28 print:text-black",children:"Qty Picked"}),e.jsx("th",{className:"border border-black p-2 text-center w-28 print:text-black",children:"Verified"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"border border-black p-3 text-center print:text-black",children:"1"}),e.jsx("td",{className:"border border-black p-3 font-bold text-lg print:text-black",children:f.item}),e.jsx("td",{className:"border border-black p-3 text-center font-bold text-lg print:text-black",children:f.quantity}),e.jsx("td",{className:"border border-black p-1",children:e.jsx("input",{className:"w-full h-full text-center font-bold text-lg bg-yellow-50/50 hover:bg-yellow-50 focus:bg-white outline-none transition-colors print:bg-transparent print:border-none",placeholder:"",value:He.item_picked||"",onChange:t=>ss("item_picked",t.target.value)})}),e.jsx("td",{className:"border border-black p-1",children:e.jsx("input",{className:"w-full h-full text-center font-medium text-lg bg-yellow-50/50 hover:bg-yellow-50 focus:bg-white outline-none transition-colors print:bg-transparent print:border-none",placeholder:"",value:He.item_verified||"",onChange:t=>ss("item_verified",t.target.value)})})]}),[2,3].map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-black p-3 text-center opacity-50 print:text-black",children:t}),e.jsx("td",{className:"border border-black p-2",children:e.jsxs("div",{className:"flex items-center gap-2 h-full",children:[e.jsx("span",{className:"italic text-slate-500 text-sm whitespace-nowrap print:text-black",children:"Notes/Substitutions:"}),e.jsx("input",{className:"flex-1 bg-transparent border-b border-slate-300 focus:border-blue-500 outline-none text-slate-900 print:border-none print:text-black font-mono",value:He["note_".concat(t)]||"",onChange:a=>ss("note_".concat(t),a.target.value)})]})}),e.jsx("td",{className:"border border-black p-3"}),e.jsx("td",{className:"border border-black p-3"}),e.jsx("td",{className:"border border-black p-3"})]},t))]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-12 mt-12 pt-12",children:[e.jsxs("div",{className:"break-inside-avoid",children:[e.jsx("p",{className:"text-xs font-bold uppercase mb-2",children:"Released By (Signature)"}),f.signature?e.jsxs("div",{className:"border border-slate-200 p-2 print:border-none",children:[e.jsx("img",{src:f.signature,alt:"Digital Signature",className:"h-16 mb-1"}),e.jsxs("p",{className:"text-[10px] text-slate-500 font-mono print:text-black",children:["Signed: ",new Date(f.signedAt||"").toLocaleString()]})]}):e.jsx("div",{className:"print:hidden",children:e.jsx(nt,{onSave:t=>Hs(t,"RELEASE")})}),!f.signature&&e.jsx("div",{className:"hidden print:block border-b border-black mb-2 h-16"})]}),e.jsxs("div",{className:"break-inside-avoid",children:[e.jsx("p",{className:"text-xs font-bold uppercase mb-2",children:"Received By (Signature)"}),f.receivedSignature?e.jsxs("div",{className:"border border-slate-200 p-2 print:border-none",children:[e.jsx("img",{src:f.receivedSignature,alt:"Digital Signature",className:"h-16 mb-1"}),e.jsxs("p",{className:"text-[10px] text-slate-500 font-mono print:text-black",children:["Signed: ",new Date(f.receivedAt||"").toLocaleString()]})]}):e.jsx("div",{className:"print:hidden",children:e.jsx(nt,{onSave:t=>Hs(t,"RECEIVE")})}),!f.receivedSignature&&e.jsx("div",{className:"hidden print:block border-b border-black mb-2 h-16"})]})]}),e.jsx("div",{className:"text-center mt-12 text-xs text-slate-500 print:text-black",children:e.jsxs("p",{children:["Generated by AERA System • ",new Date().toLocaleString()]})})]})]})}if(V==="MASTER_INVENTORY"){const s=ie.reduce((t,a)=>(t[a.item]=(t[a.item]||0)+a.quantity,t),{});return e.jsxs("div",{className:"p-6 pb-28 space-y-6 animate-fade-in bg-white min-h-screen print:p-0 print:pb-0",children:[e.jsx("div",{className:"flex items-center justify-between border-b border-slate-200 pb-4 sticky top-0 bg-white z-10 print:hidden",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>R("MAIN"),className:"p-2 -ml-2 text-slate-500 hover:text-slate-800",children:e.jsx(T,{size:24})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-slate-900",children:"Master Inventory Database"}),e.jsx("p",{className:"text-xs text-slate-500",children:"System-Wide Supply Request Aggregation"})]})]})}),e.jsxs("div",{className:"hidden print:block mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"AERA Master Inventory Report"}),e.jsxs("p",{className:"text-sm text-slate-500",children:["Generated on ",new Date().toLocaleString()]})]}),e.jsxs("div",{className:"space-y-4 print:break-inside-avoid",children:[e.jsxs("div",{className:"flex justify-between items-end border-b-2 border-slate-900 pb-1",children:[e.jsx("h3",{className:"font-bold text-slate-900 uppercase tracking-wider",children:"Total Tally (All Organizations)"}),e.jsxs("button",{onClick:Yt,className:"text-xs font-bold text-brand-600 hover:text-brand-700 flex items-center gap-1 print:hidden",children:[e.jsx(ls,{size:14})," Export Tally CSV"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[Object.entries(s).map(([t,a])=>e.jsxs("div",{className:"bg-slate-50 border border-slate-200 p-4 rounded-lg print:border-black print:bg-white print:border",children:[e.jsx("p",{className:"text-xs font-bold text-slate-500 uppercase",children:t}),e.jsx("p",{className:"text-2xl font-mono font-bold text-slate-900",children:a})]},t)),Object.keys(s).length===0&&e.jsx("p",{className:"text-slate-500 italic",children:"No requests logged."})]})]}),e.jsxs("div",{className:"space-y-4 mt-8",children:[e.jsxs("div",{className:"flex justify-between items-end border-b-2 border-slate-900 pb-1",children:[e.jsx("h3",{className:"font-bold text-slate-900 uppercase tracking-wider",children:"Request Log"}),e.jsxs(d,{size:"sm",variant:"outline",className:"border-slate-300 text-slate-900 hover:bg-slate-50 print:hidden h-8",onClick:qt,children:[e.jsx(ls,{size:14,className:"mr-2"})," Export Log CSV"]})]}),e.jsx("div",{className:"overflow-x-auto print:overflow-visible",children:e.jsxs("table",{className:"w-full text-left text-sm print:text-xs",children:[e.jsx("thead",{className:"print:table-header-group",children:e.jsxs("tr",{className:"bg-slate-100 print:bg-slate-200",children:[e.jsx("th",{className:"p-3 font-bold text-slate-700",children:"Organization"}),e.jsx("th",{className:"p-3 font-bold text-slate-700",children:"Item"}),e.jsx("th",{className:"p-3 font-bold text-slate-700",children:"Qty"}),e.jsx("th",{className:"p-3 font-bold text-slate-700",children:"Date"}),e.jsx("th",{className:"p-3 font-bold text-slate-700",children:"Status"}),e.jsx("th",{className:"p-3 font-bold text-slate-700 print:hidden",children:"Action"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-200",children:[ie.map(t=>e.jsxs("tr",{className:"print:break-inside-avoid",children:[e.jsxs("td",{className:"p-3 font-medium text-slate-900",children:[t.orgName," ",e.jsx("span",{className:"text-xs text-slate-500 block",children:t.orgId})]}),e.jsx("td",{className:"p-3 text-slate-700",children:t.item}),e.jsx("td",{className:"p-3 font-mono font-bold text-slate-900",children:t.quantity}),e.jsx("td",{className:"p-3 text-slate-500",children:new Date(t.timestamp).toLocaleDateString()}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:"px-2 py-1 rounded text-xs font-bold ".concat(t.status==="FULFILLED"?"bg-green-100 text-green-700 print:border print:border-black":"bg-yellow-100 text-yellow-700 print:border print:border-black"),children:t.status})}),e.jsx("td",{className:"p-3 print:hidden",children:e.jsx("div",{className:"flex flex-col gap-2",children:t.status==="PENDING"?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{size:"sm",onClick:()=>Ht(t.id),className:"bg-green-600 hover:bg-green-700 text-xs py-1 h-8",children:[e.jsx(Da,{size:14,className:"mr-1"})," Fulfill"]}),e.jsx(d,{size:"sm",variant:"outline",onClick:()=>Fs(t),className:"text-xs py-1 h-8 px-2 border-slate-300",title:t.signature?"Print Work Order":"Sign Work Order",children:t.signature&&t.receivedSignature?e.jsx(ds,{size:14}):e.jsx(Ca,{size:14})})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{size:"sm",variant:"outline",onClick:()=>Fs(t),className:"text-xs py-1 h-8 px-2 border-slate-300 mr-2",title:"View Signed Order",children:t.signature&&t.receivedSignature?e.jsx(Js,{size:14,className:"text-green-600"}):e.jsx(ds,{size:14})}),e.jsxs("button",{onClick:()=>Gt(t.id),className:"text-xs text-slate-400 hover:text-blue-600 hover:underline flex items-center gap-0.5",title:"Undo Completion",children:[e.jsx(Aa,{size:10})," Undo"]})]})})})]},t.id)),ie.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"p-4 text-center text-slate-500",children:"No requests found."})})]})]})})]}),e.jsx("div",{className:"hidden print:block mt-8 pt-4 border-t border-slate-300 text-center text-xs text-slate-500 fixed bottom-0 left-0 right-0",children:e.jsx("p",{children:"End of Report • AERA System"})})]})}if(V==="BROADCAST_CONTROL")return e.jsxs("div",{className:"p-6 pb-28 space-y-6 animate-fade-in bg-slate-50 min-h-screen",children:[e.jsxs("div",{className:"flex items-center gap-3 border-b border-slate-200 pb-4 sticky top-0 bg-slate-50 z-10",children:[e.jsx("button",{onClick:()=>R("MAIN"),className:"p-2 -ml-2 text-slate-500 hover:text-slate-800",children:e.jsx(T,{size:24})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-slate-900",children:"Broadcast Control"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Manage System & Organization Alerts"})]})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 p-4 rounded-xl shadow-sm",children:[e.jsxs("h3",{className:"font-bold text-red-900 mb-2 flex items-center gap-2",children:[e.jsx(oa,{size:18})," Global System Alert"]}),e.jsx("p",{className:"text-xs text-red-700 mb-3",children:"This message overrides ALL organization broadcasts and is visible to every user."}),e.jsx(Ys,{className:"bg-white border-red-200 mb-3",value:Ms,onChange:s=>Je(s.target.value),placeholder:"Enter high-priority system alert..."}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(d,{size:"sm",variant:"ghost",onClick:()=>Je(""),className:"text-slate-500",children:"Clear"}),e.jsx(d,{size:"sm",className:"bg-red-600 hover:bg-red-700",onClick:Bt,children:"Update Global Alert"})]})]}),e.jsx("h3",{className:"font-bold text-slate-900 mt-4",children:"Active Organization Broadcasts"}),e.jsxs("div",{className:"space-y-3",children:[Te.filter(s=>s.currentBroadcast).map(s=>e.jsxs("div",{className:"bg-white border border-slate-200 p-4 rounded-xl shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("div",{className:"font-bold text-slate-900",children:s.name}),e.jsx("button",{onClick:()=>Ft(s.id),className:"text-xs text-red-600 font-bold hover:underline",children:"Remove"})]}),e.jsxs("div",{className:"bg-slate-50 p-3 rounded text-sm text-slate-700 italic",children:['"',s.currentBroadcast,'"']}),e.jsxs("div",{className:"text-xs text-slate-400 mt-2 text-right",children:["Last Updated: ",new Date(s.lastBroadcastTime||"").toLocaleString()]})]},s.id)),Te.filter(s=>s.currentBroadcast).length===0&&e.jsx("p",{className:"text-center text-slate-400 py-4 italic",children:"No active organization broadcasts."})]})]});if(V==="DB_VIEWER")return e.jsxs("div",{className:"p-6 pb-28 space-y-6 animate-fade-in bg-slate-900 min-h-screen text-slate-300 font-mono",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-slate-700 pb-4 sticky top-0 bg-slate-900 z-10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>R("MAIN"),className:"p-2 -ml-2 text-slate-400 hover:text-white",children:e.jsx(T,{size:24})}),e.jsx("h1",{className:"text-xl font-bold text-white",children:"Database Viewer"})]}),e.jsxs(d,{size:"sm",variant:"ghost",className:"text-brand-400 hover:text-brand-300 hover:bg-slate-800",onClick:()=>Re(JSON.stringify(S,null,2)),children:[e.jsx(pe,{size:16,className:"mr-2"})," Copy JSON"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-slate-800 p-4 rounded-xl border border-slate-700 overflow-hidden",children:[e.jsxs("h3",{className:"text-brand-400 font-bold mb-2",children:["Users (",S==null?void 0:S.users.length,")"]}),e.jsx("pre",{className:"text-xs overflow-auto max-h-60 text-slate-300",children:JSON.stringify(S==null?void 0:S.users,null,2)})]}),e.jsxs("div",{className:"bg-slate-800 p-4 rounded-xl border border-slate-700 overflow-hidden",children:[e.jsxs("h3",{className:"text-purple-400 font-bold mb-2",children:["Organizations (",S==null?void 0:S.organizations.length,")"]}),e.jsx("div",{className:"space-y-2",children:S==null?void 0:S.organizations.map(s=>e.jsxs("div",{className:"p-2 bg-slate-900 rounded border border-slate-600 flex justify-between",children:[e.jsx("span",{children:s.name}),e.jsx("span",{className:"text-purple-300 select-all font-bold",children:s.id})]},s.id))})]})]})]});if(V==="ORG_DIRECTORY"){const s=Te.filter(t=>t.name.toLowerCase().includes(re.toLowerCase())||t.id.toLowerCase().includes(re.toLowerCase())||t.type.toLowerCase().includes(re.toLowerCase()));return e.jsxs("div",{className:"p-6 pb-28 space-y-6 animate-fade-in bg-slate-50 min-h-screen",children:[e.jsx("div",{className:"flex items-center justify-between border-b border-slate-200 pb-4 sticky top-0 bg-slate-50 z-10",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>R("MAIN"),className:"p-2 -ml-2 text-slate-500 hover:text-slate-800",children:e.jsx(T,{size:24})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-slate-900",children:"Organization Directory"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Search and View Registered Hubs"})]})]})}),p?e.jsxs("div",{className:"animate-slide-up space-y-6",children:[e.jsxs(d,{variant:"ghost",onClick:()=>we(null),className:"pl-0 text-slate-500",children:[e.jsx(T,{size:16,className:"mr-1"})," Back to list"]}),e.jsxs("div",{className:"bg-white rounded-2xl border ".concat(p.active?"border-slate-200":"border-red-300"," shadow-lg overflow-hidden"),children:[e.jsx("div",{className:"".concat(p.active?"bg-purple-600":"bg-slate-600"," p-6 text-white"),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("span",{className:"inline-block px-2 py-1 bg-white/20 rounded text-xs font-bold border border-white/30",children:p.type}),!p.active&&e.jsx("span",{className:"inline-block px-2 py-1 bg-red-500 rounded text-xs font-bold",children:"SUSPENDED"})]}),e.jsx("h2",{className:"text-2xl font-bold",children:p.name}),e.jsxs("p",{className:"flex items-center gap-1 text-white/80 text-sm mt-1",children:[e.jsx(rs,{size:14})," ",p.verified?"Verified Partner":"Unverified"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-white/60 font-bold uppercase tracking-wider",children:"Community ID"}),e.jsx("p",{className:"text-3xl font-mono font-black tracking-widest",children:p.id})]})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-bold text-slate-900 border-b border-slate-100 pb-2",children:"Location & Contact"}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ks,{className:"text-slate-400 mt-1",size:18}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-slate-900",children:"Address"}),e.jsx("p",{className:"text-sm text-slate-600",children:p.address})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(is,{className:"text-slate-400 mt-1",size:18}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-slate-900",children:"Admin"}),e.jsx("p",{className:"text-sm text-slate-600",children:p.adminContact}),e.jsx("p",{className:"text-xs text-slate-500",children:p.adminPhone})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-bold text-slate-900 border-b border-slate-100 pb-2",children:"Logistics Profile"}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(da,{className:"text-slate-400 mt-1",size:18}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-slate-900",children:"Replenishment Provider"}),e.jsx("p",{className:"text-sm text-slate-600",children:p.replenishmentProvider})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ca,{className:"text-slate-400 mt-1",size:18}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-slate-900",children:"Supply Email"}),e.jsx("p",{className:"text-sm text-slate-600 break-all",children:p.replenishmentEmail||"N/A"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(os,{className:"text-slate-400 mt-1",size:18}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-slate-900",children:"Supply Phone"}),e.jsx("p",{className:"text-sm text-slate-600",children:p.replenishmentPhone||"N/A"})]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"font-bold text-slate-900 border-b border-slate-100 pb-2 flex items-center gap-2",children:[e.jsx(ns,{size:18,className:"text-slate-400"})," Registered Members (",Ve.length,")",ut&&e.jsx("span",{className:"text-[11px] text-amber-600 font-semibold",children:"Using cached list"})]}),Ve.length===0?e.jsx("p",{className:"text-slate-500 text-sm italic",children:"No members linked yet."}):e.jsx("div",{className:"max-h-60 overflow-y-auto space-y-2 border border-slate-100 rounded-lg p-2 bg-slate-50",children:Ve.map(t=>e.jsxs("div",{className:"bg-white p-3 rounded-lg border border-slate-200 flex justify-between items-center shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center font-bold text-xs text-white ".concat(t.status==="SAFE"?"bg-green-500":t.status==="DANGER"?"bg-red-500":"bg-slate-400"),children:t.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-slate-900",children:t.name}),e.jsx("p",{className:"text-[10px] text-slate-500",children:t.phone})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded font-bold uppercase ".concat(t.status==="SAFE"?"bg-green-100 text-green-700":t.status==="DANGER"?"bg-red-100 text-red-700":"bg-slate-200 text-slate-600"),children:t.status})})]},t.id))})]})]}),e.jsxs("div",{className:"bg-slate-50 p-4 border-t border-slate-200 flex justify-between items-center",children:[e.jsx(d,{size:"sm",variant:p.active?"danger":"primary",onClick:()=>Vt(p.id,p.active),className:p.active?"bg-red-50 text-red-600 border border-red-200 hover:bg-red-100":"bg-green-600 text-white",children:p.active?e.jsxs(e.Fragment,{children:[e.jsx(pa,{size:16,className:"mr-2"})," Deactivate Org"]}):e.jsxs(e.Fragment,{children:[e.jsx(Js,{size:16,className:"mr-2"})," Activate Org"]})}),e.jsxs(d,{size:"sm",variant:"outline",onClick:()=>Re(p.id),children:[e.jsx(pe,{size:16,className:"mr-2"})," Copy Code"]})]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Qs,{className:"absolute left-3 top-3.5 text-slate-400",size:20}),e.jsx(I,{className:"pl-10",placeholder:"Search by Name, Type, or ID...",value:re,onChange:t=>ht(t.target.value)})]}),e.jsx("div",{className:"space-y-3",children:s.length===0?e.jsxs("div",{className:"text-center py-10 text-slate-400",children:[e.jsx(Le,{size:48,className:"mx-auto mb-2 opacity-20"}),e.jsxs("p",{children:['No organizations found matching "',re,'"']})]}):s.map(t=>e.jsxs("button",{onClick:()=>we(t),className:"w-full bg-white p-4 rounded-xl border shadow-sm hover:shadow-md transition-all text-left flex justify-between items-center group ".concat(t.active?"border-slate-200 hover:border-purple-300":"border-red-200 bg-red-50/30"),children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center font-bold text-lg border ".concat(t.active?"bg-purple-50 text-purple-600 border-purple-100":"bg-slate-200 text-slate-500 border-slate-300"),children:t.name.charAt(0)}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold transition-colors ".concat(t.active?"text-slate-900 group-hover:text-purple-700":"text-slate-500"),children:[t.name," ",!t.active&&e.jsx("span",{className:"text-[10px] text-red-500 ml-2 font-bold uppercase",children:"(Inactive)"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500",children:[e.jsx("span",{className:"bg-slate-100 px-1.5 py-0.5 rounded border border-slate-200",children:t.type}),e.jsx("span",{className:"font-mono",children:t.id})]})]})]}),e.jsx(Zs,{size:20,className:"text-slate-300 group-hover:text-purple-500"})]},t.id))})]})]})}if(V==="ACCESS_CONTROL"){const s=Array.isArray(_e)?_e:[],t=s.filter(a=>{const n=(a.fullName||"").toLowerCase(),i=(a.phone||"").toLowerCase(),c=(a.role||"").toLowerCase(),o=bs.toLowerCase();return n.includes(o)||i.includes(o)||c.includes(o)});return m?e.jsxs("div",{className:"p-6 pb-28 space-y-6 animate-fade-in bg-slate-50 min-h-screen",children:[e.jsxs("div",{className:"flex items-center gap-3 border-b border-slate-200 pb-4 sticky top-0 bg-slate-50 z-10",children:[e.jsx("button",{onClick:()=>ve(null),className:"p-2 -ml-2 text-slate-500 hover:text-slate-800",children:e.jsx(T,{size:24})}),e.jsx("h1",{className:"text-xl font-bold text-slate-900",children:"User Profile"})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden animate-slide-up",children:[e.jsxs("div",{className:"bg-slate-800 p-6 text-white flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-slate-600 flex items-center justify-center text-2xl font-bold border-2 border-slate-500",children:(m.fullName||"?").charAt(0)}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:m.fullName||"Unnamed User"}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx("span",{className:"px-2 py-0.5 bg-white/20 rounded text-xs font-bold uppercase",children:(m.role||"UNKNOWN").replace("_"," ")}),e.jsx("span",{className:"px-2 py-0.5 rounded text-xs font-bold uppercase ".concat(m.active?"bg-green-500 text-white":"bg-red-500 text-white"),children:m.active?"Active":"Suspended"})]})]})]}),e.jsxs("div",{className:"text-right text-xs opacity-60 font-mono",children:["ID: ",m.id]})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"font-bold text-slate-900 border-b border-slate-100 pb-2 flex items-center gap-2",children:[e.jsx(os,{size:16,className:"text-slate-400"})," Contact Details"]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 font-bold uppercase",children:"Mobile Phone"}),e.jsx("a",{href:"tel:".concat(m.phone),className:"text-blue-600 font-bold hover:underline",children:m.phone})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 font-bold uppercase",children:"Home Address"}),e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx(Ks,{size:14,className:"mt-0.5 text-slate-400"}),e.jsx("p",{className:"text-slate-900",children:m.address||"Not Provided"})]})]}),m.communityId&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 font-bold uppercase",children:"Community Connection"}),e.jsx("p",{className:"text-purple-700 font-bold bg-purple-50 px-2 py-1 rounded w-fit text-sm mt-1",children:m.communityId})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"font-bold text-slate-900 border-b border-slate-100 pb-2 flex items-center gap-2",children:[e.jsx(Xs,{size:16,className:"text-slate-400"})," Emergency Profile"]}),m.medicalNeeds&&e.jsxs("div",{className:"bg-red-50 p-3 rounded-lg border border-red-100",children:[e.jsx("p",{className:"text-xs text-red-600 font-bold uppercase mb-1",children:"Medical Needs"}),e.jsx("p",{className:"text-red-900 font-medium text-sm",children:m.medicalNeeds})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 font-bold uppercase",children:"Household"}),e.jsxs("p",{className:"text-slate-900 font-bold text-lg",children:[m.householdMembers," Member(s)"]}),Array.isArray(m.household)&&m.household.length>0&&e.jsx("div",{className:"mt-2 space-y-1",children:m.household.map(a=>e.jsxs("div",{className:"text-xs bg-slate-100 p-2 rounded flex justify-between",children:[e.jsx("span",{className:"font-bold",children:a.name}),e.jsxs("span",{className:"text-slate-500",children:[a.age," • ",a.needs||"No needs"]})]},a.id))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 font-bold uppercase",children:"Emergency Contact"}),e.jsxs("p",{className:"text-slate-900 text-sm font-medium",children:[m.emergencyContactName," ",e.jsxs("span",{className:"text-slate-500",children:["(",m.emergencyContactRelation,")"]})]}),e.jsx("a",{href:"tel:".concat(m.emergencyContactPhone),className:"text-sm font-bold text-slate-700",children:m.emergencyContactPhone})]})]})]}),e.jsxs("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-200 mt-4 space-y-4",children:[e.jsx("h3",{className:"font-bold text-slate-900 text-sm uppercase tracking-wider",children:"Account Management"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"System Role"}),e.jsx("select",{value:m.role,onChange:a=>_t(m.id,a.target.value),className:"text-sm p-2 rounded border bg-white font-medium ".concat(m.active?"border-slate-300":"opacity-50 cursor-not-allowed"),disabled:!m.active,children:ps.map(a=>e.jsx("option",{value:a.id,children:a.label},a.id))})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-slate-200",children:[e.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Account Status"}),e.jsx(d,{size:"sm",onClick:()=>$t(m.id,m.active!==!1),className:m.active?"bg-red-100 text-red-700 hover:bg-red-200 border-red-200":"bg-green-600 text-white",children:m.active?"Suspend Account":"Activate Account"})]})]})]})]})]}):e.jsxs("div",{className:"p-6 pb-28 space-y-6 animate-fade-in bg-slate-50 min-h-screen",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-slate-200 pb-4 sticky top-0 bg-slate-50 z-10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>R("MAIN"),className:"p-2 -ml-2 text-slate-500 hover:text-slate-800",children:e.jsx(T,{size:24})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-slate-900",children:"User Directory"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Manage All Registered Users & Permissions"})]})]}),e.jsxs(d,{size:"sm",variant:"outline",className:"border-slate-300 text-slate-900 hover:bg-slate-100 h-9",onClick:Tt,children:[e.jsx(ls,{size:16,className:"mr-2"})," Export CSV"]})]}),e.jsxs("div",{className:"flex bg-white rounded-lg p-1 border border-slate-200",children:[e.jsxs("button",{onClick:()=>Ue("ALL_USERS"),className:"flex-1 py-2 text-sm font-bold rounded-md transition-all ".concat(Ne==="ALL_USERS"?"bg-slate-800 text-white shadow":"text-slate-500 hover:text-slate-900"),children:["All Users (",s.length,")"]}),e.jsx("button",{onClick:()=>Ue("ROLE_DEFINITIONS"),className:"flex-1 py-2 text-sm font-bold rounded-md transition-all ".concat(Ne==="ROLE_DEFINITIONS"?"bg-slate-800 text-white shadow":"text-slate-500 hover:text-slate-900"),children:"Role Definitions"})]}),Ne==="ROLE_DEFINITIONS"&&e.jsx("div",{className:"space-y-4",children:ps.map(a=>e.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"p-4 bg-slate-50 border-b border-slate-100",children:[e.jsx("h3",{className:"font-bold text-slate-900",children:a.label}),e.jsx("p",{className:"text-xs text-slate-500",children:a.description})]}),e.jsx("div",{className:"p-4 space-y-3",children:Object.entries(a.permissions).map(([n,i])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-slate-700 capitalize",children:n.replace("can","").replace(/([A-Z])/g," $1").trim()}),e.jsx("button",{onClick:()=>Ut(a.id,n),className:"w-10 h-5 rounded-full relative transition-colors ".concat(i?"bg-green-500":"bg-slate-300"),children:e.jsx("div",{className:"absolute top-0.5 w-4 h-4 bg-white rounded-full transition-transform shadow-sm ".concat(i?"left-[22px]":"left-0.5")})})]},n))})]},a.id))}),Ne==="ALL_USERS"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Qs,{className:"absolute left-3 top-3.5 text-slate-400",size:18}),e.jsx(I,{className:"pl-10 h-10",placeholder:"Search users by name, phone, or role...",value:bs,onChange:a=>xt(a.target.value)})]}),t.map(a=>{const n=a.createdAt?new Date(a.createdAt).toLocaleDateString():"Unknown";return e.jsxs("div",{onClick:()=>ve(a),className:"bg-white p-4 rounded-xl border shadow-sm flex flex-col gap-3 cursor-pointer hover:border-brand-400 hover:shadow-md transition-all group ".concat(a.active?"border-slate-200":"border-red-200 bg-red-50/10"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-full ".concat(a.active?"bg-slate-100 text-slate-600":"bg-red-100 text-red-500"),children:e.jsx(is,{size:18})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold group-hover:text-brand-700 transition-colors ".concat(a.active?"text-slate-900":"text-slate-500 line-through"),children:a.fullName||"Unnamed User"}),e.jsxs("p",{className:"text-xs text-slate-500",children:[a.phone||"No phone"," ",a.role==="ADMIN"&&e.jsx("span",{className:"text-brand-600 font-bold ml-1",children:"(Admin)"})]}),e.jsxs("p",{className:"text-[11px] text-slate-400",children:["Created: ",n]})]})]}),e.jsx(Zs,{size:18,className:"text-slate-300 group-hover:text-brand-500"})]}),e.jsxs("div",{className:"pt-3 border-t border-slate-100 flex justify-between items-center",children:[e.jsxs("span",{className:"text-[10px] font-bold uppercase ".concat(a.active?"text-green-600":"text-red-600"),children:["Status: ",a.active?"Active":"Deactivated"]}),e.jsx("span",{className:"text-xs px-2 py-1 bg-slate-100 rounded text-slate-600 font-medium",children:(a.role||"UNKNOWN").replace("_"," ")})]})]},a.id)}),t.length===0&&e.jsx("p",{className:"text-center text-slate-400 py-4",children:"No users found."})]})]})}return e.jsxs("div",{className:"p-6 pb-28 space-y-8 animate-fade-in bg-slate-50 min-h-screen flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>v("DASHBOARD"),className:"p-2 -ml-2 text-slate-500 hover:text-slate-800 md:hidden",children:e.jsx(T,{size:24})}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:as("settings.title")})]}),ot&&e.jsxs("span",{className:"text-sm font-medium text-green-600 flex items-center gap-1 animate-fade-in",children:[e.jsx(Me,{size:16})," Saved"]})]}),e.jsxs("section",{className:"bg-white p-4 rounded-2xl shadow-sm border border-slate-200",children:[e.jsx("p",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider mb-3",children:"Quick Jump"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:()=>xe("profile"),className:"min-w-[92px] flex-1 text-[11px] sm:text-xs font-semibold text-slate-700 bg-slate-100 hover:bg-slate-200 rounded-lg px-3 py-2",children:"Profile"}),e.jsx("button",{type:"button",onClick:()=>xe("household"),className:"min-w-[92px] flex-1 text-[11px] sm:text-xs font-semibold text-slate-700 bg-slate-100 hover:bg-slate-200 rounded-lg px-3 py-2",children:"Household"}),e.jsx("button",{type:"button",onClick:()=>xe("contacts"),className:"min-w-[92px] flex-1 text-[11px] sm:text-xs font-semibold text-slate-700 bg-slate-100 hover:bg-slate-200 rounded-lg px-3 py-2",children:"Emergancy Contact"}),e.jsx("button",{type:"button",onClick:()=>xe("community"),className:"min-w-[92px] flex-1 text-[11px] sm:text-xs font-semibold text-slate-700 bg-slate-100 hover:bg-slate-200 rounded-lg px-3 py-2",children:"Community"}),e.jsx("button",{type:"button",onClick:()=>xe("security"),className:"min-w-[92px] flex-1 text-[11px] sm:text-xs font-semibold text-slate-700 bg-slate-100 hover:bg-slate-200 rounded-lg px-3 py-2",children:"Preparedness"})]})]}),e.jsxs("section",{className:"bg-white p-6 rounded-2xl shadow-sm space-y-4 order-10",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsx("div",{className:"p-3 bg-indigo-50 rounded-full text-indigo-600",children:e.jsx(ha,{size:24})}),e.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:as("settings.language")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>es("en"),className:"flex-1 py-3 px-4 rounded-xl border-2 font-bold transition-all ".concat(l.language==="en"?"border-indigo-600 bg-indigo-50 text-indigo-800":"border-slate-200 bg-white text-slate-600 hover:border-slate-300"),children:"English"}),e.jsx("button",{onClick:()=>es("es"),className:"flex-1 py-3 px-4 rounded-xl border-2 font-bold transition-all ".concat(l.language==="es"?"border-indigo-600 bg-indigo-50 text-indigo-800":"border-slate-200 bg-white text-slate-600 hover:border-slate-300"),children:"Español"}),e.jsx("button",{onClick:()=>es("fr"),className:"flex-1 py-3 px-4 rounded-xl border-2 font-bold transition-all ".concat(l.language==="fr"?"border-indigo-600 bg-indigo-50 text-indigo-800":"border-slate-200 bg-white text-slate-600 hover:border-slate-300"),children:"Français"})]})]}),u&&e.jsxs("section",{className:"bg-slate-900 text-white p-6 rounded-2xl shadow-lg relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 p-6 opacity-10",children:e.jsx(rs,{size:80})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-brand-400 font-bold text-xs uppercase tracking-wider",children:[e.jsx(et,{size:12})," Administrator Area"]}),e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Roles & Dashboards"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(d,{onClick:Lt,className:"bg-brand-600 hover:bg-brand-500 text-white border-0 w-full justify-between",children:[e.jsx("span",{children:"User Directory & Access Control"}),e.jsx(ns,{size:18})]}),e.jsxs(d,{onClick:Pt,className:"bg-purple-600 hover:bg-purple-500 text-white border-0 w-full justify-between",children:[e.jsx("span",{children:"Organization Directory"}),e.jsx(Le,{size:18})]}),e.jsxs(d,{onClick:Ot,className:"bg-orange-600 hover:bg-orange-500 text-white border-0 w-full justify-between",children:[e.jsx("span",{children:"Master Inventory Database"}),e.jsx(st,{size:18})]}),e.jsxs(d,{onClick:Mt,className:"bg-red-600 hover:bg-red-500 text-white border-0 w-full justify-between",children:[e.jsx("span",{children:"Manage Broadcasts"}),e.jsx(xa,{size:18})]}),e.jsxs(d,{onClick:Et,variant:"outline",className:"border-slate-700 text-slate-300 hover:text-white hover:bg-slate-800 w-full justify-between",children:[e.jsx("span",{children:"View Raw Database"}),e.jsx(fa,{size:18})]})]})]})]}),e.jsxs("section",{ref:ge,className:"bg-white p-6 rounded-2xl shadow-sm space-y-4",children:[e.jsxs("button",{type:"button",onClick:()=>de("profile"),className:"w-full flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 text-left",children:[e.jsx("div",{className:"p-3 bg-brand-50 rounded-full text-brand-600",children:e.jsx(is,{size:24})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:"Profile"}),e.jsxs("p",{className:"text-xs text-slate-500",children:[l.fullName||"Name not set"," • ",l.phone||"Phone not set"]})]})]}),e.jsx(be,{size:18,className:"text-slate-500 transition-transform ".concat(g.profile?"rotate-180":"")})]}),!g.profile&&e.jsx("p",{className:"text-xs text-slate-500",children:l.address?"Address set • ".concat(l.address):"Address not set yet"}),g.profile&&e.jsxs(e.Fragment,{children:[y.profile&&e.jsxs("div",{className:"text-xs text-slate-400 font-mono -mt-2 mb-1",children:["ID: ",l.id]}),e.jsx(I,{label:"Full Name",value:l.fullName,onChange:s=>N("fullName",s.target.value),placeholder:"e.g. Jane Doe"}),e.jsx(I,{label:"Mobile Phone",value:l.phone,onChange:s=>N("phone",rt(s.target.value)),onBlur:()=>g.profile&&Os(l.phone),placeholder:"e.g. (555) 123-4567",className:hs?"border-red-500 bg-red-50":"",error:hs||void 0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1.5",children:"Home Address"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{placeholder:"123 Main St...",value:l.address,onChange:s=>{U(-1),N("address",s.target.value)},onBlur:jt,onKeyDown:Nt,className:"w-full px-4 py-3 rounded-lg border focus:ring-2 outline-none transition-all font-medium ".concat(M==="VALID"?"border-green-500 bg-green-50 focus:ring-green-500":M==="INVALID"?"border-red-500 bg-red-50 focus:ring-red-500":"border-slate-300 focus:ring-brand-500 focus:border-brand-500")}),F.length>0&&M!=="VERIFYING"&&e.jsx("div",{className:"absolute z-20 mt-1 w-full rounded-lg border border-slate-200 bg-white shadow-lg max-h-56 overflow-auto",children:F.map((s,t)=>e.jsx("button",{type:"button",onMouseDown:a=>a.preventDefault(),onClick:()=>Us(),className:"w-full text-left px-3 py-2 text-sm border-b border-slate-100 last:border-b-0 ".concat(t===us?"bg-slate-100 text-slate-900":"text-slate-700 hover:bg-slate-50"),children:s.description||"Suggested address"},"".concat(s.placeId||"addr","-").concat(t)))})]}),dt&&M!=="VERIFYING"&&e.jsx("p",{className:"text-xs text-slate-500 font-semibold mt-1",children:"Finding address suggestions..."}),M==="VERIFYING"&&e.jsx("p",{className:"text-xs text-slate-500 font-semibold mt-1",children:"Verifying with Google Maps..."}),M==="VALID"&&e.jsx("p",{className:"text-xs text-green-600 font-bold mt-1",children:"Verified with Google Maps"}),M==="INVALID"&&e.jsx("p",{className:"text-xs text-red-600 font-bold mt-1",children:"Address not found on Maps"}),M==="VALID"&&D&&e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Verified on ",D]}),L&&e.jsxs("div",{className:"mt-2 flex items-center justify-between gap-3 rounded-lg border border-amber-200 bg-amber-50 px-3 py-2",children:[e.jsxs("p",{className:"text-xs font-semibold text-amber-800 flex items-center gap-1",children:[e.jsx(et,{size:13})," Address verification required before saving."]}),e.jsx("button",{type:"button",onClick:()=>Qe(l.address),className:"text-xs font-bold text-amber-800 hover:text-amber-900 underline",children:"Retry"})]})]}),e.jsx("button",{type:"button",onClick:()=>ce("profile"),className:"text-xs font-semibold text-brand-600 hover:underline",children:y.profile?"Show less":"Show more"}),vs&&e.jsx("p",{className:"text-xs text-red-600 font-semibold mt-2",children:vs})]})]}),e.jsxs("section",{ref:te,className:"bg-white p-6 rounded-2xl shadow-sm space-y-4",children:[e.jsxs("button",{type:"button",onClick:()=>de("contacts"),className:"w-full flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 text-left",children:[e.jsx("div",{className:"p-3 bg-cyan-50 rounded-full text-cyan-700",children:e.jsx(os,{size:24})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:"Emergancy Contact"}),e.jsx("p",{className:"text-xs text-slate-500",children:l.emergencyContactName?"".concat(l.emergencyContactName," • ").concat(l.emergencyContactPhone||"No phone"):"Emergency contact not set"})]})]}),e.jsx(be,{size:18,className:"text-slate-500 transition-transform ".concat(g.contacts?"rotate-180":"")})]}),g.contacts&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(I,{placeholder:"Contact Name",value:l.emergencyContactName,onChange:s=>N("emergencyContactName",s.target.value)}),e.jsx(I,{placeholder:"Mobile Phone",type:"tel",value:l.emergencyContactPhone,onChange:s=>N("emergencyContactPhone",rt(s.target.value))}),y.contacts&&e.jsx(I,{placeholder:"Relationship",value:l.emergencyContactRelation,onChange:s=>N("emergencyContactRelation",s.target.value)})]}),e.jsx("button",{type:"button",onClick:()=>ce("contacts"),className:"text-xs font-semibold text-brand-600 hover:underline",children:y.contacts?"Show less":"Show more"})]})]}),e.jsxs("section",{ref:fe,className:"bg-white p-6 rounded-2xl shadow-sm space-y-4 border border-emerald-100 order-30",children:[e.jsxs("button",{type:"button",onClick:()=>de("household"),className:"w-full flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 text-left",children:[e.jsx("div",{className:"p-3 bg-emerald-50 rounded-full text-emerald-700",children:e.jsx(ns,{size:24})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:"Household"}),e.jsxs("p",{className:"text-xs text-slate-500",children:[l.householdName||"Your Home"," • ",l.householdCode||"Code not set"]})]})]}),e.jsx(be,{size:18,className:"text-slate-500 transition-transform ".concat(g.household?"rotate-180":"")})]}),!g.household&&e.jsxs("p",{className:"text-xs text-slate-500",children:[(l.household||[]).length," members • Role: ",l.householdRole||"OWNER"]}),g.household&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-emerald-50 border border-emerald-200 rounded-xl p-4 flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-bold text-emerald-700 uppercase tracking-wider",children:"Household Code"}),e.jsx("p",{className:"text-2xl font-mono font-black tracking-widest text-emerald-900",children:l.householdCode||"------"}),e.jsxs("p",{className:"text-xs text-emerald-700 mt-1",children:[l.householdName||"Your Home"," • ",l.householdRole||"OWNER"]})]}),l.householdRole==="OWNER"&&e.jsxs(d,{size:"sm",variant:"ghost",onClick:()=>Re(l.householdCode||""),disabled:!l.householdCode,className:"text-emerald-800 hover:bg-emerald-100",children:[e.jsx(pe,{size:16,className:"mr-2"})," Copy"]})]}),Ye.length>1&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Active Household"}),e.jsx("select",{value:l.householdId||"",onChange:s=>Rt(s.target.value),disabled:pt,className:"w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500",children:Ye.map(s=>e.jsxs("option",{value:s.householdId,children:[s.householdName," (",s.householdCode,") • ",s.householdRole]},s.householdId))}),e.jsx("p",{className:"text-xs text-slate-500",children:"Switch to another linked household context."})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-[1fr_auto] gap-3 items-end",children:[e.jsx(I,{label:"Request Home Join by Code",placeholder:"e.g. A3K7Q2",value:Ie,onChange:s=>ys(s.target.value.toUpperCase()),maxLength:6}),e.jsx(d,{onClick:At,disabled:Cs||Ie.trim().length<6||Ie.includes("-"),children:Cs?"Sending...":"Click Here to Connect"})]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Your request has been sent to the household administrator and requires approval."}),De&&e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-slate-50 p-3",children:[e.jsx("p",{className:"text-[11px] uppercase tracking-wide font-bold text-slate-500",children:"Latest Join Request"}),e.jsxs("p",{className:"text-sm font-semibold text-slate-900 mt-1",children:["Status: ",De.status==="pending"?"Pending Approval":De.status==="approved"?"Approved":"Rejected"]}),e.jsxs("p",{className:"text-[11px] text-slate-500 mt-0.5",children:["Submitted ",new Date(De.createdAt).toLocaleString()]})]}),ws&&e.jsx("p",{className:"text-xs text-red-600 font-semibold",children:ws}),Ss&&e.jsx("p",{className:"text-xs text-emerald-700 font-semibold",children:Ss}),y.household&&l.householdRole==="OWNER"&&e.jsxs("div",{className:"rounded-xl border border-amber-200 bg-amber-50 p-4 space-y-3",children:[e.jsxs("p",{className:"text-xs font-bold text-amber-700 uppercase tracking-wider",children:["New Household Join Request",Xe.length===1?"":"s"]}),Xe.length===0?e.jsx("p",{className:"text-xs text-amber-700",children:"No pending requests."}):e.jsx("div",{className:"space-y-2",children:Xe.map(s=>e.jsxs("div",{className:"rounded-lg border border-amber-200 bg-white p-3 flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900",children:s.requestingUserName||"AERA user"}),e.jsx("p",{className:"text-[11px] text-slate-500",children:s.requestingUserPhone||s.requestingUserEmail||"No contact preview available"}),e.jsxs("p",{className:"text-[11px] text-slate-500 mt-0.5",children:["Requested ",new Date(s.createdAt).toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{size:"sm",className:"bg-emerald-600 hover:bg-emerald-700",onClick:()=>Bs(s,"approved"),disabled:We===s.id,children:We===s.id?"Working...":"Approve"}),e.jsx(d,{size:"sm",variant:"ghost",className:"text-red-600 hover:bg-red-50",onClick:()=>Bs(s,"rejected"),disabled:We===s.id,children:"Reject"})]})]},s.id))})]}),y.household&&l.householdRole==="OWNER"&&e.jsxs("div",{className:"rounded-xl border border-indigo-200 bg-indigo-50 p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-xs font-bold text-indigo-700 uppercase tracking-wider",children:"Notifications"}),e.jsxs(d,{size:"sm",variant:"ghost",className:"text-indigo-700 hover:bg-indigo-100",onClick:Dt,disabled:bt||Vs===0,children:["Mark Read (",Vs,")"]})]}),q.length===0?e.jsx("p",{className:"text-xs text-indigo-700",children:"No notifications yet."}):e.jsx("div",{className:"space-y-1",children:q.slice(0,5).map(s=>{var t,a;return e.jsxs("div",{className:"rounded-md border px-3 py-2 text-xs ".concat(s.read?"border-indigo-100 bg-white text-slate-500":"border-indigo-300 bg-white text-slate-800 font-semibold"),children:[e.jsx("p",{children:s.type==="household_join_request"?"New Household Join Request":s.type==="household_join_approved"?"Your request was approved.":s.type==="household_join_rejected"?"Your request was not approved.":s.type==="household_member_reported_danger"?"".concat(String(((t=s.metadata)==null?void 0:t.reporterName)||"A household member")," reported DANGER."):s.type==="household_member_reported_safe"?"".concat(String(((a=s.metadata)==null?void 0:a.reporterName)||"A household member")," reported SAFE."):s.type}),e.jsx("p",{className:"text-[10px] mt-0.5 opacity-80",children:new Date(s.createdAt).toLocaleString()})]},s.id)})})]}),e.jsxs("div",{children:[e.jsx(I,{label:"Household Size",type:"text",value:String(l.householdMembers||1),readOnly:!0,className:"bg-slate-50"}),e.jsx("p",{className:"text-[11px] text-slate-500 mt-1",children:"Includes you as the first household occupant."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Who lives in your home"}),e.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"Each member requires DOB in MM/DD/YYYY. Young children and seniors are flagged automatically."}),e.jsx(ra,{members:l.household,onChange:s=>N("household",s),readOnly:l.householdRole!=="OWNER",latestSafetyStatusByMember:St})]}),y.household&&l.householdRole==="OWNER"&&e.jsxs("div",{className:"rounded-xl border border-emerald-200 bg-emerald-50 p-4 space-y-3",children:[e.jsx("div",{children:e.jsx("p",{className:"text-xs font-bold text-emerald-700 uppercase tracking-wider",children:"Member Account Invites"})}),Ts.length===0?e.jsx(e.Fragment,{}):e.jsx("div",{className:"space-y-2",children:Ts.map(s=>{var t,a,n;return e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-emerald-200 bg-white p-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900",children:s.name}),e.jsxs("p",{className:"text-xs text-slate-600",children:["Invite Code: ",e.jsx("span",{className:"font-mono font-bold tracking-wider",children:((t=$[s.id])==null?void 0:t.invitationCode)||Ze(s)})]}),e.jsxs("p",{className:"text-[11px] text-slate-500 mt-0.5",children:["Bound phone: ",Ea(((a=$[s.id])==null?void 0:a.inviteePhone)||s.loginPhone||"")||"Not set"]}),!he(s.loginPhone||"")&&e.jsx("p",{className:"text-[11px] text-amber-700 mt-0.5",children:"Add a valid member phone in Household Members before creating an invite."}),$[s.id]&&e.jsxs("p",{className:"text-[11px] text-slate-500 mt-0.5",children:["Status: ",$[s.id].status,$[s.id].expiresAt?" • Expires ".concat(new Date($[s.id].expiresAt).toLocaleDateString()):""]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(d,{size:"sm",variant:"ghost",className:"text-emerald-800 hover:bg-emerald-100",onClick:()=>Ct(s),disabled:oe===s.id||!he(s.loginPhone||""),children:[e.jsx(pe,{size:14,className:"mr-1"})," ",oe===s.id?"Working...":"Share"]}),e.jsx(d,{size:"sm",variant:"ghost",className:"text-slate-700 hover:bg-slate-100",onClick:()=>kt(s),disabled:oe===s.id||!he(s.loginPhone||""),children:oe===s.id?"Working...":"Resend"}),((n=$[s.id])==null?void 0:n.status)==="PENDING"&&e.jsx(d,{size:"sm",variant:"ghost",className:"text-red-600 hover:bg-red-50",onClick:()=>It(s),disabled:oe===s.id,children:"Revoke"})]})]},s.id)})}),As&&e.jsx("p",{className:"text-xs text-emerald-700 font-semibold",children:As}),Rs&&e.jsx("p",{className:"text-xs text-red-600 font-semibold",children:Rs})]}),e.jsx("button",{type:"button",onClick:()=>ce("household"),className:"text-xs font-semibold text-brand-600 hover:underline",children:y.household?"Show less":"Show more"}),ke&&e.jsx("p",{className:"text-xs text-red-600 font-semibold mt-2",children:ke})]})]}),e.jsxs("section",{ref:ae,className:"bg-white p-6 rounded-2xl shadow-sm space-y-4 border border-red-100 order-20",children:[e.jsxs("button",{type:"button",onClick:()=>de("security"),className:"w-full flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 text-left",children:[e.jsx("div",{className:"p-3 bg-red-50 rounded-full text-red-600",children:e.jsx(Xs,{size:24})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:"Preparedness"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Health and mobility planning details."})]})]}),e.jsx(be,{size:18,className:"text-slate-500 transition-transform ".concat(g.security?"rotate-180":"")})]}),!g.security&&e.jsxs("p",{className:"text-xs text-slate-500",children:["Consent: ",l.consentPreparednessPlanning?"Provided":"Pending"," • ZIP: ",l.zipCode||"Not detected"]}),g.security&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-slate-50 px-4 py-3",children:[e.jsx("p",{className:"text-xs font-bold text-slate-600 uppercase tracking-wide",children:"ZIP Code"}),e.jsx("p",{className:"text-sm font-semibold text-slate-900 mt-1",children:l.zipCode||"Not detected yet"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"From your Home Address"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs font-bold text-slate-600 uppercase tracking-wide",children:"Medical"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[e.jsxs("label",{className:"flex items-center justify-between rounded-lg border border-slate-200 p-3",children:[e.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Medication Dependency"}),e.jsx("input",{type:"checkbox",checked:!!l.medicationDependency,onChange:s=>N("medicationDependency",s.target.checked)})]}),e.jsxs("label",{className:"flex items-center justify-between rounded-lg border border-slate-200 p-3",children:[e.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Insulin Dependency"}),e.jsx("input",{type:"checkbox",checked:!!l.insulinDependency,onChange:s=>N("insulinDependency",s.target.checked)})]}),e.jsxs("label",{className:"flex items-center justify-between rounded-lg border border-slate-200 p-3 md:col-span-2",children:[e.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Oxygen / Powered Medical Device"}),e.jsx("input",{type:"checkbox",checked:!!l.oxygenPoweredDevice,onChange:s=>N("oxygenPoweredDevice",s.target.checked)})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs font-bold text-slate-600 uppercase tracking-wide",children:"Accessibility"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[e.jsxs("label",{className:"flex items-center justify-between rounded-lg border border-slate-200 p-3",children:[e.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Mobility Limitation"}),e.jsx("input",{type:"checkbox",checked:!!l.mobilityLimitation,onChange:s=>N("mobilityLimitation",s.target.checked)})]}),e.jsxs("label",{className:"flex items-center justify-between rounded-lg border border-slate-200 p-3",children:[e.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Transportation Access"}),e.jsx("input",{type:"checkbox",checked:!!l.transportationAccess,onChange:s=>N("transportationAccess",s.target.checked)})]}),e.jsxs("label",{className:"flex items-center justify-between rounded-lg border border-slate-200 p-3 md:col-span-2",children:[e.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Financial Strain"}),e.jsx("input",{type:"checkbox",checked:!!l.financialStrain,onChange:s=>N("financialStrain",s.target.checked)})]})]})]}),e.jsx(I,{label:"Pets",placeholder:"e.g. 2 Dogs",value:l.petDetails,onChange:s=>N("petDetails",s.target.value)}),y.security&&e.jsx(Ys,{label:"Anything else not listed above",value:l.medicalNeeds,onChange:s=>N("medicalNeeds",s.target.value)}),e.jsxs("div",{className:"border-t border-slate-200 pt-4",children:[e.jsx("p",{className:"text-[11px] font-bold text-slate-600 uppercase tracking-wide",children:"Final Step"}),e.jsx("p",{className:"text-sm font-bold text-slate-800 mt-1",children:"Confirm preparedness consent"})]}),e.jsxs("label",{className:"flex items-start gap-3 rounded-lg border border-emerald-200 bg-emerald-50 p-3",children:[e.jsx("input",{className:"mt-1",type:"checkbox",checked:!!l.consentPreparednessPlanning,onChange:s=>N("consentPreparednessPlanning",s.target.checked)}),e.jsx("span",{className:"text-sm text-emerald-900 font-semibold",children:"I understand this data is used only for preparedness planning and can be deleted anytime."})]}),e.jsx("button",{type:"button",onClick:()=>ce("security"),className:"text-xs font-semibold text-brand-600 hover:underline",children:y.security?"Show less":"Show more"}),ke&&e.jsx("p",{className:"text-xs text-red-600 font-semibold mt-2",children:ke})]})]}),e.jsxs("section",{ref:j,className:"bg-white p-6 rounded-2xl shadow-sm space-y-4 border border-purple-100 relative overflow-hidden order-40",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-10",children:e.jsx(Le,{size:64,className:"text-purple-600"})}),e.jsxs("button",{type:"button",onClick:()=>de("community"),className:"w-full flex items-center justify-between gap-4 relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-2 text-left",children:[e.jsx("div",{className:"p-3 bg-purple-50 rounded-full text-purple-600",children:e.jsx(Le,{size:24})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:as("settings.trusted_conn")}),e.jsx("p",{className:"text-xs text-slate-500",children:z?"Connected to ".concat(z):"No community connected"})]})]}),e.jsx(be,{size:18,className:"text-slate-500 transition-transform ".concat(g.community?"rotate-180":"")})]}),g.community&&e.jsxs(e.Fragment,{children:[l.role==="INSTITUTION_ADMIN"?e.jsxs("div",{className:"relative z-10 space-y-3",children:[e.jsxs("div",{className:"bg-purple-100 border border-purple-200 p-4 rounded-xl flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-bold text-purple-600 uppercase tracking-wider",children:"Your Organization ID"}),e.jsx("p",{className:"text-2xl font-mono font-black text-purple-900 tracking-widest",children:l.communityId||"NOT SET"})]}),e.jsx(d,{size:"sm",variant:"ghost",onClick:()=>Re(l.communityId),className:"text-purple-700 hover:bg-purple-200",children:e.jsx(pe,{size:20})})]}),e.jsxs("div",{className:"flex gap-3 items-end",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(I,{label:"Change Organization ID",value:l.communityId,onChange:s=>{N("communityId",it(s.target.value)),B(null),E(null)},className:z?"border-green-500 focus:ring-green-500 bg-green-50/30":J?"border-red-500 focus:ring-red-500":""}),e.jsx("p",{className:"text-[11px] text-slate-500 mt-1",children:"Format: CH-1234"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(d,{className:"mb-[1px] min-w-[50px] ".concat(z?"bg-green-600 hover:bg-green-700":"bg-purple-600 hover:bg-purple-700"),onClick:_s,disabled:je||!l.communityId,children:je?e.jsx(tt,{className:"animate-spin",size:20}):z?e.jsx(Me,{size:20}):e.jsx(lt,{size:20})}),e.jsx("p",{className:"text-[10px] font-semibold text-purple-600 mt-1",children:"Click here"})]})]}),J&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm font-bold bg-red-50 p-2 rounded-lg animate-fade-in border border-red-100 relative z-10",children:[e.jsx(at,{size:16})," ",J]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-3 items-end relative z-10",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(I,{label:"Community ID",value:l.communityId,onChange:s=>{N("communityId",it(s.target.value)),B(null),E(null)},className:z?"border-green-500 focus:ring-green-500 bg-green-50/30":J?"border-red-500 focus:ring-red-500":""}),e.jsx("p",{className:"text-[11px] text-slate-500 mt-1",children:"Format: CH-1234"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(d,{className:"mb-[1px] min-w-[50px] ".concat(z?"bg-green-600 hover:bg-green-700":"bg-purple-600 hover:bg-purple-700"),onClick:_s,disabled:je||!l.communityId,children:je?e.jsx(tt,{className:"animate-spin",size:20}):z?e.jsx(Me,{size:20}):e.jsx(lt,{size:20})}),e.jsx("p",{className:"text-[10px] font-semibold text-purple-600 mt-1",children:"Click here"})]})]}),z&&e.jsxs("p",{className:"text-xs font-semibold text-emerald-700 relative z-10",children:["Connected to ",z,"."]}),J&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm font-bold bg-red-50 p-2 rounded-lg animate-fade-in border border-red-100 relative z-10",children:[e.jsx(at,{size:16})," ",J]}),y.community&&e.jsxs("div",{className:"relative z-10 mt-4 border-t border-slate-200 pt-3",children:[e.jsx("p",{className:"text-[11px] text-slate-500 mb-2",children:"Advanced"}),e.jsx(d,{variant:"ghost",size:"sm",className:"text-red-600 hover:bg-red-50",onClick:wt,disabled:xs||!l.communityId,children:xs?"Disconnecting...":"Disconnect Organization"})]})]}),e.jsx("button",{type:"button",onClick:()=>ce("community"),className:"text-xs font-semibold text-brand-600 hover:underline relative z-10",children:y.community?"Show less":"Show more"})]})]}),e.jsxs("section",{className:"bg-white p-6 rounded-2xl shadow-sm space-y-4 order-50",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-emerald-50 rounded-full text-emerald-700",children:e.jsx(rs,{size:24})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:"Legal"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Privacy & consent"})]})]}),e.jsxs(d,{onClick:()=>{sessionStorage.setItem("privacyReturnView","SETTINGS"),v("PRIVACY_POLICY")},variant:"outline",className:"w-full justify-between border-slate-300 hover:bg-slate-50",children:[e.jsx("span",{children:"View Privacy & Consent"}),e.jsx(st,{size:18})]})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-30 border-t border-slate-200 bg-white/95 backdrop-blur px-4 py-3",children:e.jsxs("div",{className:"max-w-3xl mx-auto flex items-center gap-3",children:[e.jsx(d,{variant:"ghost",className:"flex-1",onClick:gt,disabled:Ge||qe,children:"Reset"}),e.jsxs(d,{className:"flex-1",onClick:ft,disabled:Ge||qe,children:[e.jsx(ma,{size:16,className:"mr-2"}),Ge||qe?"Saving...":(g.security||g.household,"Save")]})]})}),e.jsx("div",{className:"space-y-4 pt-4 border-t border-slate-200 order-60",children:e.jsxs(d,{onClick:zt,variant:"ghost",fullWidth:!0,className:"text-red-600 hover:bg-red-50 hover:text-red-700",children:[e.jsx(wa,{className:"mr-2",size:18}),"Log Out"]})})]})};export{ol as SettingsView};
