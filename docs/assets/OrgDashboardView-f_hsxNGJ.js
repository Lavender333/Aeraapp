import{a,j as e,aF as oe,X as De,o as ce,aG as Be,ak as xe,aH as Ue,a7 as We,G as W,a6 as Ke,z as K,l as $,aI as he,n as $e,a8 as Te,q as qe,ae as Ge,M as He,k as Qe,aj as Ve,a9 as Ye,W as Xe}from"./vendor-react-DZ0IVLBb.js";import{B as h}from"./Button-BzswROfv.js";import{S as d,x as T,y as Je,z as Ze,A as es,B as ss}from"./index-D_urGLpe.js";import{g as ts,a as as}from"./inventoryStatus-BGlXoNrp.js";import{t as n}from"./translations-CdcWkPcN.js";import{T as ls}from"./Input-D28zJcRZ.js";import{G as ns}from"./mockGenAI-BPqgTz-A.js";import"./vendor-CCVjAPEY.js";import"./vendor-maps-S3fC-LOA.js";import"./vendor-jspdf-Bd23t5aa.js";import"./vendor-supabase-ChvUvA8t.js";const fs=({setView:me})=>{const ue=s=>({id:String((s==null?void 0:s.id)||""),name:String((s==null?void 0:s.name)||"Unknown Member"),status:(s==null?void 0:s.status)||"UNKNOWN",lastUpdate:String((s==null?void 0:s.lastUpdate)||(s==null?void 0:s.last_update)||"Unknown"),location:String((s==null?void 0:s.location)||"Unknown"),needs:Array.isArray(s==null?void 0:s.needs)?s.needs:[],phone:String((s==null?void 0:s.phone)||""),address:String((s==null?void 0:s.address)||""),emergencyContactName:String((s==null?void 0:s.emergencyContactName)||(s==null?void 0:s.emergency_contact_name)||""),emergencyContactPhone:String((s==null?void 0:s.emergencyContactPhone)||(s==null?void 0:s.emergency_contact_phone)||""),emergencyContactRelation:String((s==null?void 0:s.emergencyContactRelation)||(s==null?void 0:s.emergency_contact_relation)||"")}),O=s=>Array.isArray(s)?s.map(ue):[],[g,A]=a.useState([]),[m,y]=a.useState({water:0,food:0,blankets:0,medicalKits:0}),[b,I]=a.useState("MEMBERS"),[N,pe]=a.useState("Community Organization"),[c,ge]=a.useState(""),[be,fe]=a.useState(0),[q,f]=a.useState([]),[z,je]=a.useState(!1),[P,G]=a.useState(!1),[,H]=a.useState(!1),[l,k]=a.useState(null),[w,Ne]=a.useState("Central Warehouse"),[rs,ve]=a.useState(""),[Q,V]=a.useState(!1),[F,ye]=a.useState({safe:0,danger:0,unknown:0}),[ke,S]=a.useState(!1),[we,Y]=a.useState(!1),[L,X]=a.useState("Water Cases"),[_,J]=a.useState(10),[Z,ee]=a.useState(!navigator.onLine),[se,te]=a.useState(!1),[D,ae]=a.useState([]),[B,le]=a.useState([]),[Se,C]=a.useState(!1),[p,ne]=a.useState(""),[Ce,U]=a.useState("COMPOSE"),[re,E]=a.useState(!1),[ie,R]=a.useState(null);a.useEffect(()=>{const t=d.getProfile().communityId||"CH-9921";ge(t);const i=d.getOrganization(t);i&&(pe(i.name),Ne(i.replenishmentProvider||"General Aid Pool"),ve(i.replenishmentEmail||""),fe(i.registeredPopulation||0)),A(O(d.getOrgMembers(t))),d.fetchOrgMembersRemote(t).then(({members:r,fromCache:u})=>{A(O(r)),H(u)}).catch(()=>H(!0)),d.fetchOrgInventoryRemote(t).then(({inventory:r,fromCache:u})=>{y(r),je(u)}),T(t).then(r=>{G(!1),f(r)}).catch(()=>{G(!0),f(d.getOrgReplenishmentRequests(t))}),d.fetchMemberStatus(t).then(r=>{var u;r!=null&&r.counts&&ye(r.counts),(u=r==null?void 0:r.members)!=null&&u.length&&A(O(r.members))}),Je(t).then(r=>ae(r)).catch(()=>ae([])),Ze(t).then(r=>le(r)).catch(()=>le([]));const o=()=>ee(!1),x=()=>ee(!0);return window.addEventListener("online",o),window.addEventListener("offline",x),()=>{window.removeEventListener("online",o),window.removeEventListener("offline",x)}},[]);const v={total:g.length,safe:F.safe||g.filter(s=>s.status==="SAFE").length,danger:F.danger||g.filter(s=>s.status==="DANGER").length,unknown:F.unknown||g.filter(s=>s.status==="UNKNOWN").length},M=v.total||be,Ee=(s,t)=>{const i=Math.max(0,Number.isFinite(t)?t:0);y(o=>({...o,[s]:i})),V(!0)},Re=()=>{const s=`Water: ${m.water}
Food: ${m.food}
Blankets: ${m.blankets}
Med Kits: ${m.medicalKits}

Save these counts?`;window.confirm(s)&&(d.updateOrgInventory(c,m),d.saveOrgInventoryRemote(c,m),V(!1),alert("Inventory Updated in Central Database"))},Me=()=>{navigator.clipboard.writeText(c),alert(`Copied Community ID: ${c}`)},Oe=()=>{ne(""),U("COMPOSE"),R(null),C(!0)},Ae=async s=>{var t;E(!0),R(null);try{const x=(t=(await new ns({apiKey:"PLACEHOLDER_API_KEY"}).models.generateContent({model:"gemini-2.5-flash",contents:`Analyze this broadcast message for an emergency app: "${s}". 
        Does it contain profanity, hate speech, threats, or extremely rude language? 
        If it is safe and appropriate for public broadcast, return strictly "SAFE". 
        If it contains prohibited content, return "UNSAFE".`})).text)==null?void 0:t.trim().toUpperCase();return E(!1),x!=null&&x.includes("SAFE")&&!(x!=null&&x.includes("UNSAFE"))?!0:(R("Message flagged as inappropriate or rude by AI system."),!1)}catch(i){return console.error("Moderation failed",i),["hate","kill","stupid","idiot","damn","hell"].some(x=>s.toLowerCase().includes(x))?(R("Message contains prohibited words."),E(!1),!1):(E(!1),!0)}},Ie=async()=>{if(!p.trim())return;await Ae(p)&&U("CONFIRM")},ze=()=>{p.trim()&&(d.updateOrgBroadcast(c,p),C(!1),alert(`Broadcast sent to all members linked to ${N}.`))},Pe=()=>{if(l){const s=d.sendPing(l.id);alert(s?`Ping sent to ${l.name}. They will see a status check prompt on their dashboard.`:"Failed to ping member.")}},Fe=async()=>{try{try{await es(c,{item:L,quantity:_,provider:w,orgName:N});const s=await T(c);f(s)}catch(s){console.warn("API request failed, using local storage:",s),d.createReplenishmentRequest(c,{item:L,quantity:_,provider:w,orgName:N});const t=d.getOrgReplenishmentRequests(c);f(t)}Y(!0)}catch(s){console.error(s),alert("Failed to submit request. Please try again.")}setTimeout(()=>{S(!1),Y(!1)},4e3)},Le=s=>{const t=s.quantity,i=window.prompt(`Enter stocked quantity for ${s.item}:`,String(t));if(i===null)return;const o=parseInt(i);if(!Number.isFinite(o)||o<0){alert("Enter a valid non-negative quantity.");return}te(!0),ss(s.id,{status:"STOCKED",deliveredQuantity:o}).then(async()=>{const x=await T(c);f(x),d.fetchOrgInventoryRemote(c).then(y)}).catch(()=>{console.warn("API update failed, using local storage");const r={[s.item.toLowerCase().includes("water")?"water":s.item.toLowerCase().includes("food")?"food":s.item.toLowerCase().includes("blanket")?"blankets":"medicalKits"]:o};d.stockReplenishment(s.id,r);const u=d.getOrgReplenishmentRequests(c);f(u);const _e=d.getOrgInventory(c);y(_e)}).finally(()=>te(!1))},j=ts(m,M),de=[{label:"Water Cases",key:"water",unit:"cases"},{label:"Food Boxes",key:"food",unit:"boxes"},{label:"Blankets",key:"blankets",unit:"units"},{label:"Med Kits",key:"medicalKits",unit:"kits"}].filter(s=>j[s.key].level==="LOW");return e.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col pb-safe animate-fade-in relative",children:[(z||P)&&e.jsxs("div",{className:"mx-4 mb-2 text-xs text-amber-700 font-semibold bg-amber-50 border border-amber-200 rounded-lg p-2 flex items-center justify-between",children:[e.jsxs("span",{children:[z&&"Using cached inventory",z&&P?" • ":"",P&&"Using cached requests"]}),e.jsx("span",{className:"text-amber-500",children:"Check API connection"})]}),Se&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden animate-slide-up",children:[e.jsxs("div",{className:"bg-slate-900 text-white p-4 flex justify-between items-center",children:[e.jsxs("h3",{className:"font-bold flex items-center gap-2",children:[e.jsx(oe,{size:18})," ",n("org.broadcast")]}),e.jsx("button",{onClick:()=>C(!1),className:"text-slate-400 hover:text-white",children:e.jsx(De,{size:24})})]}),e.jsx("div",{className:"p-6",children:Ce==="COMPOSE"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-brand-600 font-medium bg-brand-50 p-2 rounded-lg",children:[e.jsx(ce,{size:16}),e.jsxs("span",{children:["Sending to members of ",e.jsx("strong",{children:N})]})]}),e.jsx(ls,{label:"Message Content",placeholder:"e.g., Food distribution starts at 2PM in the main hall...",value:p,onChange:s=>ne(s.target.value),className:"min-h-[120px] text-lg font-medium"}),ie&&e.jsxs("div",{className:"bg-red-50 text-red-600 text-sm font-bold p-3 rounded-lg flex items-center gap-2 animate-pulse",children:[e.jsx(Be,{size:16})," ",ie]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(h,{variant:"ghost",fullWidth:!0,onClick:()=>C(!1),children:"Cancel"}),e.jsx(h,{fullWidth:!0,disabled:!p.trim()||re,onClick:Ie,children:re?e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"animate-spin mr-2",size:18})," Checking..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ue,{className:"mr-2",size:18})," Review"]})})]})]}):e.jsxs("div",{className:"space-y-6 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-brand-100 rounded-full flex items-center justify-center mx-auto text-brand-600 mb-2",children:e.jsx(We,{size:32})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xl font-bold text-slate-900 mb-2",children:"Message Approved"}),e.jsx("p",{className:"text-slate-500 text-sm mb-4",children:"Ready to broadcast to your community members:"}),e.jsxs("div",{className:"bg-slate-100 p-4 rounded-xl border border-slate-200 text-slate-900 font-medium text-left italic",children:['"',p,'"']})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(h,{variant:"secondary",fullWidth:!0,onClick:()=>U("COMPOSE"),children:"Edit"}),e.jsx(h,{fullWidth:!0,className:"bg-brand-600 hover:bg-brand-700 text-white font-bold",onClick:ze,children:"SEND NOW"})]})]})})]})}),e.jsxs("div",{className:"bg-white border-b border-slate-200 p-4 sticky top-0 z-20 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>me("DASHBOARD"),className:"p-2 -ml-2 text-slate-500 hover:text-slate-800",children:e.jsx(W,{size:24})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-bold text-lg text-slate-900 leading-tight",children:N}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-brand-600 font-bold bg-brand-50 px-2 py-0.5 rounded w-fit mt-1",children:[e.jsx(ce,{size:12})," ",n("org.verified")]})]})]}),e.jsxs(h,{size:"sm",variant:"outline",className:"border-slate-300 text-slate-900 hover:bg-slate-50",onClick:Oe,children:[e.jsx(oe,{size:16,className:"mr-2"})," ",n("org.broadcast")]})]}),e.jsxs("div",{className:"bg-slate-900 text-white p-3 rounded-xl mb-4 flex items-center justify-between shadow-md",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-slate-400 font-bold uppercase tracking-wider",children:n("org.code")}),e.jsx("p",{className:"text-xl font-mono font-black tracking-widest text-brand-400",children:c})]}),e.jsxs(h,{size:"sm",className:"bg-slate-700 hover:bg-slate-600 text-white border-0",onClick:Me,children:[e.jsx(Ke,{size:16,className:"mr-2"})," ",n("org.copy")]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"bg-red-50 border border-red-100 p-2 rounded-lg text-center",children:[e.jsx("span",{className:"block text-2xl font-bold text-red-600",children:v.danger}),e.jsx("span",{className:"text-xs text-red-800 font-bold uppercase",children:n("status.danger")})]}),e.jsxs("div",{className:"bg-green-50 border border-green-100 p-2 rounded-lg text-center",children:[e.jsx("span",{className:"block text-2xl font-bold text-green-600",children:v.safe}),e.jsx("span",{className:"text-xs text-green-800 font-bold uppercase",children:n("status.safe")})]}),e.jsxs("div",{className:"bg-slate-100 border border-slate-200 p-2 rounded-lg text-center",children:[e.jsx("span",{className:"block text-2xl font-bold text-slate-600",children:v.unknown}),e.jsx("span",{className:"text-xs text-slate-500 font-bold uppercase",children:n("status.unknown")})]})]}),e.jsxs("div",{className:"text-xs text-slate-500 font-bold mt-2",children:["Total Members: ",v.total]})]}),e.jsxs("div",{className:"flex bg-white border-b border-slate-200",children:[e.jsx("button",{onClick:()=>{I("MEMBERS"),k(null)},className:`flex-1 py-3 text-sm font-bold border-b-2 transition-colors ${b==="MEMBERS"?"border-brand-600 text-brand-700":"border-transparent text-slate-500"}`,children:n("org.tab.members")}),e.jsx("button",{onClick:()=>{I("PREPAREDNESS"),k(null)},className:`flex-1 py-3 text-sm font-bold border-b-2 transition-colors ${b==="PREPAREDNESS"?"border-brand-600 text-brand-700":"border-transparent text-slate-500"}`,children:n("org.tab.preparedness")}),e.jsx("button",{onClick:()=>I("INVENTORY"),className:`flex-1 py-3 text-sm font-bold border-b-2 transition-colors ${b==="INVENTORY"?"border-brand-600 text-brand-700":"border-transparent text-slate-500"}`,children:n("org.tab.inventory")})]}),e.jsxs("div",{className:"p-4 flex-1 overflow-y-auto",children:[b==="MEMBERS"&&(l?e.jsxs("div",{className:"space-y-6 animate-slide-up",children:[e.jsxs(h,{variant:"ghost",onClick:()=>k(null),className:"pl-0 text-slate-500",children:[e.jsx(W,{size:16,className:"mr-1"})," Back to list"]}),e.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-lg overflow-hidden",children:[e.jsx("div",{className:`p-6 ${l.status==="SAFE"?"bg-green-600":l.status==="DANGER"?"bg-red-600":"bg-slate-600"} text-white`,children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-white/20 flex items-center justify-center font-bold text-2xl border-2 border-white/30",children:l.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:l.name}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1 bg-black/20 w-fit px-2 py-0.5 rounded text-xs font-bold uppercase",children:[l.status==="SAFE"&&e.jsx(K,{size:12}),l.status==="DANGER"&&e.jsx($,{size:12}),l.status==="UNKNOWN"&&e.jsx(he,{size:12}),l.status]})]})]})})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-xl p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-purple-900 font-bold text-sm",children:"Status Check"}),e.jsx("p",{className:"text-purple-700 text-xs",children:"Request immediate update."})]}),e.jsxs(h,{size:"sm",onClick:Pe,className:"bg-purple-600 hover:bg-purple-700 text-white",children:[e.jsx($e,{size:16,className:"mr-2"})," Ping Member"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-bold text-slate-900 border-b border-slate-100 pb-2 flex items-center gap-2",children:[e.jsx(Te,{size:18,className:"text-slate-400"})," Contact Info"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 font-bold uppercase",children:"Phone"}),e.jsxs("a",{href:`tel:${l.phone}`,className:"text-blue-600 font-bold hover:underline flex items-center gap-1",children:[e.jsx(qe,{size:14})," ",l.phone||"N/A"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 font-bold uppercase",children:"Home Address"}),e.jsx("p",{className:"text-slate-900",children:l.address||"Not Provided"})]}),e.jsxs("div",{className:"bg-red-50 p-3 rounded-lg border border-red-100",children:[e.jsx("p",{className:"text-xs text-red-600 font-bold uppercase mb-1",children:"Emergency Contact"}),e.jsx("div",{className:"text-slate-900 font-medium",children:l.emergencyContactName?e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[l.emergencyContactName," (",l.emergencyContactRelation,")"]}),e.jsx("a",{href:`tel:${l.emergencyContactPhone}`,className:"text-red-700 hover:underline font-bold text-sm",children:l.emergencyContactPhone})]}):e.jsx("p",{children:"None Listed"})})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-bold text-slate-900 border-b border-slate-100 pb-2 flex items-center gap-2",children:[e.jsx(Ge,{size:18,className:"text-slate-400"})," Current Status"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 font-bold uppercase",children:"Last Location"}),e.jsxs("div",{className:"flex items-center gap-2 text-slate-900",children:[e.jsx(He,{size:16,className:"text-slate-400"}),l.location]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 font-bold uppercase",children:"Last Update"}),e.jsx("p",{className:"text-slate-900",children:l.lastUpdate})]}),l.needs.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 font-bold uppercase mb-1",children:"Reported Needs"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:l.needs.map(s=>e.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-700 text-xs font-bold rounded",children:s},s))})]})]})]})]})]})]})]}):e.jsxs("div",{className:"space-y-3",children:[g.length===0&&e.jsxs("p",{className:"text-center text-slate-500 mt-8",children:["No members linked to ",c," yet."]}),g.map(s=>e.jsxs("div",{onClick:()=>k(s),className:"bg-white p-4 rounded-xl border border-slate-200 shadow-sm flex items-center justify-between cursor-pointer hover:border-brand-400 hover:shadow-md transition-all group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-white font-bold ${s.status==="SAFE"?"bg-green-500":s.status==="DANGER"?"bg-red-500":"bg-slate-400"}`,children:s.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-slate-900 group-hover:text-brand-700 transition-colors",children:s.name}),e.jsxs("p",{className:"text-xs text-slate-600 font-medium",children:[s.location," • ",s.lastUpdate]}),s.needs.length>0&&e.jsx("div",{className:"flex gap-1 mt-1",children:s.needs.map(t=>e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 bg-red-100 text-red-700 rounded font-bold uppercase",children:t},t))})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="SAFE"&&e.jsx(K,{className:"text-green-500"}),s.status==="DANGER"&&e.jsx($,{className:"text-red-500 animate-pulse"}),s.status==="UNKNOWN"&&e.jsx(he,{className:"text-slate-300"}),e.jsx(W,{size:16,className:"text-slate-300 rotate-180 group-hover:text-brand-500 transition-colors"})]})]},s.id))]})),b==="PREPAREDNESS"&&e.jsxs("div",{className:"space-y-3",children:[D.length>0&&e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4",children:[e.jsx("h3",{className:"text-sm font-bold text-amber-900 mb-2",children:n("org.outreach.title")}),e.jsx("div",{className:"space-y-2",children:D.slice(0,8).map((s,t)=>{const i=s.outreach_flag==="HIGH"?"bg-red-100 text-red-700 border-red-200":s.outreach_flag==="MEDIUM"?"bg-amber-100 text-amber-700 border-amber-200":"bg-emerald-100 text-emerald-700 border-emerald-200";return e.jsxs("div",{className:"bg-white border border-amber-100 rounded-lg p-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 font-bold uppercase",children:s.county_id||s.state_id||"Organization Scope"}),e.jsxs("p",{className:"text-sm text-slate-700",children:[s.member_count," members • Updated ",new Date(s.last_updated).toLocaleString()]})]}),e.jsx("span",{className:`px-2 py-1 text-[11px] border rounded font-bold ${i}`,children:s.outreach_flag})]},`${s.county_id||"state"}-${t}`)})})]}),B.length>0&&e.jsxs("div",{className:"bg-white border border-slate-200 rounded-xl p-4",children:[e.jsx("h3",{className:"text-sm font-bold text-slate-900 mb-2",children:n("org.gaps.title")}),e.jsx("div",{className:"space-y-2",children:B.slice(0,20).map(s=>{const t=Math.round(Number(s.readiness_score||0)),i=s.risk_tier==="HIGH"?"bg-red-100 text-red-700 border-red-200":s.risk_tier==="ELEVATED"?"bg-amber-100 text-amber-700 border-amber-200":"bg-emerald-100 text-emerald-700 border-emerald-200";return e.jsxs("div",{className:"rounded-lg border border-slate-200 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-slate-900",children:s.member_name}),e.jsxs("p",{className:"text-xs text-slate-500",children:[s.phone||"No phone"," • ",s.critical_missing_count," critical missing"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-slate-500 uppercase font-bold",children:n("org.gaps.readiness")}),e.jsxs("p",{className:"text-sm font-black text-slate-900",children:[t,"%"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`text-[10px] px-2 py-1 border rounded font-bold uppercase ${i}`,children:s.risk_tier}),s.outreach_flags.slice(0,3).map(o=>e.jsx("span",{className:"text-[10px] px-2 py-1 rounded bg-purple-100 text-purple-700 font-bold",children:o},o))]}),s.critical_missing_items.length>0&&e.jsxs("div",{className:"mt-2 text-xs text-slate-600",children:[n("org.gaps.missing"),": ",s.critical_missing_items.slice(0,3).map(o=>o.item||"Critical item").join(", ")]})]},s.profile_id)})})]}),D.length===0&&B.length===0&&e.jsx("div",{className:"bg-white border border-slate-200 rounded-xl p-4 text-sm text-slate-600",children:n("org.gaps.none")})]}),b==="INVENTORY"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4 flex items-start gap-3",children:[e.jsx(Qe,{className:"text-blue-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-blue-900",children:n("org.manage_res")}),e.jsx("p",{className:"text-sm text-blue-800",children:n("org.manage_desc")})]})]}),M>0&&de.length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx($,{size:18}),e.jsxs("p",{className:"font-bold text-sm",children:["Low stock relative to population of ",M]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:de.map(s=>{const t=as(m[s.key],M)||0;return e.jsxs("div",{className:"bg-white border border-red-100 rounded-lg p-3 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-bold text-red-700 text-sm",children:s.label}),e.jsx("span",{className:"text-[11px] font-bold text-red-600",children:"LOW"})]}),e.jsxs("p",{className:"text-xs text-slate-600 mt-1",children:["Current: ",e.jsxs("span",{className:"font-bold",children:[m[s.key]," ",s.unit]})]}),e.jsxs("p",{className:"text-xs text-slate-600",children:["Recommend: ",e.jsxs("span",{className:"font-bold",children:[t," ",s.unit]})," to reach 80% coverage"]}),e.jsx(h,{size:"sm",className:"mt-2 w-full",onClick:()=>{X(s.label),J(Math.max(1,t)),S(!0)},children:"Prefill Request"})]},s.key)})})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:[{label:"Water Cases",key:"water",unit:"cases"},{label:"Food Boxes",key:"food",unit:"boxes"},{label:"Blankets",key:"blankets",unit:"units"},{label:"Med Kits",key:"medicalKits",unit:"kits"}].map(s=>e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-slate-200 shadow-sm text-center",children:[e.jsx("p",{className:"text-slate-500 text-xs font-bold uppercase mb-1",children:s.label}),e.jsx("input",{type:"number",min:"0",className:"w-full mt-2 p-2 rounded-lg border border-slate-300 text-center font-bold text-slate-900",value:m[s.key],onChange:t=>Ee(s.key,parseInt(t.target.value))}),e.jsx("p",{className:"text-slate-400 text-xs mt-1",children:s.unit}),e.jsx("p",{className:`text-[11px] font-bold mt-1 ${j[s.key].level==="HIGH"?"text-green-600":j[s.key].level==="MEDIUM"?"text-amber-600":j[s.key].level==="LOW"?"text-red-600":"text-slate-400"}`,children:j[s.key].level==="UNKNOWN"?"N/A":j[s.key].level})]},s.label))}),e.jsxs(h,{fullWidth:!0,className:"font-bold",onClick:Re,disabled:!Q,children:[e.jsx(Ve,{size:18,className:"mr-2"})," ",Q?n("btn.save"):"All Saved"]}),e.jsxs("div",{className:"bg-white border border-slate-200 rounded-xl p-4 shadow-sm mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ye,{className:"text-brand-600",size:20}),e.jsx("h3",{className:"font-bold text-slate-900",children:n("org.req_replenish")})]}),e.jsx("p",{className:"text-sm text-slate-600 mb-4 font-medium",children:n("org.req_desc")}),ke?we?e.jsxs("div",{className:"bg-green-50 text-green-700 p-4 rounded-lg text-center font-bold flex flex-col items-center animate-fade-in border border-green-100",children:[e.jsx(K,{size:32,className:"mb-2"}),Z?e.jsxs(e.Fragment,{children:["Request Queued for Sync",e.jsxs("span",{className:"text-xs font-normal mt-1 flex items-center gap-1",children:[e.jsx(Xe,{size:10})," Will send when online"]})]}):`Request Sent to ${w}`]}):e.jsxs("div",{className:"bg-slate-50 p-3 rounded-lg border border-slate-200 space-y-3 animate-fade-in",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Item"}),e.jsxs("select",{className:"w-full p-2 rounded border border-slate-300 text-sm bg-white text-slate-900 font-bold",value:L,onChange:s=>X(s.target.value),children:[e.jsx("option",{value:"Water Cases",children:"Water Cases"}),e.jsx("option",{value:"Food Boxes",children:"Food Boxes"}),e.jsx("option",{value:"Blankets",children:"Blankets"}),e.jsx("option",{value:"Medical Kits",children:"Medical Kits"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",className:"w-full p-2 rounded border border-slate-300 text-sm text-slate-900 font-bold",value:_,onChange:s=>J(parseInt(s.target.value))})]}),e.jsxs("div",{className:"text-xs text-slate-600 text-right",children:["Provider: ",e.jsx("span",{className:"font-bold text-slate-900",children:w})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>S(!1),className:"flex-1 text-slate-700",children:n("btn.cancel")}),e.jsx(h,{size:"sm",className:"flex-1",onClick:Fe,children:Z?"Queue Offline":n("org.submit_req")})]})]}):e.jsx(h,{variant:"outline",fullWidth:!0,onClick:()=>S(!0),className:"text-slate-900 border-slate-300",children:n("org.create_req")}),e.jsxs("div",{className:"mt-6 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-bold text-slate-900",children:"Recent Requests"}),e.jsx("span",{className:"text-xs text-slate-500 font-bold",children:"Latest first"})]}),q.length===0&&e.jsx("p",{className:"text-sm text-slate-500",children:"No requests yet."}),q.slice(0,5).map(s=>e.jsxs("div",{className:"border border-slate-200 rounded-lg p-3 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-slate-900",children:s.item}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Qty: ",s.quantity," • ",new Date(s.timestamp).toLocaleString()]})]}),e.jsx("span",{className:`text-xs font-bold px-2 py-1 rounded-full ${s.status==="FULFILLED"?"bg-green-100 text-green-700":s.status==="STOCKED"?"bg-emerald-100 text-emerald-700":s.status==="APPROVED"?"bg-blue-100 text-blue-700":"bg-amber-100 text-amber-700"}`,children:s.status})]}),s.status!=="FULFILLED"&&s.status!=="STOCKED"&&e.jsx("p",{className:"mt-2 text-[11px] text-slate-500 font-bold",children:"Status managed by warehouse log."}),s.status==="FULFILLED"&&e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx(h,{size:"sm",variant:s.stocked?"ghost":"outline",onClick:()=>!s.stocked&&Le(s),disabled:s.stocked||se,children:s.stocked?e.jsx(e.Fragment,{children:"Stocked"}):e.jsxs(e.Fragment,{children:[se?e.jsx(xe,{size:14,className:"animate-spin mr-1"}):null,"Mark Stocked"]})}),s.stocked&&s.stockedAt&&e.jsxs("span",{className:"text-[11px] text-slate-500 font-bold",children:["Stocked at ",new Date(s.stockedAt).toLocaleTimeString()]})]}),s.status==="STOCKED"&&e.jsxs("div",{className:"mt-2 text-[11px] text-emerald-700 font-bold",children:["Stocked at ",s.stockedAt?new Date(s.stockedAt).toLocaleTimeString():"—"]})]},s.id))]})]})]})]})]})};export{fs as OrgDashboardView};
