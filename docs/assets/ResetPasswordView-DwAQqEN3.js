import{r,j as e,E as l}from"./index-CJzEU5Yr.js";import{B as R}from"./Button-CnRUMJhP.js";import{I as _}from"./Input-BlISMA55.js";import{L as z}from"./lock-xScy7UZd.js";import{O as B}from"./octagon-alert-B4cGnMXb.js";import{C as O}from"./circle-check-big-CYJ0xDz3.js";const Y=({setView:U})=>{const[o,p]=r.useState(""),[g,b]=r.useState(""),[k,t]=r.useState(""),[v,j]=r.useState(""),[f,u]=r.useState(!1),[c,y]=r.useState(!1),[d,m]=r.useState(!1);r.useEffect(()=>{let s=!0;return(async()=>{try{const h=window.location.hash||"",w=window.location.search||"",n=new URLSearchParams(h.startsWith("#")?h.slice(1):h),i=new URLSearchParams(w.startsWith("?")?w.slice(1):w),S=n.get("access_token")||i.get("access_token"),P=n.get("refresh_token")||i.get("refresh_token"),N=i.get("code")||n.get("code"),C=i.get("token_hash")||n.get("token_hash"),L=i.get("type")||n.get("type");if(N){const{error:a}=await l.auth.exchangeCodeForSession(N);if(a)throw a}else if(S&&P){const{error:a}=await l.auth.setSession({access_token:S,refresh_token:P});if(a)throw a}else if(C&&L==="recovery"){const{error:a}=await l.auth.verifyOtp({type:"recovery",token_hash:C});if(a)throw a}const{data:x,error:q}=await l.auth.getSession();if(!s)return;if(q){t("Unable to validate reset link. Please request a new one."),u(!0),m(!1);return}const E=x==null?void 0:x.session;m(!!E),u(!0),E||t("Reset link is invalid or expired. Please request a new one.")}catch(h){if(!s)return;t("Unable to validate reset link. Please request a new one."),m(!1),u(!0)}})(),()=>{s=!1}},[]);const I=async()=>{if(t(""),j(""),!o||o.length<8){t("Password must be at least 8 characters.");return}if(o!==g){t("Passwords do not match.");return}if(!d){t("Reset link is invalid or expired. Please request a new one.");return}try{y(!0);const{error:s}=await l.auth.updateUser({password:o});if(s)throw s;j("Password updated. You can log in now."),p(""),b("")}catch(s){t((s==null?void 0:s.message)||"Password reset failed.")}finally{y(!1)}};return e.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col p-6 animate-fade-in pb-safe justify-center max-w-sm mx-auto w-full",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-brand-100 rounded-full flex items-center justify-center mx-auto mb-4 text-brand-700 border border-brand-200",children:e.jsx(z,{size:32})}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Reset Password"}),e.jsx("p",{className:"text-slate-600 font-medium",children:"Set a new password for your account."})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-slate-200 shadow-sm space-y-4",children:[e.jsx(_,{disabled:!f||!d||c,label:"New Password",type:"password",placeholder:"New password",value:o,onChange:s=>p(s.target.value),className:"border-slate-300"}),e.jsx(_,{disabled:!f||!d||c,label:"Confirm Password",type:"password",placeholder:"Confirm password",value:g,onChange:s=>b(s.target.value),className:"border-slate-300"}),k&&e.jsxs("div",{className:"flex items-start gap-2 text-sm text-red-600 bg-red-50 p-3 rounded-lg",children:[e.jsx(B,{size:16,className:"mt-0.5 shrink-0"}),e.jsx("span",{children:k})]}),v&&e.jsxs("div",{className:"flex items-start gap-2 text-sm text-emerald-700 bg-emerald-50 p-3 rounded-lg",children:[e.jsx(O,{size:16,className:"mt-0.5 shrink-0"}),e.jsx("span",{children:v})]}),e.jsx(R,{fullWidth:!0,size:"lg",onClick:I,className:"font-bold shadow-md",disabled:!f||!d||c,children:c?"Savingâ€¦":"Update Password"}),e.jsx(R,{fullWidth:!0,variant:"outline",onClick:()=>U("LOGIN"),className:"border-slate-300 text-slate-900 font-bold",children:"Back to Login"})]})]})};export{Y as ResetPasswordView};
