import{c as k,r as t,j as s,E as C,S as f}from"./index-CJzEU5Yr.js";import{B as c}from"./Button-CnRUMJhP.js";import{I as d}from"./Input-BlISMA55.js";import{t as n}from"./translations-Btzq2RVP.js";import{M as A}from"./mail-DBqRjF6g.js";import{O as M}from"./octagon-alert-B4cGnMXb.js";import{C as O}from"./circle-question-mark-D54SVZB8.js";/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]],_=k("key-round",F);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]],B=k("log-in",q),V=({setView:w})=>{const[D,H]=t.useState(""),[m,E]=t.useState(""),[u,I]=t.useState(""),[b,a]=t.useState(""),[y,r]=t.useState(""),[g,L]=t.useState(""),[j,h]=t.useState(!1),[P,v]=t.useState(!1),[p,S]=t.useState(""),[N,R]=t.useState(!1),[x,i]=t.useState(!1);t.useEffect(()=>{const e=window.location.hash||"",o=window.location.search||"";(e.includes("type=recovery")||o.includes("type=recovery"))&&(v(!0),h(!0),r("Enter a new password to finish resetting your account."))},[]);const z=async()=>{a(""),r("");try{R(!0);const e=String(m||"").trim().toLowerCase(),o=String(u||"");if(!e||!o){a("Email and password are required.");return}console.log("Attempting login with email:",e),await f.loginWithCredentials(e,o);const l=f.getProfile();console.log("Login successful! Profile:",{id:l.id,name:l.fullName,role:l.role,onboardComplete:l.onboardComplete}),console.log("Redirecting to DASHBOARD"),w("DASHBOARD")}catch(e){console.error("Login error:",e),a((e==null?void 0:e.message)||"Login failed.")}finally{R(!1)}};return s.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col p-6 animate-fade-in pb-safe justify-center max-w-sm mx-auto w-full",children:[s.jsxs("div",{className:"text-center mb-8",children:[s.jsx("div",{className:"w-16 h-16 bg-brand-100 rounded-full flex items-center justify-center mx-auto mb-4 text-brand-700 border border-brand-200",children:s.jsx(B,{size:32})}),s.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:n("login.welcome")}),s.jsx("p",{className:"text-slate-600 font-medium",children:n("login.subtitle")})]}),s.jsxs("div",{className:"bg-white p-6 rounded-xl border border-slate-200 shadow-sm space-y-4",children:[s.jsx("h2",{className:"text-sm font-bold text-slate-700 uppercase",children:"Email Login"}),s.jsx(d,{label:"Email",placeholder:"you@example.com",value:m,onChange:e=>E(e.target.value),className:"border-slate-300",leftIcon:s.jsx(A,{size:16})}),s.jsx(d,{label:"Password",type:"password",placeholder:"Your password",value:u,onChange:e=>I(e.target.value),className:"border-slate-300",leftIcon:s.jsx(_,{size:16})}),b&&s.jsxs("div",{className:"flex items-start gap-2 text-sm text-red-600 bg-red-50 p-3 rounded-lg",children:[s.jsx(M,{size:16,className:"mt-0.5 shrink-0"}),s.jsx("span",{children:b})]}),y&&s.jsxs("div",{className:"flex items-start gap-2 text-sm text-emerald-700 bg-emerald-50 p-3 rounded-lg",children:[s.jsx(O,{size:16,className:"mt-0.5 shrink-0"}),s.jsx("span",{children:y})]}),s.jsx(c,{fullWidth:!0,size:"lg",onClick:z,className:"font-bold shadow-md",disabled:!m||!u||N,children:N?"Signing in…":n("login.btn")}),s.jsx("button",{className:"text-sm text-brand-600 font-semibold underline",onClick:()=>h(!j),children:"Forgot password?"}),j&&s.jsx("div",{className:"space-y-3 border border-slate-200 rounded-lg p-3 bg-slate-50",children:P?s.jsxs(s.Fragment,{children:[s.jsx(d,{label:"New Password",type:"password",placeholder:"New password",value:p,onChange:e=>S(e.target.value)}),s.jsx(c,{size:"sm",onClick:async()=>{a(""),r("");try{i(!0);const{error:e}=await C.auth.updateUser({password:p});if(e)throw e;r("Password updated. You can log in now."),v(!1),h(!1),S(""),await C.auth.signOut({scope:"local"}),window.history.replaceState({},document.title,window.location.pathname)}catch(e){a((e==null?void 0:e.message)||"Password reset failed")}finally{i(!1)}},disabled:!p,children:x?"Saving…":"Set new password"})]}):s.jsxs(s.Fragment,{children:[s.jsx(d,{label:"Email for reset",placeholder:"you@example.com",value:g,onChange:e=>L(e.target.value)}),s.jsx(c,{size:"sm",onClick:async()=>{a(""),r("");try{i(!0);const e=String(g||"").trim().toLowerCase();await f.requestPasswordReset(e),r("Check your email to reset your password.")}catch(e){const o=String((e==null?void 0:e.message)||"").toLowerCase();o.includes("rate")&&o.includes("limit")?a("Too many reset requests. Please wait a few minutes and try again."):a((e==null?void 0:e.message)||"Reset request failed")}finally{i(!1)}},disabled:!g||x,children:x?"Sending…":"Send reset email"})]})})]}),s.jsxs("div",{className:"mt-8 text-center",children:[s.jsx("p",{className:"text-slate-600",children:n("login.no_account")}),s.jsx(c,{variant:"ghost",onClick:()=>w("REGISTRATION"),className:"text-brand-700 font-bold hover:bg-brand-50 mt-1",children:n("login.create")})]})]})};export{V as LoginView};
