import{a as t,j as e,ag as _,aG as z,z as L}from"./vendor-react-DZ0IVLBb.js";import{B as y}from"./Button-BzswROfv.js";import{I as C}from"./Input-D28zJcRZ.js";import{m as o}from"./index-Cbj0oizH.js";import"./vendor-CCVjAPEY.js";import"./vendor-maps-S3fC-LOA.js";import"./vendor-jspdf-Bd23t5aa.js";import"./vendor-supabase-ChvUvA8t.js";const V=({setView:R})=>{const[r,m]=t.useState(""),[h,u]=t.useState(""),[f,a]=t.useState(""),[x,p]=t.useState(""),[w,g]=t.useState(!1),[n,b]=t.useState(!1),[E,j]=t.useState(!1);t.useEffect(()=>{let s=!0;return(async()=>{const i=window.location.hash||"",l=window.location.search||"",S=new URLSearchParams(i.startsWith("#")?i.slice(1):i),c=new URLSearchParams(l.startsWith("?")?l.slice(1):l),k=S.get("access_token")||c.get("access_token"),v=S.get("refresh_token")||c.get("refresh_token"),N=c.get("code");N?await o.auth.exchangeCodeForSession(N):k&&v&&await o.auth.setSession({access_token:k,refresh_token:v});const{data:d,error:U}=await o.auth.getSession();if(!s)return;if(U){a("Unable to validate reset link. Please request a new one."),g(!0),j(!1);return}const P=d==null?void 0:d.session;j(!!P),g(!0),P||a("Reset link is invalid or expired. Please request a new one.")})(),()=>{s=!1}},[]);const I=async()=>{if(a(""),p(""),!r||r.length<8){a("Password must be at least 8 characters.");return}if(r!==h){a("Passwords do not match.");return}try{b(!0);const{error:s}=await o.auth.updateUser({password:r});if(s)throw s;p("Password updated. You can log in now."),m(""),u("")}catch(s){a((s==null?void 0:s.message)||"Password reset failed.")}finally{b(!1)}};return e.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col p-6 animate-fade-in pb-safe justify-center max-w-sm mx-auto w-full",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-brand-100 rounded-full flex items-center justify-center mx-auto mb-4 text-brand-700 border border-brand-200",children:e.jsx(_,{size:32})}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Reset Password"}),e.jsx("p",{className:"text-slate-600 font-medium",children:"Set a new password for your account."})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-slate-200 shadow-sm space-y-4",children:[e.jsx(C,{disabled:!w||!E||n,label:"New Password",type:"password",placeholder:"New password",value:r,onChange:s=>m(s.target.value),className:"border-slate-300"}),e.jsx(C,{label:"Confirm Password",type:"password",placeholder:"Confirm password",value:h,onChange:s=>u(s.target.value),className:"border-slate-300"}),f&&e.jsxs("div",{className:"flex items-start gap-2 text-sm text-red-600 bg-red-50 p-3 rounded-lg",children:[e.jsx(z,{size:16,className:"mt-0.5 shrink-0"}),e.jsx("span",{children:f})]}),x&&e.jsxs("div",{className:"flex items-start gap-2 text-sm text-emerald-700 bg-emerald-50 p-3 rounded-lg",children:[e.jsx(L,{size:16,className:"mt-0.5 shrink-0"}),e.jsx("span",{children:x})]}),e.jsx(y,{fullWidth:!0,size:"lg",onClick:I,className:"font-bold shadow-md",disabled:!w||n,children:n?"Savingâ€¦":"Update Password"}),e.jsx(y,{fullWidth:!0,variant:"outline",onClick:()=>R("LOGIN"),className:"border-slate-300 text-slate-900 font-bold",children:"Back to Login"})]})]})};export{V as ResetPasswordView};
