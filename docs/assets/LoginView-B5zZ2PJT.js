import{c as R,r as t,j as s,E as L,S as x}from"./index-DBXkWCLS.js";import{B as d}from"./Button-BRkmOIV9.js";import{I as m}from"./Input-Cb4un1zL.js";import{t as l}from"./translations-DeR-J9wz.js";import{M as z}from"./mail-lKc1Jrl5.js";import{O as A}from"./octagon-alert-QRDSCsqC.js";import{C as M}from"./circle-question-mark-kwVVx9e6.js";/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]],O=R("key-round",F);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]],q=R("log-in",_),V=({setView:f})=>{const[B,D]=t.useState(""),[r,k]=t.useState(""),[n,C]=t.useState(""),[w,a]=t.useState(""),[b,o]=t.useState(""),[u,E]=t.useState(""),[y,h]=t.useState(!1),[I,j]=t.useState(!1),[g,v]=t.useState(""),[N,S]=t.useState(!1),[p,i]=t.useState(!1);t.useEffect(()=>{const e=window.location.hash||"",c=window.location.search||"";(e.includes("type=recovery")||c.includes("type=recovery"))&&(j(!0),h(!0),o("Enter a new password to finish resetting your account."))},[]);const P=async()=>{a(""),o("");try{if(S(!0),!r||!n){a("Email and password are required.");return}console.log("Attempting login with email:",r),await x.loginWithCredentials(r,n);const e=x.getProfile();console.log("Login successful! Profile:",{id:e.id,name:e.fullName,role:e.role,onboardComplete:e.onboardComplete}),console.log("Redirecting to DASHBOARD"),f("DASHBOARD")}catch(e){console.error("Login error:",e),a((e==null?void 0:e.message)||"Login failed.")}finally{S(!1)}};return s.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col p-6 animate-fade-in pb-safe justify-center max-w-sm mx-auto w-full",children:[s.jsxs("div",{className:"text-center mb-8",children:[s.jsx("div",{className:"w-16 h-16 bg-brand-100 rounded-full flex items-center justify-center mx-auto mb-4 text-brand-700 border border-brand-200",children:s.jsx(q,{size:32})}),s.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:l("login.welcome")}),s.jsx("p",{className:"text-slate-600 font-medium",children:l("login.subtitle")})]}),s.jsxs("div",{className:"bg-white p-6 rounded-xl border border-slate-200 shadow-sm space-y-4",children:[s.jsx("h2",{className:"text-sm font-bold text-slate-700 uppercase",children:"Email Login"}),s.jsx(m,{label:"Email",placeholder:"you@example.com",value:r,onChange:e=>k(e.target.value),className:"border-slate-300",leftIcon:s.jsx(z,{size:16})}),s.jsx(m,{label:"Password",type:"password",placeholder:"Your password",value:n,onChange:e=>C(e.target.value),className:"border-slate-300",leftIcon:s.jsx(O,{size:16})}),w&&s.jsxs("div",{className:"flex items-start gap-2 text-sm text-red-600 bg-red-50 p-3 rounded-lg",children:[s.jsx(A,{size:16,className:"mt-0.5 shrink-0"}),s.jsx("span",{children:w})]}),b&&s.jsxs("div",{className:"flex items-start gap-2 text-sm text-emerald-700 bg-emerald-50 p-3 rounded-lg",children:[s.jsx(M,{size:16,className:"mt-0.5 shrink-0"}),s.jsx("span",{children:b})]}),s.jsx(d,{fullWidth:!0,size:"lg",onClick:P,className:"font-bold shadow-md",disabled:!r||!n||N,children:N?"Signing in…":l("login.btn")}),s.jsx("button",{className:"text-sm text-brand-600 font-semibold underline",onClick:()=>h(!y),children:"Forgot password?"}),y&&s.jsx("div",{className:"space-y-3 border border-slate-200 rounded-lg p-3 bg-slate-50",children:I?s.jsxs(s.Fragment,{children:[s.jsx(m,{label:"New Password",type:"password",placeholder:"New password",value:g,onChange:e=>v(e.target.value)}),s.jsx(d,{size:"sm",onClick:async()=>{a(""),o("");try{i(!0);const{error:e}=await L.auth.updateUser({password:g});if(e)throw e;o("Password updated. You can log in now."),j(!1),h(!1),v(""),window.history.replaceState({},document.title,window.location.pathname)}catch(e){a((e==null?void 0:e.message)||"Password reset failed")}finally{i(!1)}},disabled:!g,children:p?"Saving…":"Set new password"})]}):s.jsxs(s.Fragment,{children:[s.jsx(m,{label:"Email for reset",placeholder:"you@example.com",value:u,onChange:e=>E(e.target.value)}),s.jsx(d,{size:"sm",onClick:async()=>{a(""),o("");try{i(!0),await x.requestPasswordReset(u),o("Check your email to reset your password.")}catch(e){const c=String((e==null?void 0:e.message)||"").toLowerCase();c.includes("rate")&&c.includes("limit")?a("Too many reset requests. Please wait a few minutes and try again."):a((e==null?void 0:e.message)||"Reset request failed")}finally{i(!1)}},disabled:!u||p,children:p?"Sending…":"Send reset email"})]})})]}),s.jsxs("div",{className:"mt-8 text-center",children:[s.jsx("p",{className:"text-slate-600",children:l("login.no_account")}),s.jsx(d,{variant:"ghost",onClick:()=>f("REGISTRATION"),className:"text-brand-700 font-bold hover:bg-brand-50 mt-1",children:l("login.create")})]})]})};export{V as LoginView};
