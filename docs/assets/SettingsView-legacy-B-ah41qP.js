System.register(["./index-legacy-CBJaRI7y.js","./Input-legacy-CPbitdLs.js","./Button-legacy-7JcGJbKP.js","./HouseholdManager-legacy-DXDX5C0E.js","./check-legacy-CKAWtMvp.js","./supabaseClient-legacy-C8OzX_Zs.js","./translations-legacy-CsVMiQJ8.js","./x-legacy-BkTJWami.js","./arrow-left-legacy-BCEH-quZ.js","./download-legacy-C35tIgsH.js","./circle-check-big-legacy-C92HfSPk.js","./users-legacy-B4iQSQp3.js","./copy-legacy-D0Z_mpk4.js","./shield-check-legacy-CjVzIAbn.js","./map-pin-legacy-_ytGCQvV.js","./user-legacy-C3w2Q7Mi.js","./truck-legacy-CzVSMvou.js","./mail-legacy-D4Tus-rg.js","./phone-legacy-CJ3VX-IB.js","./search-legacy-SBSbwudi.js","./building-2-legacy-C4H5LmUt.js","./radio-legacy-di6rQFpj.js","./save-legacy-CDIHckZ0.js","./globe-legacy-BH8ukcHr.js","./lock-legacy-DI8res7Z.js","./file-text-legacy-BCNsxWTK.js","./loader-circle-legacy-D8bpLPmH.js"],function(e,s){"use strict";var t,a,l,n,r,i,o,d,c,x,m,h,p,u,b,g,j,f,N,v,y,w,C,k,S,I,A,D,z,R,E,P,L,M,O,U,T,V,_,B,$,q,F,H,G,Y,W,J,Z,Q,X,K,ee,se,te;return{setters:[e=>{t=e.c,a=e.r,l=e.j,n=e.S,r=e.i,i=e.f,o=e.e,d=e.h,c=e.k,x=e.l,m=e.m,h=e.o,p=e.p,u=e.q,b=e.s,g=e.t,j=e.u,f=e.v,N=e.w,v=e.x,y=e.d,w=e.y,C=e.z,k=e.A},e=>{S=e.T,I=e.I},e=>{A=e.B},e=>{D=e.H},e=>{z=e.C},e=>{R=e.s},e=>{E=e.t},e=>{P=e.X},e=>{L=e.A},e=>{M=e.D},e=>{O=e.C},e=>{U=e.A,T=e.U},e=>{V=e.C},e=>{_=e.S},e=>{B=e.M},e=>{$=e.U},e=>{q=e.T},e=>{F=e.M},e=>{H=e.P},e=>{G=e.S},e=>{Y=e.B},e=>{W=e.A,J=e.R},e=>{Z=e.H,Q=e.S},e=>{X=e.G},e=>{K=e.L},e=>{ee=e.F,se=e.C},e=>{te=e.L}],execute:function(){
/**
       * @license lucide-react v0.556.0 - ISC
       *
       * This source code is licensed under the ISC license.
       * See the LICENSE file in the root directory of this source tree.
       */
const s=t("ban",[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),ae=t("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),le=t("database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),ne=t("eraser",[["path",{d:"M21 21H8a2 2 0 0 1-1.42-.587l-3.994-3.999a2 2 0 0 1 0-2.828l10-10a2 2 0 0 1 2.829 0l5.999 6a2 2 0 0 1 0 2.828L12.834 21",key:"g5wo59"}],["path",{d:"m5.082 11.09 8.828 8.828",key:"1wx5vj"}]]),re=t("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),ie=t("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]),oe=t("pen-tool",[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]]),de=t("printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]),ce=t("refresh-ccw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]),xe=t("square-check-big",[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),me=({onSave:e,className:s})=>{const t=a.useRef(null),[n,r]=a.useState(!1),[i,o]=a.useState(!1);a.useEffect(()=>{const e=t.current;if(e){const s=e.getBoundingClientRect();e.width=s.width,e.height=s.height;const t=e.getContext("2d");t&&(t.lineWidth=2,t.lineCap="round",t.strokeStyle="#000")}},[]);const d=e=>{const s=t.current;if(!s)return{x:0,y:0};const a=s.getBoundingClientRect();let l,n;return"touches"in e?(l=e.touches[0].clientX,n=e.touches[0].clientY):(l=e.clientX,n=e.clientY),{x:l-a.left,y:n-a.top}},c=e=>{var s;e.preventDefault(),r(!0);const a=null===(s=t.current)||void 0===s?void 0:s.getContext("2d");if(a){const{x:s,y:t}=d(e);a.beginPath(),a.moveTo(s,t)}},x=e=>{var s;if(!n)return;e.preventDefault();const a=null===(s=t.current)||void 0===s?void 0:s.getContext("2d");if(a){const{x:s,y:t}=d(e);a.lineTo(s,t),a.stroke(),o(!0)}},m=()=>{r(!1)};return l.jsxs("div",{className:`space-y-3 ${s}`,children:[l.jsxs("div",{className:"border-2 border-slate-300 rounded-xl overflow-hidden bg-white shadow-inner relative",children:[l.jsx("canvas",{ref:t,className:"w-full h-40 touch-none cursor-crosshair block",onMouseDown:c,onMouseMove:x,onMouseUp:m,onMouseLeave:m,onTouchStart:c,onTouchMove:x,onTouchEnd:m}),l.jsx("div",{className:"absolute bottom-2 left-4 text-xs text-slate-300 pointer-events-none font-bold uppercase select-none",children:"Sign Here"})]}),l.jsxs("div",{className:"flex gap-3",children:[l.jsxs(A,{variant:"outline",onClick:()=>{const e=t.current,s=null==e?void 0:e.getContext("2d");e&&s&&(s.clearRect(0,0,e.width,e.height),o(!1))},size:"sm",className:"flex-1 text-slate-500 border-slate-300",children:[l.jsx(ne,{size:16,className:"mr-2"})," Clear"]}),l.jsxs(A,{onClick:()=>{if(t.current){const s=t.current.toDataURL("image/png");e(s)}},size:"sm",disabled:!i,className:"flex-1 font-bold bg-blue-600 hover:bg-blue-700 text-white",children:[l.jsx(z,{size:16,className:"mr-2"})," Apply Signature"]})]})]})},he=e=>{if(!e)return e;const s=e.replace(/[^\d]/g,""),t=s.length;return t<4?s:t<7?`(${s.slice(0,3)}) ${s.slice(3)}`:`(${s.slice(0,3)}) ${s.slice(3,6)}-${s.slice(6,10)}`},pe=e=>{const s=String(e||"").toUpperCase().replace(/[–—−]/g,"-").replace(/[^A-Z0-9-]/g,"").replace(/-+/g,"-");return s.length<=2||s.includes("-")?s:`${s.slice(0,2)}-${s.slice(2)}`},ue=e=>{const s=String(e||"").replace(/\D/g,"");return s.length<4?e:`***-***-${s.slice(-4)}`},be=[{id:"ADMIN",label:"Administrator",description:"Full system access and user management.",permissions:{canViewPII:!0,canDispatchDrone:!0,canApproveFunds:!0,canManageInventory:!0,canBroadcastAlerts:!0}},{id:"FIRST_RESPONDER",label:"First Responder",description:"Field access to location data and medical info.",permissions:{canViewPII:!0,canDispatchDrone:!1,canApproveFunds:!1,canManageInventory:!1,canBroadcastAlerts:!0}},{id:"LOCAL_AUTHORITY",label:"Local Authority",description:"Oversight of alerts and population tracking.",permissions:{canViewPII:!1,canDispatchDrone:!1,canApproveFunds:!0,canManageInventory:!1,canBroadcastAlerts:!0}},{id:"CONTRACTOR",label:"Contractor",description:"Logistics and repair management.",permissions:{canViewPII:!1,canDispatchDrone:!1,canApproveFunds:!1,canManageInventory:!0,canBroadcastAlerts:!1}},{id:"INSTITUTION_ADMIN",label:"Institution Admin",description:"Manage community members and hub inventory.",permissions:{canViewPII:!1,canDispatchDrone:!1,canApproveFunds:!1,canManageInventory:!0,canBroadcastAlerts:!0}},{id:"GENERAL_USER",label:"General User",description:"Standard access to report emergencies.",permissions:{canViewPII:!1,canDispatchDrone:!1,canApproveFunds:!1,canManageInventory:!1,canBroadcastAlerts:!1}}];e("SettingsView",({setView:e})=>{const t=void 0,ne=a.useRef(null),ge=a.useRef(null),je=a.useRef(null),fe=a.useRef(null),Ne=a.useRef(null),[ve,ye]=a.useState({profile:!1,household:!1,contacts:!1,community:!1,security:!1}),[we,Ce]=a.useState({profile:!1,household:!1,contacts:!1,community:!1,security:!1}),[ke,Se]=a.useState({id:"",fullName:"",phone:"",address:"",householdMembers:1,household:[],zipCode:"",petDetails:"",medicalNeeds:"",medicationDependency:!1,insulinDependency:!1,oxygenPoweredDevice:!1,mobilityLimitation:!1,transportationAccess:!0,financialStrain:!1,consentPreparednessPlanning:!1,emergencyContactName:"",emergencyContactPhone:"",emergencyContactRelation:"",communityId:"",role:"GENERAL_USER",language:"en",active:!0,notifications:{push:!0,sms:!0,email:!0}}),Ie=String(ke.role||"").toUpperCase(),Ae=["ADMIN","STATE_ADMIN","COUNTY_ADMIN","ORG_ADMIN","INSTITUTION_ADMIN"].includes(Ie),De=String(ke.address||"").trim().length>0&&Boolean(t)&&!ke.addressVerified,ze=ke.addressVerifiedAt?new Date(ke.addressVerifiedAt).toLocaleString():null,[Re,Ee]=a.useState("MAIN"),[Pe,Le]=a.useState(!1),[Me,Oe]=a.useState(!1),[Ue,Te]=a.useState(null),[Ve,_e]=a.useState(null),[Be,$e]=a.useState(!1),[qe,Fe]=a.useState(null),[He,Ge]=a.useState("IDLE"),[Ye,We]=a.useState([]),[Je,Ze]=a.useState(!1),[Qe,Xe]=a.useState(-1),[Ke,es]=a.useState("ALL_USERS"),[ss,ts]=a.useState(()=>n.getRoles()||be),[as,ls]=a.useState([]),[ns,rs]=a.useState(""),[is,os]=a.useState(null),[ds,cs]=a.useState(null),[xs,ms]=a.useState([]),[hs,ps]=a.useState(""),[us,bs]=a.useState(null),[gs,js]=a.useState([]),[fs,Ns]=a.useState(!1),[vs,ys]=a.useState([]),[ws,Cs]=a.useState(null),[ks,Ss]=a.useState({}),[Is,As]=a.useState(!1),[Ds,zs]=a.useState(!1),[Rs,Es]=a.useState(null),[Ps,Ls]=a.useState(null),[Ms,Os]=a.useState(""),[Us,Ts]=a.useState(null),[Vs,_s]=a.useState(null),[Bs,$s]=a.useState(!1),[qs,Fs]=a.useState([]),[Hs,Gs]=a.useState(null),[Ys,Ws]=a.useState(null),[Js,Zs]=a.useState(null),[Qs,Xs]=a.useState([]),[Ks,et]=a.useState([]),[st,tt]=a.useState([]),[at,lt]=a.useState(!1),[nt,rt]=a.useState([]),[it,ot]=a.useState(null),[dt,ct]=a.useState(!1),xt=e=>{ye(s=>({...s,[e]:!s[e]}))},mt=e=>{Ce(s=>({...s,[e]:!s[e]}))},ht=e=>{ye(s=>({...s,[e]:!0}));const s="profile"===e?ge:"contacts"===e?je:"household"===e?fe:"community"===e?ne:Ne;window.setTimeout(()=>{var e;null===(e=s.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"start"})},50)},[pt,ut]=a.useState(""),bt=e=>{Se(s=>({...s,householdId:e.householdId,householdCode:e.householdCode,householdName:e.householdName,householdRole:e.householdRole}));const s=n.getProfile();n.saveProfile({...s,householdId:e.householdId,householdCode:e.householdCode,householdName:e.householdName,householdRole:e.householdRole})};a.useEffect(()=>{const e=n.getProfile();if(e.role||(e.role="GENERAL_USER"),e.language||(e.language="en"),void 0===e.active&&(e.active=!0),e.household||(e.household=[]),"string"!=typeof e.zipCode&&(e.zipCode=""),"boolean"!=typeof e.medicationDependency&&(e.medicationDependency=!1),"boolean"!=typeof e.insulinDependency&&(e.insulinDependency=!1),"boolean"!=typeof e.oxygenPoweredDevice&&(e.oxygenPoweredDevice=!1),"boolean"!=typeof e.mobilityLimitation&&(e.mobilityLimitation=!1),"boolean"!=typeof e.transportationAccess&&(e.transportationAccess=!0),"boolean"!=typeof e.financialStrain&&(e.financialStrain=!1),"boolean"!=typeof e.consentPreparednessPlanning&&(e.consentPreparednessPlanning=!1),Se(e),e.addressVerified?Ge("VALID"):e.address&&e.address.length>5&&Ge("IDLE"),e.communityId&&"INSTITUTION_ADMIN"!==e.role){const s=n.getOrganization(e.communityId);s&&Te(s.name)}},[]),a.useEffect(()=>{let e=!0;return(async()=>{try{const[s,t]=await Promise.all([i(),o()]);if(!e)return;if(s||t){const e={...n.getProfile(),...s||{},...t||{}};n.saveProfile(e),Se(e),Ge(e.addressVerified?"VALID":"IDLE")}const a=await d();if(!e)return;if(a)bt(a);else{const s=await c();if(!e)return;bt(s)}try{const s=await x();e&&tt(s)}catch{e&&tt([])}}catch{}})(),()=>{e=!1}},[]),a.useEffect(()=>{Ae||"MAIN"===Re||Ee("MAIN")},[Ae,Re]),a.useEffect(()=>{if("TRUSTED_COMMUNITY"!==sessionStorage.getItem("settingsScrollTarget"))return;const e=window.setTimeout(()=>{var e;ye(e=>({...e,community:!0})),null===(e=ne.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"start"}),sessionStorage.removeItem("settingsScrollTarget")},150);return()=>window.clearTimeout(e)},[]),a.useEffect(()=>{const e=Array.isArray(ke.household)?ke.household.length:0;e>0&&ke.householdMembers!==e&&Se(s=>({...s,householdMembers:e}))},[ke.household,ke.householdMembers]),a.useEffect(()=>{let e=!0;return(async()=>{if(ke.householdId)try{const s=await m();e&&Fs(s)}catch{e&&Fs([])}else Fs([])})(),()=>{e=!1}},[ke.householdId]),a.useEffect(()=>{let e=!0;return(async()=>{try{const s=await x();e&&tt(s)}catch{e&&tt([])}})(),()=>{e=!1}},[ke.householdId,ke.householdRole]),a.useEffect(()=>{let e=!0;return(async()=>{ke.householdId||(Xs([]),et([]));try{const[s,t]=await Promise.all([h(),p()]);if(!e)return;Xs(s),et(t)}catch{if(!e)return;Xs([]),et([])}try{const s=await u(50);e&&rt(s)}catch{e&&rt([])}})(),()=>{e=!1}},[ke.householdId,ke.householdRole]),a.useEffect(()=>{let e=null,s=!0;return(async()=>{try{e=await(async e=>{const s=R.channel("notifications").on("postgres_changes",{event:"*",schema:"public",table:"notifications"},s=>e(s)).subscribe();return()=>{R.removeChannel(s)}})(async()=>{if(s)try{const[e,t,a]=await Promise.all([u(50),h(),p()]);if(!s)return;rt(e),Xs(t),et(a)}catch{}})}catch{e=null}})(),()=>{s=!1,e&&e()}},[]),a.useEffect(()=>{if(us){const e=n.getOrgMembers(us.id);js(e),n.fetchOrgMembersRemote(us.id).then(({members:e,fromCache:s})=>{js(e),Ns(s)}).catch(()=>Ns(!0))}else js([])},[us]);const gt=e=>/^[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}$/.test(e)?(Fe(null),!0):(Fe("Invalid format. Use 555-123-4567"),!1),jt=async e=>{};a.useEffect(()=>(String(ke.address||"").trim(),We([]),void Xe(-1)),[ke.address,ke.addressVerified,t]);const ft=async e=>{var s;(null!==(s=null!=e?e:ke.address)&&void 0!==s?s:"").trim().length,Ge("IDLE")},Nt=async()=>{const e=String(ke.address||"").trim();if(!gt(ke.phone))return ye(e=>({...e,profile:!0})),void alert("Please fix phone number errors before saving.");if(e.length,"INVALID"===He)return ye(e=>({...e,profile:!0})),void alert("Please verify your address.");As(!0),Es(null);try{await w({fullName:ke.fullName,phone:ke.phone,email:ke.email,address:ke.address,addressLine1:ke.addressLine1,addressLine2:ke.addressLine2,city:ke.city,state:ke.state,zip:ke.zipCode,latitude:ke.latitude,longitude:ke.longitude,googlePlaceId:ke.googlePlaceId,addressVerified:Boolean(ke.addressVerified),addressVerifiedAt:ke.addressVerifiedAt,emergencyContactName:ke.emergencyContactName,emergencyContactPhone:ke.emergencyContactPhone,emergencyContactRelation:ke.emergencyContactRelation,communityId:ke.communityId,role:ke.role}),n.saveProfile(ke),Le(!0),setTimeout(()=>Le(!1),2e3)}catch(s){Es((null==s?void 0:s.message)||"Unable to update profile.")}finally{As(!1)}},vt=async()=>{var e;if(null===(e=ke.zipCode)||void 0===e||!e.trim())return ye(e=>({...e,profile:!0})),void Ls("ZIP is pulled from your Home Address. Verify your address in Identity first.");const s=C(ke.household||[]);if(!s.ok)return ye(e=>({...e,household:!0})),void Ls(s.error);if(!ke.consentPreparednessPlanning)return ye(e=>({...e,security:!0})),void Ls("You must provide consent before saving Vital Intake.");zs(!0),Ls(null);try{await k({household:ke.household,householdMembers:ke.householdMembers,petDetails:ke.petDetails,medicalNeeds:ke.medicalNeeds,zipCode:ke.zipCode,medicationDependency:Boolean(ke.medicationDependency),insulinDependency:Boolean(ke.insulinDependency),oxygenPoweredDevice:Boolean(ke.oxygenPoweredDevice),mobilityLimitation:Boolean(ke.mobilityLimitation),transportationAccess:Boolean(ke.transportationAccess),financialStrain:Boolean(ke.financialStrain),consentPreparednessPlanning:Boolean(ke.consentPreparednessPlanning)});const e={...ke,consentTimestamp:(new Date).toISOString()};Se(e),n.saveProfile(e),Le(!0),setTimeout(()=>Le(!1),2e3)}catch(t){Ls((null==t?void 0:t.message)||"Unable to update vitals.")}finally{zs(!1)}},yt=(e,s)=>{Se(t=>{const a={...t,[e]:s};return"address"===e&&(a.addressVerified=!1,a.addressVerifiedAt=void 0,a.googlePlaceId=void 0,a.latitude=void 0,a.longitude=void 0,a.addressLine1=void 0,a.addressLine2=void 0,a.city=void 0,a.state=void 0),a}),"communityId"===e&&(Te(null),_e(null)),"address"===e&&(Ge("IDLE"),We([]),Xe(-1),Es(null))},wt=async()=>{const e=String(ke.communityId||"").trim().replace(/[–—−]/g,"-").replace(/\s+/g,"").toUpperCase();if(e){Oe(!0),_e(null),Te(null);try{const s=n.getOrganization(e),t=s?{orgCode:e,orgName:s.name}:await y(e);if(!t)return void _e("Invalid Community ID");const a=t.orgName||(null==s?void 0:s.name)||e,l={...ke,communityId:e};Se(l),n.saveProfile(l),Te(a);try{await w({fullName:l.fullName,phone:l.phone,email:l.email,address:l.address,addressLine1:l.addressLine1,addressLine2:l.addressLine2,city:l.city,state:l.state,zip:l.zipCode,latitude:l.latitude,longitude:l.longitude,googlePlaceId:l.googlePlaceId,addressVerified:Boolean(l.addressVerified),addressVerifiedAt:l.addressVerifiedAt,emergencyContactName:l.emergencyContactName,emergencyContactPhone:l.emergencyContactPhone,emergencyContactRelation:l.emergencyContactRelation,communityId:e,role:l.role})}catch{}}catch{_e("Unable to verify Community ID right now. Please try again.")}finally{Oe(!1)}}},Ct=e=>{navigator.clipboard.writeText(e),alert("Copied to clipboard")},kt=async(e,s)=>{const t=`AERA household invite for ${e}`,a=encodeURIComponent(s),l=encodeURIComponent(t);if(navigator.share)try{return await navigator.share({title:t,text:s}),{method:"native",copied:!1}}catch(r){if("AbortError"===(null==r?void 0:r.name))return{method:"cancelled",copied:!1}}let n=!1;try{await navigator.clipboard.writeText(s),n=!0}catch{n=!1}try{return window.location.href=`mailto:?subject=${l}&body=${a}`,{method:"email",copied:n}}catch{if(n)return{method:"clipboard",copied:n};throw new Error("Unable to open share options on this device.")}},St=e=>{const s=(ke.householdCode||"").trim().toUpperCase(),t=(e.id||"").replace(/[^A-Z0-9]/gi,"").toUpperCase().slice(-3),a=((e.name||"").replace(/[^A-Z0-9]/gi,"").toUpperCase().slice(0,3)||t||"MEM").padEnd(3,"X").slice(0,3);return s?`${s}-${a}`:a},It=(ke.household||[]).filter(e=>e.loginEnabled),At=a.useMemo(()=>{const e={};return qs.forEach(s=>{s.inviteeMemberRef&&(e[s.inviteeMemberRef]||(e[s.inviteeMemberRef]=s))}),e},[qs]),Dt=a.useMemo(()=>Qs.filter(e=>"pending"===e.status),[Qs]),zt=a.useMemo(()=>Ks[0]||null,[Ks]),Rt=a.useMemo(()=>nt.filter(e=>!e.read).length,[nt]),Et=async(e,s)=>{Ts(null),_s(null),ot(e.id);try{await j(e.id,s);const[t,a,l]=await Promise.all([h(),p(),u(50)]);Xs(t),et(a),rt(l),_s("approved"===s?"Connection successful. This member has been added.":"Request rejected.")}catch(t){Ts((null==t?void 0:t.message)||"Unable to resolve request right now.")}finally{ot(null)}},Pt=()=>{const e=as.map(e=>[e.id,`"${e.fullName.replace(/"/g,'""')}"`,e.phone,e.role,e.active?"Active":"Inactive",`"${e.address.replace(/"/g,'""')}"`,e.communityId||"N/A",e.householdMembers]),s=[["ID","Name","Phone","Role","Status","Address","Community ID","Household Size"].join(","),...e.map(e=>e.join(","))].join("\n"),t=new Blob([s],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(t),l=document.createElement("a");l.href=a,l.setAttribute("download",`AERA_User_Directory_${(new Date).toISOString().split("T")[0]}.csv`),document.body.appendChild(l),l.click(),document.body.removeChild(l)},Lt=()=>{n.updateSystemTicker(pt),alert("Global System Alert Updated")},Mt=e=>{Se(s=>{const t={...s,language:e};return n.saveProfile(t),t}),Le(!0),setTimeout(()=>Le(!1),1e3)},Ot=e=>{Ss({}),Cs(e)},Ut=(e,s)=>{Ss(t=>({...t,[e]:s}))},Tt=(e,s)=>{if(ws){n.signReplenishmentRequest(ws.id,e,s);const t={...ws};"RELEASE"===s?(t.signature=e,t.signedAt=(new Date).toISOString()):(t.receivedSignature=e,t.receivedAt=(new Date).toISOString()),Cs(t),ys(e=>e.map(e=>e.id===ws.id?t:e))}},Vt=()=>{const e=vs.map(e=>[e.id,`"${e.orgName.replace(/"/g,'""')}"`,e.orgId,`"${e.item.replace(/"/g,'""')}"`,e.quantity,e.status,new Date(e.timestamp).toLocaleDateString(),`"${e.provider.replace(/"/g,'""')}"`,e.signature?"Yes":"No",e.receivedSignature?"Yes":"No"]),s=[["Request ID","Org Name","Org ID","Item","Quantity","Status","Date","Provider","Released","Received"].join(","),...e.map(e=>e.join(","))].join("\n"),t=new Blob([s],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(t),l=document.createElement("a");l.href=a,l.setAttribute("download",`AERA_Master_Inventory_${(new Date).toISOString().split("T")[0]}.csv`),document.body.appendChild(l),l.click(),document.body.removeChild(l)},_t=()=>{const e=vs.reduce((e,s)=>(e[s.item]=(e[s.item]||0)+s.quantity,e),{}),s=Object.entries(e).map(([e,s])=>[`"${e.replace(/"/g,'""')}"`,s]),t=[["Item Name","Total Quantity"].join(","),...s.map(e=>e.join(","))].join("\n"),a=new Blob([t],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(a),n=document.createElement("a");n.href=l,n.setAttribute("download",`AERA_Inventory_Tally_${(new Date).toISOString().split("T")[0]}.csv`),document.body.appendChild(n),n.click(),document.body.removeChild(n)};if(ws){const e=n.getOrganization(ws.orgId);return l.jsxs("div",{className:"fixed inset-0 z-[100] overflow-y-auto bg-white p-8 font-serif text-black animate-fade-in print:p-0 print:bg-white print:text-black print:static print:overflow-visible",children:[l.jsxs("div",{className:"fixed top-0 left-0 right-0 p-4 bg-slate-900 text-white flex justify-between items-center print:hidden shadow-lg z-50",children:[l.jsx("span",{className:"font-bold",children:"Work Order Preview"}),l.jsxs("div",{className:"flex gap-2",children:[l.jsxs(A,{size:"sm",className:"bg-brand-600 text-white",onClick:()=>window.print(),children:[l.jsx(de,{size:16,className:"mr-2"})," Print Now"]}),l.jsxs(A,{size:"sm",variant:"secondary",onClick:()=>Cs(null),children:[l.jsx(P,{size:16,className:"mr-2"})," Close"]})]})]}),l.jsxs("div",{className:"max-w-3xl mx-auto border border-black p-8 mt-16 print:mt-0 print:border-0 print:w-full",children:[l.jsxs("div",{className:"flex justify-between items-start border-b-2 border-black pb-4 mb-6",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-4xl font-bold uppercase tracking-tight",children:"Work Order"}),l.jsx("p",{className:"text-sm font-bold uppercase mt-1",children:"AERA Logistics Fulfillment"})]}),l.jsxs("div",{className:"text-right",children:[l.jsxs("p",{className:"text-sm",children:[l.jsx("strong",{children:"Order ID:"})," ",ws.id]}),l.jsxs("p",{className:"text-sm",children:[l.jsx("strong",{children:"Printed On:"})," ",(new Date).toLocaleDateString()]}),l.jsxs("p",{className:"text-sm",children:[l.jsx("strong",{children:"Request Date:"})," ",new Date(ws.timestamp).toLocaleDateString()]}),l.jsxs("p",{className:"text-sm",children:[l.jsx("strong",{children:"Provider:"})," ",ws.provider]})]})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-8 mb-8",children:[l.jsxs("div",{children:[l.jsx("h3",{className:"font-bold uppercase border-b border-black mb-2 text-sm",children:"Ship To (Organization)"}),l.jsx("p",{className:"text-lg font-bold",children:ws.orgName}),l.jsx("p",{children:(null==e?void 0:e.address)||"Address Unknown"}),l.jsx("p",{children:null==e?void 0:e.adminContact}),l.jsx("p",{children:null==e?void 0:e.adminPhone}),l.jsxs("p",{className:"mt-2 text-sm font-mono",children:["ID: ",ws.orgId]})]}),l.jsxs("div",{children:[l.jsx("h3",{className:"font-bold uppercase border-b border-black mb-2 text-sm",children:"Fulfillment Instructions"}),l.jsx("p",{className:"text-sm mb-2",children:"Please pick and pack the items listed below. Ensure quality check is performed before release."}),l.jsxs("div",{className:"border border-black p-2 text-center mt-4",children:[l.jsx("p",{className:"text-xs uppercase font-bold",children:"Priority Status"}),l.jsx("p",{className:"text-xl font-bold",children:"URGENT"})]})]})]}),l.jsx("div",{className:"mb-12",children:l.jsxs("table",{className:"w-full border-collapse border border-black",children:[l.jsx("thead",{children:l.jsxs("tr",{className:"bg-slate-100 print:bg-slate-200",children:[l.jsx("th",{className:"border border-black p-2 text-left w-12 print:text-black",children:"#"}),l.jsx("th",{className:"border border-black p-2 text-left print:text-black",children:"Requested Item"}),l.jsx("th",{className:"border border-black p-2 text-center w-24 print:text-black",children:"Qty Req"}),l.jsx("th",{className:"border border-black p-2 text-center w-28 print:text-black",children:"Qty Picked"}),l.jsx("th",{className:"border border-black p-2 text-center w-28 print:text-black",children:"Verified"})]})}),l.jsxs("tbody",{children:[l.jsxs("tr",{children:[l.jsx("td",{className:"border border-black p-3 text-center print:text-black",children:"1"}),l.jsx("td",{className:"border border-black p-3 font-bold text-lg print:text-black",children:ws.item}),l.jsx("td",{className:"border border-black p-3 text-center font-bold text-lg print:text-black",children:ws.quantity}),l.jsx("td",{className:"border border-black p-1",children:l.jsx("input",{className:"w-full h-full text-center font-bold text-lg bg-yellow-50/50 hover:bg-yellow-50 focus:bg-white outline-none transition-colors print:bg-transparent print:border-none",placeholder:"",value:ks.item_picked||"",onChange:e=>Ut("item_picked",e.target.value)})}),l.jsx("td",{className:"border border-black p-1",children:l.jsx("input",{className:"w-full h-full text-center font-medium text-lg bg-yellow-50/50 hover:bg-yellow-50 focus:bg-white outline-none transition-colors print:bg-transparent print:border-none",placeholder:"",value:ks.item_verified||"",onChange:e=>Ut("item_verified",e.target.value)})})]}),[2,3].map(e=>l.jsxs("tr",{children:[l.jsx("td",{className:"border border-black p-3 text-center opacity-50 print:text-black",children:e}),l.jsx("td",{className:"border border-black p-2",children:l.jsxs("div",{className:"flex items-center gap-2 h-full",children:[l.jsx("span",{className:"italic text-slate-500 text-sm whitespace-nowrap print:text-black",children:"Notes/Substitutions:"}),l.jsx("input",{className:"flex-1 bg-transparent border-b border-slate-300 focus:border-blue-500 outline-none text-slate-900 print:border-none print:text-black font-mono",value:ks[`note_${e}`]||"",onChange:s=>Ut(`note_${e}`,s.target.value)})]})}),l.jsx("td",{className:"border border-black p-3"}),l.jsx("td",{className:"border border-black p-3"}),l.jsx("td",{className:"border border-black p-3"})]},e))]})]})}),l.jsxs("div",{className:"grid grid-cols-2 gap-12 mt-12 pt-12",children:[l.jsxs("div",{className:"break-inside-avoid",children:[l.jsx("p",{className:"text-xs font-bold uppercase mb-2",children:"Released By (Signature)"}),ws.signature?l.jsxs("div",{className:"border border-slate-200 p-2 print:border-none",children:[l.jsx("img",{src:ws.signature,alt:"Digital Signature",className:"h-16 mb-1"}),l.jsxs("p",{className:"text-[10px] text-slate-500 font-mono print:text-black",children:["Signed: ",new Date(ws.signedAt||"").toLocaleString()]})]}):l.jsx("div",{className:"print:hidden",children:l.jsx(me,{onSave:e=>Tt(e,"RELEASE")})}),!ws.signature&&l.jsx("div",{className:"hidden print:block border-b border-black mb-2 h-16"})]}),l.jsxs("div",{className:"break-inside-avoid",children:[l.jsx("p",{className:"text-xs font-bold uppercase mb-2",children:"Received By (Signature)"}),ws.receivedSignature?l.jsxs("div",{className:"border border-slate-200 p-2 print:border-none",children:[l.jsx("img",{src:ws.receivedSignature,alt:"Digital Signature",className:"h-16 mb-1"}),l.jsxs("p",{className:"text-[10px] text-slate-500 font-mono print:text-black",children:["Signed: ",new Date(ws.receivedAt||"").toLocaleString()]})]}):l.jsx("div",{className:"print:hidden",children:l.jsx(me,{onSave:e=>Tt(e,"RECEIVE")})}),!ws.receivedSignature&&l.jsx("div",{className:"hidden print:block border-b border-black mb-2 h-16"})]})]}),l.jsx("div",{className:"text-center mt-12 text-xs text-slate-500 print:text-black",children:l.jsxs("p",{children:["Generated by AERA System • ",(new Date).toLocaleString()]})})]})]})}if("MASTER_INVENTORY"===Re){const e=vs.reduce((e,s)=>(e[s.item]=(e[s.item]||0)+s.quantity,e),{});return l.jsxs("div",{className:"p-6 pb-28 space-y-6 animate-fade-in bg-white min-h-screen print:p-0 print:pb-0",children:[l.jsx("div",{className:"flex items-center justify-between border-b border-slate-200 pb-4 sticky top-0 bg-white z-10 print:hidden",children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("button",{onClick:()=>Ee("MAIN"),className:"p-2 -ml-2 text-slate-500 hover:text-slate-800",children:l.jsx(L,{size:24})}),l.jsxs("div",{children:[l.jsx("h1",{className:"text-xl font-bold text-slate-900",children:"Master Inventory Database"}),l.jsx("p",{className:"text-xs text-slate-500",children:"System-Wide Supply Request Aggregation"})]})]})}),l.jsxs("div",{className:"hidden print:block mb-6",children:[l.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"AERA Master Inventory Report"}),l.jsxs("p",{className:"text-sm text-slate-500",children:["Generated on ",(new Date).toLocaleString()]})]}),l.jsxs("div",{className:"space-y-4 print:break-inside-avoid",children:[l.jsxs("div",{className:"flex justify-between items-end border-b-2 border-slate-900 pb-1",children:[l.jsx("h3",{className:"font-bold text-slate-900 uppercase tracking-wider",children:"Total Tally (All Organizations)"}),l.jsxs("button",{onClick:_t,className:"text-xs font-bold text-brand-600 hover:text-brand-700 flex items-center gap-1 print:hidden",children:[l.jsx(M,{size:14})," Export Tally CSV"]})]}),l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[Object.entries(e).map(([e,s])=>l.jsxs("div",{className:"bg-slate-50 border border-slate-200 p-4 rounded-lg print:border-black print:bg-white print:border",children:[l.jsx("p",{className:"text-xs font-bold text-slate-500 uppercase",children:e}),l.jsx("p",{className:"text-2xl font-mono font-bold text-slate-900",children:s})]},e)),0===Object.keys(e).length&&l.jsx("p",{className:"text-slate-500 italic",children:"No requests logged."})]})]}),l.jsxs("div",{className:"space-y-4 mt-8",children:[l.jsxs("div",{className:"flex justify-between items-end border-b-2 border-slate-900 pb-1",children:[l.jsx("h3",{className:"font-bold text-slate-900 uppercase tracking-wider",children:"Request Log"}),l.jsxs(A,{size:"sm",variant:"outline",className:"border-slate-300 text-slate-900 hover:bg-slate-50 print:hidden h-8",onClick:Vt,children:[l.jsx(M,{size:14,className:"mr-2"})," Export Log CSV"]})]}),l.jsx("div",{className:"overflow-x-auto print:overflow-visible",children:l.jsxs("table",{className:"w-full text-left text-sm print:text-xs",children:[l.jsx("thead",{className:"print:table-header-group",children:l.jsxs("tr",{className:"bg-slate-100 print:bg-slate-200",children:[l.jsx("th",{className:"p-3 font-bold text-slate-700",children:"Organization"}),l.jsx("th",{className:"p-3 font-bold text-slate-700",children:"Item"}),l.jsx("th",{className:"p-3 font-bold text-slate-700",children:"Qty"}),l.jsx("th",{className:"p-3 font-bold text-slate-700",children:"Date"}),l.jsx("th",{className:"p-3 font-bold text-slate-700",children:"Status"}),l.jsx("th",{className:"p-3 font-bold text-slate-700 print:hidden",children:"Action"})]})}),l.jsxs("tbody",{className:"divide-y divide-slate-200",children:[vs.map(e=>l.jsxs("tr",{className:"print:break-inside-avoid",children:[l.jsxs("td",{className:"p-3 font-medium text-slate-900",children:[e.orgName," ",l.jsx("span",{className:"text-xs text-slate-500 block",children:e.orgId})]}),l.jsx("td",{className:"p-3 text-slate-700",children:e.item}),l.jsx("td",{className:"p-3 font-mono font-bold text-slate-900",children:e.quantity}),l.jsx("td",{className:"p-3 text-slate-500",children:new Date(e.timestamp).toLocaleDateString()}),l.jsx("td",{className:"p-3",children:l.jsx("span",{className:"px-2 py-1 rounded text-xs font-bold "+("FULFILLED"===e.status?"bg-green-100 text-green-700 print:border print:border-black":"bg-yellow-100 text-yellow-700 print:border print:border-black"),children:e.status})}),l.jsx("td",{className:"p-3 print:hidden",children:l.jsx("div",{className:"flex flex-col gap-2",children:"PENDING"===e.status?l.jsxs("div",{className:"flex gap-2",children:[l.jsxs(A,{size:"sm",onClick:()=>{return s=e.id,n.updateReplenishmentRequestStatus(s,"FULFILLED"),void ys(e=>e.map(e=>e.id===s?{...e,status:"FULFILLED"}:e));var s},className:"bg-green-600 hover:bg-green-700 text-xs py-1 h-8",children:[l.jsx(xe,{size:14,className:"mr-1"})," Fulfill"]}),l.jsx(A,{size:"sm",variant:"outline",onClick:()=>Ot(e),className:"text-xs py-1 h-8 px-2 border-slate-300",title:e.signature?"Print Work Order":"Sign Work Order",children:e.signature&&e.receivedSignature?l.jsx(de,{size:14}):l.jsx(oe,{size:14})})]}):l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(A,{size:"sm",variant:"outline",onClick:()=>Ot(e),className:"text-xs py-1 h-8 px-2 border-slate-300 mr-2",title:"View Signed Order",children:e.signature&&e.receivedSignature?l.jsx(O,{size:14,className:"text-green-600"}):l.jsx(de,{size:14})}),l.jsxs("button",{onClick:()=>{return s=e.id,n.updateReplenishmentRequestStatus(s,"PENDING"),void ys(e=>e.map(e=>e.id===s?{...e,status:"PENDING"}:e));var s},className:"text-xs text-slate-400 hover:text-blue-600 hover:underline flex items-center gap-0.5",title:"Undo Completion",children:[l.jsx(ce,{size:10})," Undo"]})]})})})]},e.id)),0===vs.length&&l.jsx("tr",{children:l.jsx("td",{colSpan:6,className:"p-4 text-center text-slate-500",children:"No requests found."})})]})]})})]}),l.jsx("div",{className:"hidden print:block mt-8 pt-4 border-t border-slate-300 text-center text-xs text-slate-500 fixed bottom-0 left-0 right-0",children:l.jsx("p",{children:"End of Report • AERA System"})})]})}if("BROADCAST_CONTROL"===Re)return l.jsxs("div",{className:"p-6 pb-28 space-y-6 animate-fade-in bg-slate-50 min-h-screen",children:[l.jsxs("div",{className:"flex items-center gap-3 border-b border-slate-200 pb-4 sticky top-0 bg-slate-50 z-10",children:[l.jsx("button",{onClick:()=>Ee("MAIN"),className:"p-2 -ml-2 text-slate-500 hover:text-slate-800",children:l.jsx(L,{size:24})}),l.jsxs("div",{children:[l.jsx("h1",{className:"text-xl font-bold text-slate-900",children:"Broadcast Control"}),l.jsx("p",{className:"text-xs text-slate-500",children:"Manage System & Organization Alerts"})]})]}),l.jsxs("div",{className:"bg-red-50 border border-red-200 p-4 rounded-xl shadow-sm",children:[l.jsxs("h3",{className:"font-bold text-red-900 mb-2 flex items-center gap-2",children:[l.jsx(U,{size:18})," Global System Alert"]}),l.jsx("p",{className:"text-xs text-red-700 mb-3",children:"This message overrides ALL organization broadcasts and is visible to every user."}),l.jsx(S,{className:"bg-white border-red-200 mb-3",value:pt,onChange:e=>ut(e.target.value),placeholder:"Enter high-priority system alert..."}),l.jsxs("div",{className:"flex justify-end gap-2",children:[l.jsx(A,{size:"sm",variant:"ghost",onClick:()=>ut(""),className:"text-slate-500",children:"Clear"}),l.jsx(A,{size:"sm",className:"bg-red-600 hover:bg-red-700",onClick:Lt,children:"Update Global Alert"})]})]}),l.jsx("h3",{className:"font-bold text-slate-900 mt-4",children:"Active Organization Broadcasts"}),l.jsxs("div",{className:"space-y-3",children:[xs.filter(e=>e.currentBroadcast).map(e=>l.jsxs("div",{className:"bg-white border border-slate-200 p-4 rounded-xl shadow-sm",children:[l.jsxs("div",{className:"flex justify-between items-start mb-2",children:[l.jsx("div",{className:"font-bold text-slate-900",children:e.name}),l.jsx("button",{onClick:()=>{return s=e.id,n.clearOrgBroadcast(s),void ms(e=>e.map(e=>e.id===s?{...e,currentBroadcast:void 0}:e));var s},className:"text-xs text-red-600 font-bold hover:underline",children:"Remove"})]}),l.jsxs("div",{className:"bg-slate-50 p-3 rounded text-sm text-slate-700 italic",children:['"',e.currentBroadcast,'"']}),l.jsxs("div",{className:"text-xs text-slate-400 mt-2 text-right",children:["Last Updated: ",new Date(e.lastBroadcastTime||"").toLocaleString()]})]},e.id)),0===xs.filter(e=>e.currentBroadcast).length&&l.jsx("p",{className:"text-center text-slate-400 py-4 italic",children:"No active organization broadcasts."})]})]});if("DB_VIEWER"===Re)return l.jsxs("div",{className:"p-6 pb-28 space-y-6 animate-fade-in bg-slate-900 min-h-screen text-slate-300 font-mono",children:[l.jsxs("div",{className:"flex items-center justify-between border-b border-slate-700 pb-4 sticky top-0 bg-slate-900 z-10",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("button",{onClick:()=>Ee("MAIN"),className:"p-2 -ml-2 text-slate-400 hover:text-white",children:l.jsx(L,{size:24})}),l.jsx("h1",{className:"text-xl font-bold text-white",children:"Database Viewer"})]}),l.jsxs(A,{size:"sm",variant:"ghost",className:"text-brand-400 hover:text-brand-300 hover:bg-slate-800",onClick:()=>Ct(JSON.stringify(ds,null,2)),children:[l.jsx(V,{size:16,className:"mr-2"})," Copy JSON"]})]}),l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"bg-slate-800 p-4 rounded-xl border border-slate-700 overflow-hidden",children:[l.jsxs("h3",{className:"text-brand-400 font-bold mb-2",children:["Users (",null==ds?void 0:ds.users.length,")"]}),l.jsx("pre",{className:"text-xs overflow-auto max-h-60 text-slate-300",children:JSON.stringify(null==ds?void 0:ds.users,null,2)})]}),l.jsxs("div",{className:"bg-slate-800 p-4 rounded-xl border border-slate-700 overflow-hidden",children:[l.jsxs("h3",{className:"text-purple-400 font-bold mb-2",children:["Organizations (",null==ds?void 0:ds.organizations.length,")"]}),l.jsx("div",{className:"space-y-2",children:null==ds?void 0:ds.organizations.map(e=>l.jsxs("div",{className:"p-2 bg-slate-900 rounded border border-slate-600 flex justify-between",children:[l.jsx("span",{children:e.name}),l.jsx("span",{className:"text-purple-300 select-all font-bold",children:e.id})]},e.id))})]})]})]});if("ORG_DIRECTORY"===Re){const e=xs.filter(e=>e.name.toLowerCase().includes(hs.toLowerCase())||e.id.toLowerCase().includes(hs.toLowerCase())||e.type.toLowerCase().includes(hs.toLowerCase()));return l.jsxs("div",{className:"p-6 pb-28 space-y-6 animate-fade-in bg-slate-50 min-h-screen",children:[l.jsx("div",{className:"flex items-center justify-between border-b border-slate-200 pb-4 sticky top-0 bg-slate-50 z-10",children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("button",{onClick:()=>Ee("MAIN"),className:"p-2 -ml-2 text-slate-500 hover:text-slate-800",children:l.jsx(L,{size:24})}),l.jsxs("div",{children:[l.jsx("h1",{className:"text-xl font-bold text-slate-900",children:"Organization Directory"}),l.jsx("p",{className:"text-xs text-slate-500",children:"Search and View Registered Hubs"})]})]})}),us?l.jsxs("div",{className:"animate-slide-up space-y-6",children:[l.jsxs(A,{variant:"ghost",onClick:()=>bs(null),className:"pl-0 text-slate-500",children:[l.jsx(L,{size:16,className:"mr-1"})," Back to list"]}),l.jsxs("div",{className:`bg-white rounded-2xl border ${us.active?"border-slate-200":"border-red-300"} shadow-lg overflow-hidden`,children:[l.jsx("div",{className:(us.active?"bg-purple-600":"bg-slate-600")+" p-6 text-white",children:l.jsxs("div",{className:"flex items-start justify-between",children:[l.jsxs("div",{children:[l.jsxs("div",{className:"flex gap-2 mb-2",children:[l.jsx("span",{className:"inline-block px-2 py-1 bg-white/20 rounded text-xs font-bold border border-white/30",children:us.type}),!us.active&&l.jsx("span",{className:"inline-block px-2 py-1 bg-red-500 rounded text-xs font-bold",children:"SUSPENDED"})]}),l.jsx("h2",{className:"text-2xl font-bold",children:us.name}),l.jsxs("p",{className:"flex items-center gap-1 text-white/80 text-sm mt-1",children:[l.jsx(_,{size:14})," ",us.verified?"Verified Partner":"Unverified"]})]}),l.jsxs("div",{className:"text-right",children:[l.jsx("p",{className:"text-xs text-white/60 font-bold uppercase tracking-wider",children:"Community ID"}),l.jsx("p",{className:"text-3xl font-mono font-black tracking-widest",children:us.id})]})]})}),l.jsxs("div",{className:"p-6 space-y-6",children:[l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"space-y-3",children:[l.jsx("h3",{className:"font-bold text-slate-900 border-b border-slate-100 pb-2",children:"Location & Contact"}),l.jsxs("div",{className:"flex items-start gap-3",children:[l.jsx(B,{className:"text-slate-400 mt-1",size:18}),l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-bold text-slate-900",children:"Address"}),l.jsx("p",{className:"text-sm text-slate-600",children:us.address})]})]}),l.jsxs("div",{className:"flex items-start gap-3",children:[l.jsx($,{className:"text-slate-400 mt-1",size:18}),l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-bold text-slate-900",children:"Admin"}),l.jsx("p",{className:"text-sm text-slate-600",children:us.adminContact}),l.jsx("p",{className:"text-xs text-slate-500",children:us.adminPhone})]})]})]}),l.jsxs("div",{className:"space-y-3",children:[l.jsx("h3",{className:"font-bold text-slate-900 border-b border-slate-100 pb-2",children:"Logistics Profile"}),l.jsxs("div",{className:"flex items-start gap-3",children:[l.jsx(q,{className:"text-slate-400 mt-1",size:18}),l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-bold text-slate-900",children:"Replenishment Provider"}),l.jsx("p",{className:"text-sm text-slate-600",children:us.replenishmentProvider})]})]}),l.jsxs("div",{className:"flex items-start gap-3",children:[l.jsx(F,{className:"text-slate-400 mt-1",size:18}),l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-bold text-slate-900",children:"Supply Email"}),l.jsx("p",{className:"text-sm text-slate-600 break-all",children:us.replenishmentEmail||"N/A"})]})]}),l.jsxs("div",{className:"flex items-start gap-3",children:[l.jsx(H,{className:"text-slate-400 mt-1",size:18}),l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-bold text-slate-900",children:"Supply Phone"}),l.jsx("p",{className:"text-sm text-slate-600",children:us.replenishmentPhone||"N/A"})]})]})]})]}),l.jsxs("div",{className:"space-y-3",children:[l.jsxs("h3",{className:"font-bold text-slate-900 border-b border-slate-100 pb-2 flex items-center gap-2",children:[l.jsx(T,{size:18,className:"text-slate-400"})," Registered Members (",gs.length,")",fs&&l.jsx("span",{className:"text-[11px] text-amber-600 font-semibold",children:"Using cached list"})]}),0===gs.length?l.jsx("p",{className:"text-slate-500 text-sm italic",children:"No members linked yet."}):l.jsx("div",{className:"max-h-60 overflow-y-auto space-y-2 border border-slate-100 rounded-lg p-2 bg-slate-50",children:gs.map(e=>l.jsxs("div",{className:"bg-white p-3 rounded-lg border border-slate-200 flex justify-between items-center shadow-sm",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center font-bold text-xs text-white "+("SAFE"===e.status?"bg-green-500":"DANGER"===e.status?"bg-red-500":"bg-slate-400"),children:e.name.charAt(0)}),l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-bold text-slate-900",children:e.name}),l.jsx("p",{className:"text-[10px] text-slate-500",children:e.phone})]})]}),l.jsx("div",{className:"text-right",children:l.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded font-bold uppercase "+("SAFE"===e.status?"bg-green-100 text-green-700":"DANGER"===e.status?"bg-red-100 text-red-700":"bg-slate-200 text-slate-600"),children:e.status})})]},e.id))})]})]}),l.jsxs("div",{className:"bg-slate-50 p-4 border-t border-slate-200 flex justify-between items-center",children:[l.jsx(A,{size:"sm",variant:us.active?"danger":"primary",onClick:()=>((e,s)=>{const t=!s;n.updateOrgStatus(e,t),ms(s=>s.map(s=>s.id===e?{...s,active:t}:s)),us&&us.id===e&&bs(e=>e?{...e,active:t}:null)})(us.id,us.active),className:us.active?"bg-red-50 text-red-600 border border-red-200 hover:bg-red-100":"bg-green-600 text-white",children:us.active?l.jsxs(l.Fragment,{children:[l.jsx(s,{size:16,className:"mr-2"})," Deactivate Org"]}):l.jsxs(l.Fragment,{children:[l.jsx(O,{size:16,className:"mr-2"})," Activate Org"]})}),l.jsxs(A,{size:"sm",variant:"outline",onClick:()=>Ct(us.id),children:[l.jsx(V,{size:16,className:"mr-2"})," Copy Code"]})]})]})]}):l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"relative",children:[l.jsx(G,{className:"absolute left-3 top-3.5 text-slate-400",size:20}),l.jsx(I,{className:"pl-10",placeholder:"Search by Name, Type, or ID...",value:hs,onChange:e=>ps(e.target.value)})]}),l.jsx("div",{className:"space-y-3",children:0===e.length?l.jsxs("div",{className:"text-center py-10 text-slate-400",children:[l.jsx(Y,{size:48,className:"mx-auto mb-2 opacity-20"}),l.jsxs("p",{children:['No organizations found matching "',hs,'"']})]}):e.map(e=>l.jsxs("button",{onClick:()=>bs(e),className:"w-full bg-white p-4 rounded-xl border shadow-sm hover:shadow-md transition-all text-left flex justify-between items-center group "+(e.active?"border-slate-200 hover:border-purple-300":"border-red-200 bg-red-50/30"),children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center font-bold text-lg border "+(e.active?"bg-purple-50 text-purple-600 border-purple-100":"bg-slate-200 text-slate-500 border-slate-300"),children:e.name.charAt(0)}),l.jsxs("div",{children:[l.jsxs("h3",{className:"font-bold transition-colors "+(e.active?"text-slate-900 group-hover:text-purple-700":"text-slate-500"),children:[e.name," ",!e.active&&l.jsx("span",{className:"text-[10px] text-red-500 ml-2 font-bold uppercase",children:"(Inactive)"})]}),l.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500",children:[l.jsx("span",{className:"bg-slate-100 px-1.5 py-0.5 rounded border border-slate-200",children:e.type}),l.jsx("span",{className:"font-mono",children:e.id})]})]})]}),l.jsx(W,{size:20,className:"text-slate-300 group-hover:text-purple-500"})]},e.id))})]})]})}if("ACCESS_CONTROL"===Re){const e=Array.isArray(as)?as:[],s=e.filter(e=>{const s=(e.fullName||"").toLowerCase(),t=(e.phone||"").toLowerCase(),a=(e.role||"").toLowerCase(),l=ns.toLowerCase();return s.includes(l)||t.includes(l)||a.includes(l)});return is?l.jsxs("div",{className:"p-6 pb-28 space-y-6 animate-fade-in bg-slate-50 min-h-screen",children:[l.jsxs("div",{className:"flex items-center gap-3 border-b border-slate-200 pb-4 sticky top-0 bg-slate-50 z-10",children:[l.jsx("button",{onClick:()=>os(null),className:"p-2 -ml-2 text-slate-500 hover:text-slate-800",children:l.jsx(L,{size:24})}),l.jsx("h1",{className:"text-xl font-bold text-slate-900",children:"User Profile"})]}),l.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden animate-slide-up",children:[l.jsxs("div",{className:"bg-slate-800 p-6 text-white flex justify-between items-start",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-16 h-16 rounded-full bg-slate-600 flex items-center justify-center text-2xl font-bold border-2 border-slate-500",children:(is.fullName||"?").charAt(0)}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-2xl font-bold",children:is.fullName||"Unnamed User"}),l.jsxs("div",{className:"flex gap-2 mt-1",children:[l.jsx("span",{className:"px-2 py-0.5 bg-white/20 rounded text-xs font-bold uppercase",children:(is.role||"UNKNOWN").replace("_"," ")}),l.jsx("span",{className:"px-2 py-0.5 rounded text-xs font-bold uppercase "+(is.active?"bg-green-500 text-white":"bg-red-500 text-white"),children:is.active?"Active":"Suspended"})]})]})]}),l.jsxs("div",{className:"text-right text-xs opacity-60 font-mono",children:["ID: ",is.id]})]}),l.jsxs("div",{className:"p-6 space-y-6",children:[l.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"space-y-3",children:[l.jsxs("h3",{className:"font-bold text-slate-900 border-b border-slate-100 pb-2 flex items-center gap-2",children:[l.jsx(H,{size:16,className:"text-slate-400"})," Contact Details"]}),l.jsxs("div",{children:[l.jsx("p",{className:"text-xs text-slate-500 font-bold uppercase",children:"Mobile Phone"}),l.jsx("a",{href:`tel:${is.phone}`,className:"text-blue-600 font-bold hover:underline",children:is.phone})]}),l.jsxs("div",{children:[l.jsx("p",{className:"text-xs text-slate-500 font-bold uppercase",children:"Home Address"}),l.jsxs("div",{className:"flex items-start gap-1",children:[l.jsx(B,{size:14,className:"mt-0.5 text-slate-400"}),l.jsx("p",{className:"text-slate-900",children:is.address||"Not Provided"})]})]}),is.communityId&&l.jsxs("div",{children:[l.jsx("p",{className:"text-xs text-slate-500 font-bold uppercase",children:"Community Connection"}),l.jsx("p",{className:"text-purple-700 font-bold bg-purple-50 px-2 py-1 rounded w-fit text-sm mt-1",children:is.communityId})]})]}),l.jsxs("div",{className:"space-y-3",children:[l.jsxs("h3",{className:"font-bold text-slate-900 border-b border-slate-100 pb-2 flex items-center gap-2",children:[l.jsx(Z,{size:16,className:"text-slate-400"})," Emergency Profile"]}),is.medicalNeeds&&l.jsxs("div",{className:"bg-red-50 p-3 rounded-lg border border-red-100",children:[l.jsx("p",{className:"text-xs text-red-600 font-bold uppercase mb-1",children:"Medical Needs"}),l.jsx("p",{className:"text-red-900 font-medium text-sm",children:is.medicalNeeds})]}),l.jsxs("div",{children:[l.jsx("p",{className:"text-xs text-slate-500 font-bold uppercase",children:"Household"}),l.jsxs("p",{className:"text-slate-900 font-bold text-lg",children:[is.householdMembers," Member(s)"]}),Array.isArray(is.household)&&is.household.length>0&&l.jsx("div",{className:"mt-2 space-y-1",children:is.household.map(e=>l.jsxs("div",{className:"text-xs bg-slate-100 p-2 rounded flex justify-between",children:[l.jsx("span",{className:"font-bold",children:e.name}),l.jsxs("span",{className:"text-slate-500",children:[e.age," • ",e.needs||"No needs"]})]},e.id))})]}),l.jsxs("div",{children:[l.jsx("p",{className:"text-xs text-slate-500 font-bold uppercase",children:"Emergency Contact"}),l.jsxs("p",{className:"text-slate-900 text-sm font-medium",children:[is.emergencyContactName," ",l.jsxs("span",{className:"text-slate-500",children:["(",is.emergencyContactRelation,")"]})]}),l.jsx("a",{href:`tel:${is.emergencyContactPhone}`,className:"text-sm font-bold text-slate-700",children:is.emergencyContactPhone})]})]})]}),l.jsxs("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-200 mt-4 space-y-4",children:[l.jsx("h3",{className:"font-bold text-slate-900 text-sm uppercase tracking-wider",children:"Account Management"}),l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("label",{className:"text-sm font-medium text-slate-700",children:"System Role"}),l.jsx("select",{value:is.role,onChange:e=>{return s=is.id,t=e.target.value,void(Ae&&ls(e=>{const a=e.map(e=>e.id===s?{...e,role:t}:e),l=a.find(e=>e.id===s);return l&&n.saveProfile(l),a}));var s,t},className:"text-sm p-2 rounded border bg-white font-medium "+(is.active?"border-slate-300":"opacity-50 cursor-not-allowed"),disabled:!is.active,children:ss.map(e=>l.jsx("option",{value:e.id,children:e.label},e.id))})]}),l.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-slate-200",children:[l.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Account Status"}),l.jsx(A,{size:"sm",onClick:()=>((e,s)=>{if(!Ae)return;const t=!s;n.updateUserStatus(e,t),ls(s=>s.map(s=>s.id===e?{...s,active:t}:s)),os(s=>s&&s.id===e?{...s,active:t}:s)})(is.id,!1!==is.active),className:is.active?"bg-red-100 text-red-700 hover:bg-red-200 border-red-200":"bg-green-600 text-white",children:is.active?"Suspend Account":"Activate Account"})]})]})]})]})]}):l.jsxs("div",{className:"p-6 pb-28 space-y-6 animate-fade-in bg-slate-50 min-h-screen",children:[l.jsxs("div",{className:"flex items-center justify-between border-b border-slate-200 pb-4 sticky top-0 bg-slate-50 z-10",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("button",{onClick:()=>Ee("MAIN"),className:"p-2 -ml-2 text-slate-500 hover:text-slate-800",children:l.jsx(L,{size:24})}),l.jsxs("div",{children:[l.jsx("h1",{className:"text-xl font-bold text-slate-900",children:"User Directory"}),l.jsx("p",{className:"text-xs text-slate-500",children:"Manage All Registered Users & Permissions"})]})]}),l.jsxs(A,{size:"sm",variant:"outline",className:"border-slate-300 text-slate-900 hover:bg-slate-100 h-9",onClick:Pt,children:[l.jsx(M,{size:16,className:"mr-2"})," Export CSV"]})]}),l.jsxs("div",{className:"flex bg-white rounded-lg p-1 border border-slate-200",children:[l.jsxs("button",{onClick:()=>es("ALL_USERS"),className:"flex-1 py-2 text-sm font-bold rounded-md transition-all "+("ALL_USERS"===Ke?"bg-slate-800 text-white shadow":"text-slate-500 hover:text-slate-900"),children:["All Users (",e.length,")"]}),l.jsx("button",{onClick:()=>es("ROLE_DEFINITIONS"),className:"flex-1 py-2 text-sm font-bold rounded-md transition-all "+("ROLE_DEFINITIONS"===Ke?"bg-slate-800 text-white shadow":"text-slate-500 hover:text-slate-900"),children:"Role Definitions"})]}),"ROLE_DEFINITIONS"===Ke&&l.jsx("div",{className:"space-y-4",children:ss.map(e=>l.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 overflow-hidden shadow-sm",children:[l.jsxs("div",{className:"p-4 bg-slate-50 border-b border-slate-100",children:[l.jsx("h3",{className:"font-bold text-slate-900",children:e.label}),l.jsx("p",{className:"text-xs text-slate-500",children:e.description})]}),l.jsx("div",{className:"p-4 space-y-3",children:Object.entries(e.permissions).map(([s,t])=>l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("span",{className:"text-sm font-medium text-slate-700 capitalize",children:s.replace("can","").replace(/([A-Z])/g," $1").trim()}),l.jsx("button",{onClick:()=>{return t=e.id,a=s,void ts(e=>{const s=e.map(e=>e.id===t?{...e,permissions:{...e.permissions,[a]:!e.permissions[a]}}:e);return n.saveRoles(s),s});var t,a},className:"w-10 h-5 rounded-full relative transition-colors "+(t?"bg-green-500":"bg-slate-300"),children:l.jsx("div",{className:"absolute top-0.5 w-4 h-4 bg-white rounded-full transition-transform shadow-sm "+(t?"left-[22px]":"left-0.5")})})]},s))})]},e.id))}),"ALL_USERS"===Ke&&l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"relative",children:[l.jsx(G,{className:"absolute left-3 top-3.5 text-slate-400",size:18}),l.jsx(I,{className:"pl-10 h-10",placeholder:"Search users by name, phone, or role...",value:ns,onChange:e=>rs(e.target.value)})]}),s.map(e=>{const s=e.createdAt?new Date(e.createdAt).toLocaleDateString():"Unknown";return l.jsxs("div",{onClick:()=>os(e),className:"bg-white p-4 rounded-xl border shadow-sm flex flex-col gap-3 cursor-pointer hover:border-brand-400 hover:shadow-md transition-all group "+(e.active?"border-slate-200":"border-red-200 bg-red-50/10"),children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"p-2 rounded-full "+(e.active?"bg-slate-100 text-slate-600":"bg-red-100 text-red-500"),children:l.jsx($,{size:18})}),l.jsxs("div",{children:[l.jsx("h3",{className:"font-bold group-hover:text-brand-700 transition-colors "+(e.active?"text-slate-900":"text-slate-500 line-through"),children:e.fullName||"Unnamed User"}),l.jsxs("p",{className:"text-xs text-slate-500",children:[e.phone||"No phone"," ","ADMIN"===e.role&&l.jsx("span",{className:"text-brand-600 font-bold ml-1",children:"(Admin)"})]}),l.jsxs("p",{className:"text-[11px] text-slate-400",children:["Created: ",s]})]})]}),l.jsx(W,{size:18,className:"text-slate-300 group-hover:text-brand-500"})]}),l.jsxs("div",{className:"pt-3 border-t border-slate-100 flex justify-between items-center",children:[l.jsxs("span",{className:"text-[10px] font-bold uppercase "+(e.active?"text-green-600":"text-red-600"),children:["Status: ",e.active?"Active":"Deactivated"]}),l.jsx("span",{className:"text-xs px-2 py-1 bg-slate-100 rounded text-slate-600 font-medium",children:(e.role||"UNKNOWN").replace("_"," ")})]})]},e.id)}),0===s.length&&l.jsx("p",{className:"text-center text-slate-400 py-4",children:"No users found."})]})]})}return l.jsxs("div",{className:"p-6 pb-28 space-y-8 animate-fade-in bg-slate-50 min-h-screen flex flex-col",children:[l.jsxs("div",{className:"flex justify-between items-center",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("button",{onClick:()=>e("DASHBOARD"),className:"p-2 -ml-2 text-slate-500 hover:text-slate-800 md:hidden",children:l.jsx(L,{size:24})}),l.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:E("settings.title")})]}),Pe&&l.jsxs("span",{className:"text-sm font-medium text-green-600 flex items-center gap-1 animate-fade-in",children:[l.jsx(z,{size:16})," Saved"]})]}),l.jsxs("section",{className:"bg-white p-4 rounded-2xl shadow-sm border border-slate-200",children:[l.jsx("p",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider mb-3",children:"Quick Jump"}),l.jsxs("div",{className:"flex flex-wrap gap-2",children:[l.jsx("button",{type:"button",onClick:()=>ht("profile"),className:"min-w-[92px] flex-1 text-[11px] sm:text-xs font-semibold text-slate-700 bg-slate-100 hover:bg-slate-200 rounded-lg px-3 py-2",children:"Profile"}),l.jsx("button",{type:"button",onClick:()=>ht("household"),className:"min-w-[92px] flex-1 text-[11px] sm:text-xs font-semibold text-slate-700 bg-slate-100 hover:bg-slate-200 rounded-lg px-3 py-2",children:"Household"}),l.jsx("button",{type:"button",onClick:()=>ht("contacts"),className:"min-w-[92px] flex-1 text-[11px] sm:text-xs font-semibold text-slate-700 bg-slate-100 hover:bg-slate-200 rounded-lg px-3 py-2",children:"Emergancy Contact"}),l.jsx("button",{type:"button",onClick:()=>ht("community"),className:"min-w-[92px] flex-1 text-[11px] sm:text-xs font-semibold text-slate-700 bg-slate-100 hover:bg-slate-200 rounded-lg px-3 py-2",children:"Community"}),l.jsx("button",{type:"button",onClick:()=>ht("security"),className:"min-w-[92px] flex-1 text-[11px] sm:text-xs font-semibold text-slate-700 bg-slate-100 hover:bg-slate-200 rounded-lg px-3 py-2",children:"Preparedness"})]})]}),l.jsxs("section",{className:"bg-white p-6 rounded-2xl shadow-sm space-y-4 order-10",children:[l.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[l.jsx("div",{className:"p-3 bg-indigo-50 rounded-full text-indigo-600",children:l.jsx(X,{size:24})}),l.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:E("settings.language")})]}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx("button",{onClick:()=>Mt("en"),className:"flex-1 py-3 px-4 rounded-xl border-2 font-bold transition-all "+("en"===ke.language?"border-indigo-600 bg-indigo-50 text-indigo-800":"border-slate-200 bg-white text-slate-600 hover:border-slate-300"),children:"English"}),l.jsx("button",{onClick:()=>Mt("es"),className:"flex-1 py-3 px-4 rounded-xl border-2 font-bold transition-all "+("es"===ke.language?"border-indigo-600 bg-indigo-50 text-indigo-800":"border-slate-200 bg-white text-slate-600 hover:border-slate-300"),children:"Español"}),l.jsx("button",{onClick:()=>Mt("fr"),className:"flex-1 py-3 px-4 rounded-xl border-2 font-bold transition-all "+("fr"===ke.language?"border-indigo-600 bg-indigo-50 text-indigo-800":"border-slate-200 bg-white text-slate-600 hover:border-slate-300"),children:"Français"})]})]}),Ae&&l.jsxs("section",{className:"bg-slate-900 text-white p-6 rounded-2xl shadow-lg relative overflow-hidden",children:[l.jsx("div",{className:"absolute top-0 right-0 p-6 opacity-10",children:l.jsx(_,{size:80})}),l.jsxs("div",{className:"relative z-10",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-2 text-brand-400 font-bold text-xs uppercase tracking-wider",children:[l.jsx(K,{size:12})," Administrator Area"]}),l.jsx("h2",{className:"text-xl font-bold mb-4",children:"Roles & Dashboards"}),l.jsxs("div",{className:"space-y-3",children:[l.jsxs(A,{onClick:()=>{if(console.info("[AccessControl] openAccessControl clicked",{isAdmin:Ae}),!Ae)return void console.warn("[AccessControl] blocked: not admin");const e=n.getDB();console.info("[AccessControl] loading users",{count:Array.isArray(e.users)?e.users.length:0}),ls(Array.isArray(e.users)?e.users:[]),es("ALL_USERS"),Ee("ACCESS_CONTROL"),os(null)},className:"bg-brand-600 hover:bg-brand-500 text-white border-0 w-full justify-between",children:[l.jsx("span",{children:"User Directory & Access Control"}),l.jsx(T,{size:18})]}),l.jsxs(A,{onClick:()=>{if(!Ae)return;const e=n.getDB();ms(e.organizations),Ee("ORG_DIRECTORY"),bs(null)},className:"bg-purple-600 hover:bg-purple-500 text-white border-0 w-full justify-between",children:[l.jsx("span",{children:"Organization Directory"}),l.jsx(Y,{size:18})]}),l.jsxs(A,{onClick:()=>{if(!Ae)return;const e=n.getAllReplenishmentRequests();ys(e),Ee("MASTER_INVENTORY")},className:"bg-orange-600 hover:bg-orange-500 text-white border-0 w-full justify-between",children:[l.jsx("span",{children:"Master Inventory Database"}),l.jsx(ee,{size:18})]}),l.jsxs(A,{onClick:()=>{if(!Ae)return;const e=n.getDB();ms(e.organizations),ut(e.tickerMessage),Ee("BROADCAST_CONTROL")},className:"bg-red-600 hover:bg-red-500 text-white border-0 w-full justify-between",children:[l.jsx("span",{children:"Manage Broadcasts"}),l.jsx(J,{size:18})]}),l.jsxs(A,{onClick:()=>{if(!Ae)return;const e=n.getDB();cs(e),Ee("DB_VIEWER")},variant:"outline",className:"border-slate-700 text-slate-300 hover:text-white hover:bg-slate-800 w-full justify-between",children:[l.jsx("span",{children:"View Raw Database"}),l.jsx(le,{size:18})]})]})]})]}),l.jsxs("section",{ref:ge,className:"bg-white p-6 rounded-2xl shadow-sm space-y-4",children:[l.jsxs("button",{type:"button",onClick:()=>xt("profile"),className:"w-full flex items-center justify-between gap-4",children:[l.jsxs("div",{className:"flex items-center gap-4 text-left",children:[l.jsx("div",{className:"p-3 bg-brand-50 rounded-full text-brand-600",children:l.jsx($,{size:24})}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:"Profile"}),l.jsxs("p",{className:"text-xs text-slate-500",children:[ke.fullName||"Name not set"," • ",ke.phone||"Phone not set"]})]})]}),l.jsx(se,{size:18,className:"text-slate-500 transition-transform "+(ve.profile?"rotate-180":"")})]}),!ve.profile&&l.jsx("p",{className:"text-xs text-slate-500",children:ke.address?`Address set • ${ke.address}`:"Address not set yet"}),ve.profile&&l.jsxs(l.Fragment,{children:[we.profile&&l.jsxs("div",{className:"text-xs text-slate-400 font-mono -mt-2 mb-1",children:["ID: ",ke.id]}),l.jsx(I,{label:"Full Name",value:ke.fullName,onChange:e=>yt("fullName",e.target.value),placeholder:"e.g. Jane Doe"}),l.jsx(I,{label:"Mobile Phone",value:ke.phone,onChange:e=>yt("phone",he(e.target.value)),onBlur:()=>ve.profile&&gt(ke.phone),placeholder:"e.g. (555) 123-4567",className:qe?"border-red-500 bg-red-50":"",error:qe||void 0}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1.5",children:"Home Address"}),l.jsxs("div",{className:"relative",children:[l.jsx("input",{placeholder:"123 Main St...",value:ke.address,onChange:e=>{Xe(-1),yt("address",e.target.value)},onBlur:()=>{We([]),Xe(-1),ft(ke.address)},onKeyDown:e=>{if("Escape"===e.key)return We([]),void Xe(-1);if(0!==Ye.length){if("ArrowDown"===e.key)return e.preventDefault(),void Xe(e=>(e+1)%Ye.length);if("ArrowUp"===e.key)return e.preventDefault(),void Xe(e=>e<=0?Ye.length-1:e-1);"Enter"===e.key&&(e.preventDefault(),(Ye[Qe]||Ye[0])&&jt())}else"Enter"===e.key&&(e.preventDefault(),ft(ke.address))},className:"w-full px-4 py-3 rounded-lg border focus:ring-2 outline-none transition-all font-medium "+("VALID"===He?"border-green-500 bg-green-50 focus:ring-green-500":"INVALID"===He?"border-red-500 bg-red-50 focus:ring-red-500":"border-slate-300 focus:ring-brand-500 focus:border-brand-500")}),Ye.length>0&&"VERIFYING"!==He&&l.jsx("div",{className:"absolute z-20 mt-1 w-full rounded-lg border border-slate-200 bg-white shadow-lg max-h-56 overflow-auto",children:Ye.map((e,s)=>l.jsx("button",{type:"button",onMouseDown:e=>e.preventDefault(),onClick:()=>jt(),className:"w-full text-left px-3 py-2 text-sm border-b border-slate-100 last:border-b-0 "+(s===Qe?"bg-slate-100 text-slate-900":"text-slate-700 hover:bg-slate-50"),children:e.description||"Suggested address"},`${e.placeId||"addr"}-${s}`))})]}),Je&&"VERIFYING"!==He&&l.jsx("p",{className:"text-xs text-slate-500 font-semibold mt-1",children:"Finding address suggestions..."}),"VERIFYING"===He&&l.jsx("p",{className:"text-xs text-slate-500 font-semibold mt-1",children:"Verifying with Google Maps..."}),"VALID"===He&&l.jsx("p",{className:"text-xs text-green-600 font-bold mt-1",children:"Verified with Google Maps"}),"INVALID"===He&&l.jsx("p",{className:"text-xs text-red-600 font-bold mt-1",children:"Address not found on Maps"}),"VALID"===He&&ze&&l.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Verified on ",ze]}),De&&l.jsxs("div",{className:"mt-2 flex items-center justify-between gap-3 rounded-lg border border-amber-200 bg-amber-50 px-3 py-2",children:[l.jsxs("p",{className:"text-xs font-semibold text-amber-800 flex items-center gap-1",children:[l.jsx(K,{size:13})," Address verification required before saving."]}),l.jsx("button",{type:"button",onClick:()=>ft(ke.address),className:"text-xs font-bold text-amber-800 hover:text-amber-900 underline",children:"Retry"})]})]}),l.jsx("button",{type:"button",onClick:()=>mt("profile"),className:"text-xs font-semibold text-brand-600 hover:underline",children:we.profile?"Show less":"Show more"}),Rs&&l.jsx("p",{className:"text-xs text-red-600 font-semibold mt-2",children:Rs})]})]}),l.jsxs("section",{ref:je,className:"bg-white p-6 rounded-2xl shadow-sm space-y-4",children:[l.jsxs("button",{type:"button",onClick:()=>xt("contacts"),className:"w-full flex items-center justify-between gap-4",children:[l.jsxs("div",{className:"flex items-center gap-4 text-left",children:[l.jsx("div",{className:"p-3 bg-cyan-50 rounded-full text-cyan-700",children:l.jsx(H,{size:24})}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:"Emergancy Contact"}),l.jsx("p",{className:"text-xs text-slate-500",children:ke.emergencyContactName?`${ke.emergencyContactName} • ${ke.emergencyContactPhone||"No phone"}`:"Emergency contact not set"})]})]}),l.jsx(se,{size:18,className:"text-slate-500 transition-transform "+(ve.contacts?"rotate-180":"")})]}),ve.contacts&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"space-y-3",children:[l.jsx(I,{placeholder:"Contact Name",value:ke.emergencyContactName,onChange:e=>yt("emergencyContactName",e.target.value)}),l.jsx(I,{placeholder:"Mobile Phone",type:"tel",value:ke.emergencyContactPhone,onChange:e=>yt("emergencyContactPhone",he(e.target.value))}),we.contacts&&l.jsx(I,{placeholder:"Relationship",value:ke.emergencyContactRelation,onChange:e=>yt("emergencyContactRelation",e.target.value)})]}),l.jsx("button",{type:"button",onClick:()=>mt("contacts"),className:"text-xs font-semibold text-brand-600 hover:underline",children:we.contacts?"Show less":"Show more"})]})]}),l.jsxs("section",{ref:fe,className:"bg-white p-6 rounded-2xl shadow-sm space-y-4 border border-emerald-100 order-30",children:[l.jsxs("button",{type:"button",onClick:()=>xt("household"),className:"w-full flex items-center justify-between gap-4",children:[l.jsxs("div",{className:"flex items-center gap-4 text-left",children:[l.jsx("div",{className:"p-3 bg-emerald-50 rounded-full text-emerald-700",children:l.jsx(T,{size:24})}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:"Household"}),l.jsxs("p",{className:"text-xs text-slate-500",children:[ke.householdName||"Your Home"," • ",ke.householdCode||"Code not set"]})]})]}),l.jsx(se,{size:18,className:"text-slate-500 transition-transform "+(ve.household?"rotate-180":"")})]}),!ve.household&&l.jsxs("p",{className:"text-xs text-slate-500",children:[(ke.household||[]).length," members • Role: ",ke.householdRole||"OWNER"]}),ve.household&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"bg-emerald-50 border border-emerald-200 rounded-xl p-4 flex items-center justify-between gap-3",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-[10px] font-bold text-emerald-700 uppercase tracking-wider",children:"Household Code"}),l.jsx("p",{className:"text-2xl font-mono font-black tracking-widest text-emerald-900",children:ke.householdCode||"------"}),l.jsxs("p",{className:"text-xs text-emerald-700 mt-1",children:[ke.householdName||"Your Home"," • ",ke.householdRole||"OWNER"]})]}),l.jsxs(A,{size:"sm",variant:"ghost",onClick:()=>Ct(ke.householdCode||""),disabled:!ke.householdCode,className:"text-emerald-800 hover:bg-emerald-100",children:[l.jsx(V,{size:16,className:"mr-2"})," Copy"]})]}),st.length>1&&l.jsxs("div",{className:"space-y-1",children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Active Household"}),l.jsx("select",{value:ke.householdId||"",onChange:e=>(async e=>{if(e&&e!==ke.householdId){Ts(null),_s(null),lt(!0);try{await b(e);const s=st.find(s=>s.householdId===e);s&&bt({householdId:s.householdId,householdCode:s.householdCode,householdName:s.householdName,householdRole:s.householdRole}),_s("Active household updated.")}catch(s){Ts((null==s?void 0:s.message)||"Unable to switch households right now.")}finally{lt(!1)}}})(e.target.value),disabled:at,className:"w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500",children:st.map(e=>l.jsxs("option",{value:e.householdId,children:[e.householdName," (",e.householdCode,") • ",e.householdRole]},e.householdId))}),l.jsx("p",{className:"text-xs text-slate-500",children:"Switch to another linked household context."})]}),l.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-[1fr_auto] gap-3 items-end",children:[l.jsx(I,{label:"Request Home Join by Code",placeholder:"e.g. A3K7Q2",value:Ms,onChange:e=>Os(e.target.value.toUpperCase()),maxLength:6}),l.jsx(A,{onClick:async()=>{Ts(null),_s(null);const e=Ms.trim().toUpperCase();if(e.length<6||e.includes("-"))Ts("Enter a valid 6-character household code.");else{$s(!0);try{const s=await g(e);_s(s.message||"Your request has been sent to the household administrator."),Os("");try{const[e,s,t]=await Promise.all([h(),p(),u(50)]);Xs(e),et(s),rt(t)}catch{}}catch(s){Ts((null==s?void 0:s.message)||"Unable to submit join request.")}finally{$s(!1)}}},disabled:Bs||Ms.trim().length<6||Ms.includes("-"),children:Bs?"Sending...":"Click Here to Connect"})]}),l.jsx("p",{className:"text-xs text-slate-500",children:"Your request has been sent to the household administrator and requires approval."}),zt&&l.jsxs("div",{className:"rounded-lg border border-slate-200 bg-slate-50 p-3",children:[l.jsx("p",{className:"text-[11px] uppercase tracking-wide font-bold text-slate-500",children:"Latest Join Request"}),l.jsxs("p",{className:"text-sm font-semibold text-slate-900 mt-1",children:["Status: ","pending"===zt.status?"Pending Approval":"approved"===zt.status?"Approved":"Rejected"]}),l.jsxs("p",{className:"text-[11px] text-slate-500 mt-0.5",children:["Submitted ",new Date(zt.createdAt).toLocaleString()]})]}),Us&&l.jsx("p",{className:"text-xs text-red-600 font-semibold",children:Us}),Vs&&l.jsx("p",{className:"text-xs text-emerald-700 font-semibold",children:Vs}),we.household&&"OWNER"===ke.householdRole&&l.jsxs("div",{className:"rounded-xl border border-amber-200 bg-amber-50 p-4 space-y-3",children:[l.jsxs("p",{className:"text-xs font-bold text-amber-700 uppercase tracking-wider",children:["New Household Join Request",1===Dt.length?"":"s"]}),0===Dt.length?l.jsx("p",{className:"text-xs text-amber-700",children:"No pending requests."}):l.jsx("div",{className:"space-y-2",children:Dt.map(e=>l.jsxs("div",{className:"rounded-lg border border-amber-200 bg-white p-3 flex items-center justify-between gap-3",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-semibold text-slate-900",children:e.requestingUserName||"AERA user"}),l.jsx("p",{className:"text-[11px] text-slate-500",children:e.requestingUserPhone||e.requestingUserEmail||"No contact preview available"}),l.jsxs("p",{className:"text-[11px] text-slate-500 mt-0.5",children:["Requested ",new Date(e.createdAt).toLocaleString()]})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(A,{size:"sm",className:"bg-emerald-600 hover:bg-emerald-700",onClick:()=>Et(e,"approved"),disabled:it===e.id,children:it===e.id?"Working...":"Approve"}),l.jsx(A,{size:"sm",variant:"ghost",className:"text-red-600 hover:bg-red-50",onClick:()=>Et(e,"rejected"),disabled:it===e.id,children:"Reject"})]})]},e.id))})]}),we.household&&l.jsxs("div",{className:"rounded-xl border border-indigo-200 bg-indigo-50 p-4 space-y-2",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("p",{className:"text-xs font-bold text-indigo-700 uppercase tracking-wider",children:"Notifications"}),l.jsxs(A,{size:"sm",variant:"ghost",className:"text-indigo-700 hover:bg-indigo-100",onClick:async()=>{ct(!0);try{const e=nt.filter(e=>!e.read);await Promise.all(e.map(e=>f(e.id)));const s=await u(50);rt(s)}catch{}finally{ct(!1)}},disabled:dt||0===Rt,children:["Mark Read (",Rt,")"]})]}),0===nt.length?l.jsx("p",{className:"text-xs text-indigo-700",children:"No notifications yet."}):l.jsx("div",{className:"space-y-1",children:nt.slice(0,5).map(e=>l.jsxs("div",{className:"rounded-md border px-3 py-2 text-xs "+(e.read?"border-indigo-100 bg-white text-slate-500":"border-indigo-300 bg-white text-slate-800 font-semibold"),children:[l.jsx("p",{children:"household_join_request"===e.type?"New Household Join Request":"household_join_approved"===e.type?"Your request was approved.":"household_join_rejected"===e.type?"Your request was not approved.":e.type}),l.jsx("p",{className:"text-[10px] mt-0.5 opacity-80",children:new Date(e.createdAt).toLocaleString()})]},e.id))})]}),l.jsx("div",{children:l.jsx(I,{label:"Household Size",type:"number",min:1,value:String(ke.householdMembers||1),onChange:e=>yt("householdMembers",Math.max(1,Number(e.target.value)||1))})}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Who lives in your home"}),l.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"Each member requires DOB in MM/DD/YYYY. Young children and seniors are flagged automatically."}),l.jsx(D,{members:ke.household,onChange:e=>yt("household",e)})]}),we.household&&l.jsxs("div",{className:"rounded-xl border border-emerald-200 bg-emerald-50 p-4 space-y-3",children:[l.jsx("div",{children:l.jsx("p",{className:"text-xs font-bold text-emerald-700 uppercase tracking-wider",children:"Member Account Invites"})}),0===It.length?l.jsx(l.Fragment,{}):l.jsx("div",{className:"space-y-2",children:It.map(e=>{var s,t,a;return l.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-emerald-200 bg-white p-3 gap-3",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-semibold text-slate-900",children:e.name}),l.jsxs("p",{className:"text-xs text-slate-600",children:["Invite Code: ",l.jsx("span",{className:"font-mono font-bold tracking-wider",children:(null===(s=At[e.id])||void 0===s?void 0:s.invitationCode)||St(e)})]}),l.jsxs("p",{className:"text-[11px] text-slate-500 mt-0.5",children:["Bound phone: ",ue((null===(t=At[e.id])||void 0===t?void 0:t.inviteePhone)||e.loginPhone||"")||"Not set"]}),!r(e.loginPhone||"")&&l.jsx("p",{className:"text-[11px] text-amber-700 mt-0.5",children:"Add a valid member phone in Household Members before creating an invite."}),At[e.id]&&l.jsxs("p",{className:"text-[11px] text-slate-500 mt-0.5",children:["Status: ",At[e.id].status,At[e.id].expiresAt?` • Expires ${new Date(At[e.id].expiresAt).toLocaleDateString()}`:""]})]}),l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsxs(A,{size:"sm",variant:"ghost",className:"text-emerald-800 hover:bg-emerald-100",onClick:()=>(async e=>{Gs(null),Ws(null),Zs(e.id);try{if(!r(e.loginPhone||""))throw new Error(`${e.name} needs a valid phone number before creating an account invite.`);const s=await N({memberId:e.id,memberName:e.name,inviteePhone:e.loginPhone||"",suggestedCode:St(e)}),t=`AERA invite for ${e.name}: create or log in to your account, then use invite code ${s.invitationCode} to join this household.`,a=await kt(e.name,t);"cancelled"===a.method?Gs("Share cancelled."):"native"===a.method?Gs(`Invite shared for ${e.name}. Current status: ${s.status}.`):a.copied?Gs(`Invite prepared for ${e.name}. Opened email and copied message.`):Gs(`Invite prepared for ${e.name}. Opened email draft.`);const l=await m();Fs(l)}catch(s){Ws((null==s?void 0:s.message)||"Unable to create invite right now.")}finally{Zs(null)}})(e),disabled:Js===e.id||!r(e.loginPhone||""),children:[l.jsx(V,{size:14,className:"mr-1"})," ",Js===e.id?"Working...":"Share"]}),l.jsx(A,{size:"sm",variant:"ghost",className:"text-slate-700 hover:bg-slate-100",onClick:()=>(async e=>{Gs(null),Ws(null),Zs(e.id);try{if(!r(e.loginPhone||""))throw new Error(`${e.name} needs a valid phone number before creating an account invite.`);const s=await N({memberId:e.id,memberName:e.name,inviteePhone:e.loginPhone||"",suggestedCode:St(e),forceNew:!0}),t=`AERA invite for ${e.name}: create or log in to your account, then use invite code ${s.invitationCode} to join this household.`,a=await kt(e.name,t);"cancelled"===a.method?Gs("Share cancelled."):a.copied?Gs(`New invite generated for ${e.name}. Opened email and copied message.`):Gs(`New invite generated for ${e.name}.`);const l=await m();Fs(l)}catch(s){Ws((null==s?void 0:s.message)||"Unable to resend invite right now.")}finally{Zs(null)}})(e),disabled:Js===e.id||!r(e.loginPhone||""),children:Js===e.id?"Working...":"Resend"}),"PENDING"===(null===(a=At[e.id])||void 0===a?void 0:a.status)&&l.jsx(A,{size:"sm",variant:"ghost",className:"text-red-600 hover:bg-red-50",onClick:()=>(async e=>{const s=At[e.id];if(null!=s&&s.id&&"PENDING"===s.status){Gs(null),Ws(null),Zs(e.id);try{await v(s.id),Gs(`Invite revoked for ${e.name}.`);const t=await m();Fs(t)}catch(t){Ws((null==t?void 0:t.message)||"Unable to revoke invite right now.")}finally{Zs(null)}}})(e),disabled:Js===e.id,children:"Revoke"})]})]},e.id)})}),Hs&&l.jsx("p",{className:"text-xs text-emerald-700 font-semibold",children:Hs}),Ys&&l.jsx("p",{className:"text-xs text-red-600 font-semibold",children:Ys})]}),l.jsx("button",{type:"button",onClick:()=>mt("household"),className:"text-xs font-semibold text-brand-600 hover:underline",children:we.household?"Show less":"Show more"}),Ps&&l.jsx("p",{className:"text-xs text-red-600 font-semibold mt-2",children:Ps})]})]}),l.jsxs("section",{ref:Ne,className:"bg-white p-6 rounded-2xl shadow-sm space-y-4 border border-red-100 order-20",children:[l.jsxs("button",{type:"button",onClick:()=>xt("security"),className:"w-full flex items-center justify-between gap-4",children:[l.jsxs("div",{className:"flex items-center gap-4 text-left",children:[l.jsx("div",{className:"p-3 bg-red-50 rounded-full text-red-600",children:l.jsx(Z,{size:24})}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:"Preparedness"}),l.jsx("p",{className:"text-xs text-slate-500",children:"Health and mobility planning details."})]})]}),l.jsx(se,{size:18,className:"text-slate-500 transition-transform "+(ve.security?"rotate-180":"")})]}),!ve.security&&l.jsxs("p",{className:"text-xs text-slate-500",children:["Consent: ",ke.consentPreparednessPlanning?"Provided":"Pending"," • ZIP: ",ke.zipCode||"Not detected"]}),ve.security&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"rounded-lg border border-slate-200 bg-slate-50 px-4 py-3",children:[l.jsx("p",{className:"text-xs font-bold text-slate-600 uppercase tracking-wide",children:"ZIP Code"}),l.jsx("p",{className:"text-sm font-semibold text-slate-900 mt-1",children:ke.zipCode||"Not detected yet"}),l.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"From your Home Address"})]}),l.jsxs("div",{className:"space-y-3",children:[l.jsx("p",{className:"text-xs font-bold text-slate-600 uppercase tracking-wide",children:"Medical"}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[l.jsxs("label",{className:"flex items-center justify-between rounded-lg border border-slate-200 p-3",children:[l.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Medication Dependency"}),l.jsx("input",{type:"checkbox",checked:Boolean(ke.medicationDependency),onChange:e=>yt("medicationDependency",e.target.checked)})]}),l.jsxs("label",{className:"flex items-center justify-between rounded-lg border border-slate-200 p-3",children:[l.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Insulin Dependency"}),l.jsx("input",{type:"checkbox",checked:Boolean(ke.insulinDependency),onChange:e=>yt("insulinDependency",e.target.checked)})]}),l.jsxs("label",{className:"flex items-center justify-between rounded-lg border border-slate-200 p-3 md:col-span-2",children:[l.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Oxygen / Powered Medical Device"}),l.jsx("input",{type:"checkbox",checked:Boolean(ke.oxygenPoweredDevice),onChange:e=>yt("oxygenPoweredDevice",e.target.checked)})]})]})]}),l.jsxs("div",{className:"space-y-3",children:[l.jsx("p",{className:"text-xs font-bold text-slate-600 uppercase tracking-wide",children:"Accessibility"}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[l.jsxs("label",{className:"flex items-center justify-between rounded-lg border border-slate-200 p-3",children:[l.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Mobility Limitation"}),l.jsx("input",{type:"checkbox",checked:Boolean(ke.mobilityLimitation),onChange:e=>yt("mobilityLimitation",e.target.checked)})]}),l.jsxs("label",{className:"flex items-center justify-between rounded-lg border border-slate-200 p-3",children:[l.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Transportation Access"}),l.jsx("input",{type:"checkbox",checked:Boolean(ke.transportationAccess),onChange:e=>yt("transportationAccess",e.target.checked)})]}),l.jsxs("label",{className:"flex items-center justify-between rounded-lg border border-slate-200 p-3 md:col-span-2",children:[l.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Financial Strain"}),l.jsx("input",{type:"checkbox",checked:Boolean(ke.financialStrain),onChange:e=>yt("financialStrain",e.target.checked)})]})]})]}),l.jsx(I,{label:"Pets",placeholder:"e.g. 2 Dogs",value:ke.petDetails,onChange:e=>yt("petDetails",e.target.value)}),we.security&&l.jsx(S,{label:"Anything else not listed above",value:ke.medicalNeeds,onChange:e=>yt("medicalNeeds",e.target.value)}),l.jsxs("div",{className:"border-t border-slate-200 pt-4",children:[l.jsx("p",{className:"text-[11px] font-bold text-slate-600 uppercase tracking-wide",children:"Final Step"}),l.jsx("p",{className:"text-sm font-bold text-slate-800 mt-1",children:"Confirm preparedness consent"})]}),l.jsxs("label",{className:"flex items-start gap-3 rounded-lg border border-emerald-200 bg-emerald-50 p-3",children:[l.jsx("input",{className:"mt-1",type:"checkbox",checked:Boolean(ke.consentPreparednessPlanning),onChange:e=>yt("consentPreparednessPlanning",e.target.checked)}),l.jsx("span",{className:"text-sm text-emerald-900 font-semibold",children:"I understand this data is used only for preparedness planning and can be deleted anytime."})]}),l.jsx("button",{type:"button",onClick:()=>mt("security"),className:"text-xs font-semibold text-brand-600 hover:underline",children:we.security?"Show less":"Show more"}),Ps&&l.jsx("p",{className:"text-xs text-red-600 font-semibold mt-2",children:Ps})]})]}),l.jsxs("section",{ref:ne,className:"bg-white p-6 rounded-2xl shadow-sm space-y-4 border border-purple-100 relative overflow-hidden order-40",children:[l.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-10",children:l.jsx(Y,{size:64,className:"text-purple-600"})}),l.jsxs("button",{type:"button",onClick:()=>xt("community"),className:"w-full flex items-center justify-between gap-4 relative z-10",children:[l.jsxs("div",{className:"flex items-center gap-4 mb-2 text-left",children:[l.jsx("div",{className:"p-3 bg-purple-50 rounded-full text-purple-600",children:l.jsx(Y,{size:24})}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:E("settings.trusted_conn")}),l.jsx("p",{className:"text-xs text-slate-500",children:Ue?`Connected to ${Ue}`:"No community connected"})]})]}),l.jsx(se,{size:18,className:"text-slate-500 transition-transform "+(ve.community?"rotate-180":"")})]}),ve.community&&l.jsxs(l.Fragment,{children:["INSTITUTION_ADMIN"===ke.role?l.jsxs("div",{className:"relative z-10 space-y-3",children:[l.jsxs("div",{className:"bg-purple-100 border border-purple-200 p-4 rounded-xl flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-[10px] font-bold text-purple-600 uppercase tracking-wider",children:"Your Organization ID"}),l.jsx("p",{className:"text-2xl font-mono font-black text-purple-900 tracking-widest",children:ke.communityId||"NOT SET"})]}),l.jsx(A,{size:"sm",variant:"ghost",onClick:()=>Ct(ke.communityId),className:"text-purple-700 hover:bg-purple-200",children:l.jsx(V,{size:20})})]}),l.jsxs("div",{className:"flex gap-3 items-end",children:[l.jsxs("div",{className:"flex-1",children:[l.jsx(I,{label:"Change Organization ID",value:ke.communityId,onChange:e=>{yt("communityId",pe(e.target.value)),Te(null),_e(null)},className:Ue?"border-green-500 focus:ring-green-500 bg-green-50/30":Ve?"border-red-500 focus:ring-red-500":""}),l.jsx("p",{className:"text-[11px] text-slate-500 mt-1",children:"Format: CH-1234"})]}),l.jsxs("div",{className:"flex flex-col items-center",children:[l.jsx(A,{className:"mb-[1px] min-w-[50px] "+(Ue?"bg-green-600 hover:bg-green-700":"bg-purple-600 hover:bg-purple-700"),onClick:wt,disabled:Me||!ke.communityId,children:Me?l.jsx(te,{className:"animate-spin",size:20}):Ue?l.jsx(z,{size:20}):l.jsx(re,{size:20})}),l.jsx("p",{className:"text-[10px] font-semibold text-purple-600 mt-1",children:"Click here"})]})]}),Ve&&l.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm font-bold bg-red-50 p-2 rounded-lg animate-fade-in border border-red-100 relative z-10",children:[l.jsx(ae,{size:16})," ",Ve]})]}):l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"flex gap-3 items-end relative z-10",children:[l.jsxs("div",{className:"flex-1",children:[l.jsx(I,{label:"Community ID",value:ke.communityId,onChange:e=>{yt("communityId",pe(e.target.value)),Te(null),_e(null)},className:Ue?"border-green-500 focus:ring-green-500 bg-green-50/30":Ve?"border-red-500 focus:ring-red-500":""}),l.jsx("p",{className:"text-[11px] text-slate-500 mt-1",children:"Format: CH-1234"})]}),l.jsxs("div",{className:"flex flex-col items-center",children:[l.jsx(A,{className:"mb-[1px] min-w-[50px] "+(Ue?"bg-green-600 hover:bg-green-700":"bg-purple-600 hover:bg-purple-700"),onClick:wt,disabled:Me||!ke.communityId,children:Me?l.jsx(te,{className:"animate-spin",size:20}):Ue?l.jsx(z,{size:20}):l.jsx(re,{size:20})}),l.jsx("p",{className:"text-[10px] font-semibold text-purple-600 mt-1",children:"Click here"})]})]}),Ue&&l.jsxs("p",{className:"text-xs font-semibold text-emerald-700 relative z-10",children:["Connected to ",Ue,"."]}),Ve&&l.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm font-bold bg-red-50 p-2 rounded-lg animate-fade-in border border-red-100 relative z-10",children:[l.jsx(ae,{size:16})," ",Ve]}),we.community&&l.jsxs("div",{className:"relative z-10 mt-4 border-t border-slate-200 pt-3",children:[l.jsx("p",{className:"text-[11px] text-slate-500 mb-2",children:"Advanced"}),l.jsx(A,{variant:"ghost",size:"sm",className:"text-red-600 hover:bg-red-50",onClick:async()=>{if(ke.communityId){$e(!0),_e(null);try{await w({fullName:ke.fullName,phone:ke.phone,email:ke.email,address:ke.address,emergencyContactName:ke.emergencyContactName,emergencyContactPhone:ke.emergencyContactPhone,emergencyContactRelation:ke.emergencyContactRelation,communityId:"",role:ke.role});const e={...ke,communityId:""};Se(e),n.saveProfile(e),Te(null),_e(null)}catch(e){_e((null==e?void 0:e.message)||"Unable to disconnect organization right now.")}finally{$e(!1)}}},disabled:Be||!ke.communityId,children:Be?"Disconnecting...":"Disconnect Organization"})]})]}),l.jsx("button",{type:"button",onClick:()=>mt("community"),className:"text-xs font-semibold text-brand-600 hover:underline relative z-10",children:we.community?"Show less":"Show more"})]})]}),l.jsxs("section",{className:"bg-white p-6 rounded-2xl shadow-sm space-y-4 order-50",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"p-3 bg-emerald-50 rounded-full text-emerald-700",children:l.jsx(_,{size:24})}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:"Legal"}),l.jsx("p",{className:"text-xs text-slate-500",children:"Privacy & consent"})]})]}),l.jsxs(A,{onClick:()=>{sessionStorage.setItem("privacyReturnView","SETTINGS"),e("PRIVACY_POLICY")},variant:"outline",className:"w-full justify-between border-slate-300 hover:bg-slate-50",children:[l.jsx("span",{children:"View Privacy & Consent"}),l.jsx(ee,{size:18})]})]}),l.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-30 border-t border-slate-200 bg-white/95 backdrop-blur px-4 py-3",children:l.jsxs("div",{className:"max-w-3xl mx-auto flex items-center gap-3",children:[l.jsx(A,{variant:"ghost",className:"flex-1",onClick:()=>{const e=n.getProfile();e.role||(e.role="GENERAL_USER"),e.language||(e.language="en"),void 0===e.active&&(e.active=!0),e.household||(e.household=[]),Se(e),Fe(null),Es(null),Ls(null),Ts(null),_s(null),Ws(null),Gs(null),_e(null),e.addressVerified?Ge("VALID"):(e.address&&e.address.length,Ge("IDLE")),We([]),Xe(-1)},disabled:Is||Ds,children:"Reset"}),l.jsxs(A,{className:"flex-1",onClick:async()=>{ve.security||ve.household?await vt():await Nt()},disabled:Is||Ds,children:[l.jsx(Q,{size:16,className:"mr-2"}),Is||Ds?"Saving...":(ve.security||ve.household,"Save")]})]})}),l.jsx("div",{className:"space-y-4 pt-4 border-t border-slate-200 order-60",children:l.jsxs(A,{onClick:()=>{n.logoutUser(),e("LOGIN")},variant:"ghost",fullWidth:!0,className:"text-red-600 hover:bg-red-50 hover:text-red-700",children:[l.jsx(ie,{className:"mr-2",size:18}),"Log Out"]})})]})})}}});
