System.register(["./index-legacy-BC6n9_Fz.js","./Button-legacy-TMRSLogx.js","./Input-legacy-CRMIvJst.js","./translations-legacy-DOH-4GSU.js","./arrow-left-legacy-BfJ5XQeX.js","./refresh-cw-legacy-DmgC11Q3.js","./loader-circle-legacy-DJmawYAc.js","./triangle-alert-legacy-ziETUq3k.js","./map-pin-legacy-BaIHUmhS.js","./sparkles-legacy-DGfgoLFM.js","./x-legacy-D0EAXDA5.js","./circle-check-big-legacy-23eE6yZJ.js","./droplets-legacy-Dh8Pruzf.js","./zap-legacy-CqMGFitJ.js"],function(e,s){"use strict";var t,a,l,r,i,n,c,o,d,x,m,h,p,b,u,g,j,f,N,v,y;return{setters:[e=>{t=e.c,a=e.r,l=e.S,r=e.j,i=e.z,n=e.A,c=e.H,o=e.B},e=>{d=e.B},e=>{x=e.T},e=>{m=e.t},e=>{h=e.A},e=>{p=e.R},e=>{b=e.L},e=>{u=e.T},e=>{g=e.M},e=>{j=e.S},e=>{f=e.X},e=>{N=e.C},e=>{v=e.D},e=>{y=e.Z}],execute:function(){
/**
       * @license lucide-react v0.556.0 - ISC
       *
       * This source code is licensed under the ISC license.
       * See the LICENSE file in the root directory of this source tree.
       */
const s=t("aperture",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m14.31 8 5.74 9.94",key:"1y6ab4"}],["path",{d:"M9.69 8h11.48",key:"1wxppr"}],["path",{d:"m7.38 12 5.74-9.94",key:"1grp0k"}],["path",{d:"M9.69 16 3.95 6.06",key:"libnyf"}],["path",{d:"M14.31 16H2.83",key:"x5fava"}],["path",{d:"m16.62 12-5.74 9.94",key:"1vwawt"}]]),w=t("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),k=t("keyboard",[["path",{d:"M10 8h.01",key:"1r9ogq"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M14 8h.01",key:"1primd"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"M18 8h.01",key:"emo2bl"}],["path",{d:"M6 8h.01",key:"x9i8wu"}],["path",{d:"M7 16h10",key:"wp8him"}],["path",{d:"M8 12h.01",key:"czm47f"}],["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}]]),S=t("triangle",[["path",{d:"M13.73 4a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"14u9p9"}]]),A="Analysis: Detected significant shingle loss on approximately 40% of the visible roof surface. Potential water intrusion points identified near the chimney. Estimated Severity: High.";e("AssessmentView",({setView:e})=>{const[t,z]=a.useState(1),[R,M]=a.useState(null),[C,E]=a.useState(1),[D,T]=a.useState(""),[I,O]=a.useState("GENERAL_USER"),[P,L]=a.useState(!1),[U,_]=a.useState(null),[G,H]=a.useState([]),[B,$]=a.useState({}),[W,F]=a.useState(!1),[V,Y]=a.useState(null),[Z,q]=a.useState(!1),X=a.useRef(null),J=a.useRef(null),[K,Q]=a.useState(!1),[ee,se]=a.useState(null),[te,ae]=a.useState(!1),[le,re]=a.useState(null),[ie,ne]=a.useState(null),ce=[{id:"STRUCTURAL",label:"Structure/Roof",icon:r.jsx(c,{size:32}),color:"blue"},{id:"FLOOD",label:"Water/Flood",icon:r.jsx(v,{size:32}),color:"cyan"},{id:"ELECTRICAL",label:"Power/Gas",icon:r.jsx(y,{size:32}),color:"yellow"},{id:"ACCESS",label:"Blocked Road",icon:r.jsx(S,{size:32}),color:"orange"}],oe="ADMIN"===I||"ORG_ADMIN"===I||"INSTITUTION_ADMIN"===I;a.useEffect(()=>()=>{xe()},[]),a.useEffect(()=>{const e=l.getProfile();O((e=>{const s=String(e||"GENERAL_USER").toUpperCase();return["ADMIN","CONTRACTOR","LOCAL_AUTHORITY","FIRST_RESPONDER","GENERAL_USER","INSTITUTION_ADMIN","STATE_ADMIN","COUNTY_ADMIN","ORG_ADMIN","MEMBER"].includes(s)?s:"GENERAL_USER"})(e.role))},[]);const de=async()=>{L(!0),_(null);try{const e=await i(75);H(e);const s=e.filter(e=>!!e.photoPath).slice(0,20);if(s.length>0){const e=await Promise.all(s.map(async e=>{try{const s=await n(e.photoPath);return[e.id,s]}catch{return[e.id,""]}})),t={};e.forEach(([e,s])=>{s&&(t[e]=s)}),$(t)}else $({})}catch(e){_((null==e?void 0:e.message)||"Unable to load assessment results.")}finally{L(!1)}};a.useEffect(()=>{oe&&de()},[oe]),a.useEffect(()=>{const e=e=>{!W||"Space"!==e.code&&"Enter"!==e.code||(e.preventDefault(),he())};return W&&window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[W]);const xe=()=>{X.current&&X.current.srcObject&&(X.current.srcObject.getTracks().forEach(e=>e.stop()),X.current.srcObject=null)},me=async()=>{Y(null),se(null);try{const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});F(!0),setTimeout(()=>{X.current&&(X.current.srcObject=e)},100)}catch(e){console.error("Camera denied",e),alert("Could not access camera. Please allow permissions.")}},he=()=>{if(X.current&&J.current){const e=X.current,s=J.current;if(e.readyState<2)return;q(!0),setTimeout(()=>q(!1),150),s.width=e.videoWidth,s.height=e.videoHeight;const t=s.getContext("2d");if(t){t.drawImage(e,0,0,s.width,s.height);const a=s.toDataURL("image/jpeg",.8);setTimeout(()=>{Y(a),xe(),F(!1),pe()},150)}}},pe=e=>{Q(!0),setTimeout(()=>{Q(!1),se(A),T(e=>e+(e?"\n\n":"")+A),E(3)},2500)};return oe?r.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col pb-safe animate-fade-in",children:[r.jsx("div",{className:"bg-white border-b border-slate-200 p-4 sticky top-0 z-20",children:r.jsxs("div",{className:"flex items-center justify-between gap-3",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("button",{onClick:()=>e("DASHBOARD"),className:"p-2 -ml-2 text-slate-500 hover:text-slate-800",children:r.jsx(h,{size:24})}),r.jsxs("div",{children:[r.jsx("h1",{className:"font-bold text-lg text-slate-900",children:m("dash.assess")}),r.jsx("p",{className:"text-xs text-slate-500",children:"Reported Assessment Results"})]})]}),r.jsxs(d,{size:"sm",variant:"outline",onClick:de,disabled:P,children:[r.jsx(p,{size:14,className:"mr-1"})," Refresh"]})]})}),r.jsxs("div",{className:"p-6 space-y-4 flex-1 overflow-y-auto",children:[P&&r.jsxs("div",{className:"bg-white border border-slate-200 rounded-xl p-6 flex items-center gap-3 text-slate-600",children:[r.jsx(b,{size:18,className:"animate-spin"}),"Loading reported assessments..."]}),!P&&U&&r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 text-red-700 text-sm font-medium",children:U}),!P&&!U&&0===G.length&&r.jsxs("div",{className:"bg-white border border-slate-200 rounded-xl p-8 text-center text-slate-600",children:[r.jsx(u,{size:24,className:"mx-auto mb-3 text-slate-400"}),"No reported assessments found yet."]}),!P&&!U&&G.map(e=>r.jsxs("div",{className:"bg-white border border-slate-200 rounded-xl p-4 shadow-sm space-y-3",children:[r.jsxs("div",{className:"flex items-start justify-between gap-3",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-bold text-slate-900",children:e.damageType}),r.jsx("p",{className:"text-xs text-slate-500",children:new Date(e.createdAt).toLocaleString()})]}),r.jsx("span",{className:"text-xs font-bold px-2.5 py-1 rounded-full uppercase "+(e.severity>=3?"bg-red-100 text-red-700":2===e.severity?"bg-yellow-100 text-yellow-700":"bg-green-100 text-green-700"),children:e.severity>=3?"Critical":2===e.severity?"Moderate":"Minor"})]}),(e.orgName||e.orgCode)&&r.jsxs("p",{className:"text-xs text-slate-600",children:[r.jsx("span",{className:"font-semibold text-slate-700",children:"Organization:"})," ",e.orgName||e.orgCode]}),r.jsxs("p",{className:"text-xs text-slate-600",children:[r.jsx("span",{className:"font-semibold text-slate-700",children:"Reporter:"})," ",e.reporterName,e.reporterPhone?` â€¢ ${e.reporterPhone}`:""]}),e.location&&r.jsxs("p",{className:"text-xs text-slate-600 flex items-center gap-1",children:[r.jsx(g,{size:12})," ",e.location]}),e.description&&r.jsx("p",{className:"text-sm text-slate-700 bg-slate-50 border border-slate-100 rounded-lg p-3",children:e.description}),B[e.id]&&r.jsx("img",{src:B[e.id],alt:"Damage evidence",className:"w-full max-h-56 object-cover rounded-lg border border-slate-200"})]},e.id))]})]}):r.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col pb-safe animate-fade-in",children:[r.jsx("div",{className:"bg-white border-b border-slate-200 p-4 sticky top-0 z-20",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("button",{onClick:()=>1===t?e("DASHBOARD"):z(1),className:"p-2 -ml-2 text-slate-500 hover:text-slate-800",children:r.jsx(h,{size:24})}),r.jsxs("div",{children:[r.jsx("h1",{className:"font-bold text-lg text-slate-900",children:m("dash.assess")}),r.jsx("p",{className:"text-xs text-slate-500",children:"Damage Reporting Assistant"})]})]})}),r.jsxs("div",{className:"p-6 space-y-6 flex-1 overflow-y-auto",children:[1===t&&r.jsxs("div",{className:"space-y-6 animate-slide-up",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("h2",{className:"text-xl font-bold text-slate-900 mb-2",children:"What was damaged?"}),r.jsx("p",{className:"text-slate-600 text-sm",children:"Select the category that best describes the issue."})]}),r.jsx("div",{className:"grid grid-cols-2 gap-4",children:ce.map(e=>r.jsxs("button",{onClick:()=>{M(e.id),z(2)},className:"p-6 rounded-2xl border-2 flex flex-col items-center gap-3 transition-all hover:scale-[1.02] active:scale-95 "+(R===e.id?`border-${e.color}-500 bg-${e.color}-50 text-${e.color}-900 shadow-md`:"border-slate-200 bg-white text-slate-600 hover:border-slate-300"),children:[r.jsx("div",{className:"p-3 rounded-full "+(R===e.id?"bg-white":"bg-slate-100"),children:e.icon}),r.jsx("span",{className:"font-bold",children:e.label})]},e.id))}),r.jsxs("div",{className:"bg-purple-50 p-4 rounded-xl border border-purple-100 flex gap-3 items-start",children:[r.jsx(j,{className:"text-purple-600 shrink-0 mt-1",size:20}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-bold text-purple-900 text-sm",children:"AI Assisted Mode"}),r.jsx("p",{className:"text-xs text-purple-700 mt-1",children:"Take a photo in the next step, and our AI will automatically assess the severity and type of damage for you."})]})]})]}),2===t&&r.jsxs("div",{className:"space-y-6 animate-slide-up",children:[r.jsxs("div",{className:"space-y-3",children:[r.jsx("label",{className:"block text-sm font-bold text-slate-900 uppercase tracking-wider",children:"1. Visual Evidence"}),r.jsxs("div",{className:"border-2 border-slate-300 rounded-xl bg-black min-h-[240px] relative overflow-hidden shadow-sm",children:[r.jsx("canvas",{ref:J,className:"hidden"}),Z&&r.jsx("div",{className:"absolute inset-0 bg-white z-50 transition-opacity duration-150 ease-out"}),W?r.jsxs("div",{className:"relative w-full h-full flex flex-col items-center justify-center bg-black group",children:[r.jsx("video",{ref:X,autoPlay:!0,playsInline:!0,muted:!0,onClick:he,className:"w-full h-full object-cover absolute inset-0 cursor-pointer"}),r.jsx("div",{className:"absolute bottom-4 left-0 right-0 flex justify-center z-10 pointer-events-none",children:r.jsx("button",{onClick:e=>{e.stopPropagation(),he()},className:"w-16 h-16 bg-white rounded-full border-4 border-slate-300 flex items-center justify-center hover:scale-105 active:scale-95 transition-transform shadow-lg pointer-events-auto",title:"Take Photo (Spacebar)",children:r.jsx("div",{className:"w-12 h-12 bg-red-600 rounded-full"})})}),r.jsx("div",{className:"absolute top-4 right-4 z-10 pointer-events-none",children:r.jsx("button",{onClick:e=>{e.stopPropagation(),xe(),F(!1)},className:"bg-black/50 text-white p-2 rounded-full backdrop-blur pointer-events-auto hover:bg-black/70",children:r.jsx(f,{size:20})})}),r.jsx("div",{className:"absolute top-4 left-4 z-10 pointer-events-none",children:r.jsxs("span",{className:"bg-black/50 text-white text-[10px] px-2 py-1 rounded backdrop-blur font-bold uppercase flex items-center gap-1",children:[r.jsx(k,{size:10,className:"hidden md:block"})," Click or Press Space"]})})]}):V?r.jsxs("div",{className:"relative w-full h-full",children:[r.jsx("img",{src:V,alt:"Damage Evidence",className:"w-full h-full object-cover"}),K&&r.jsxs("div",{className:"absolute inset-0 bg-black/60 flex flex-col items-center justify-center text-white backdrop-blur-sm",children:[r.jsx(b,{size:48,className:"animate-spin mb-3 text-brand-400"}),r.jsx("span",{className:"font-bold text-lg animate-pulse",children:"AI Analyzing Structure..."})]}),!K&&r.jsx("div",{className:"absolute bottom-4 right-4",children:r.jsxs(d,{size:"sm",onClick:()=>{Y(null),se(null),me()},className:"bg-white text-slate-900 hover:bg-slate-100 font-bold shadow-lg",children:[r.jsx(p,{size:16,className:"mr-2"})," Retake"]})})]}):r.jsxs("div",{className:"flex flex-col items-center justify-center h-60 bg-slate-100 text-slate-400",children:[r.jsx(w,{size:48,className:"mb-3 opacity-50"}),r.jsx("p",{className:"font-bold text-slate-600",children:"No Evidence Added"}),r.jsx("p",{className:"text-xs mb-4",children:"Photos help prioritize your claim"}),r.jsxs(d,{onClick:me,className:"font-bold bg-slate-800 text-white hover:bg-slate-700",children:[r.jsx(s,{size:18,className:"mr-2"})," Open Camera"]})]})]}),ee&&!K&&r.jsxs("div",{className:"bg-indigo-50 border border-indigo-200 p-4 rounded-xl animate-slide-up shadow-sm",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2 text-indigo-700 font-bold text-xs uppercase tracking-wide",children:[r.jsx(j,{size:16})," Gemini AI Assessment"]}),r.jsxs("p",{className:"text-sm text-indigo-900 leading-relaxed font-medium",children:['"',ee,'"']})]})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsx("label",{className:"block text-sm font-bold text-slate-900 uppercase tracking-wider",children:"2. Severity Level"}),r.jsx("div",{className:"flex gap-2",children:[{lvl:1,label:"Minor",color:"green"},{lvl:2,label:"Moderate",color:"yellow"},{lvl:3,label:"Severe",color:"red"}].map(e=>r.jsx("button",{onClick:()=>E(e.lvl),className:"flex-1 py-3 rounded-xl border-2 font-bold text-sm transition-all "+(C===e.lvl?`bg-${e.color}-100 border-${e.color}-500 text-${e.color}-800 shadow-sm ring-1 ring-${e.color}-500`:"bg-white border-slate-200 text-slate-400 hover:border-slate-300"),children:e.label},e.lvl))})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsx("label",{className:"block text-sm font-bold text-slate-900 uppercase tracking-wider",children:"3. Details"}),r.jsx(x,{placeholder:"Add additional notes here...",value:D,onChange:e=>T(e.target.value),className:"min-h-[100px] border-slate-300 focus:border-brand-500"})]}),r.jsx(d,{fullWidth:!0,size:"lg",className:"shadow-lg mt-4 bg-brand-600 hover:bg-brand-700 font-bold",onClick:async()=>{if(R){ae(!0),re(null);try{const s=await o({damageType:R,severity:C,description:D,imageDataUrl:V||null});if(null!=s&&s.photo_path)try{const e=await n(s.photo_path);ne(e)}catch(e){ne(null)}else ne(null);z(3)}catch(e){re((null==e?void 0:e.message)||"Unable to submit assessment.")}finally{ae(!1)}}},disabled:te,children:te?"Submitting...":"Submit Assessment"}),le&&r.jsx("p",{className:"text-xs text-red-600 font-semibold mt-2",children:le})]}),3===t&&r.jsxs("div",{className:"flex flex-col items-center justify-center text-center space-y-6 animate-fade-in pt-10",children:[r.jsx("div",{className:"w-24 h-24 bg-green-100 rounded-full flex items-center justify-center text-green-600 mb-2 shadow-inner",children:r.jsx(N,{size:48})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"Report Filed"}),r.jsx("p",{className:"text-slate-600 font-medium",children:"Your damage assessment has been logged."})]}),r.jsxs("div",{className:"bg-white p-6 rounded-xl w-full text-left border border-slate-200 shadow-sm",children:[r.jsxs("div",{className:"flex justify-between mb-3 border-b border-slate-100 pb-2",children:[r.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase",children:"Case ID"}),r.jsxs("span",{className:"text-xs font-mono font-bold text-slate-900",children:["DMG-",Math.floor(1e4*Math.random())]})]}),(ie||V)&&r.jsxs("div",{className:"mb-4",children:[r.jsx("p",{className:"text-xs font-bold text-slate-500 uppercase mb-2",children:"Photo Preview"}),r.jsx("img",{src:ie||V||"",alt:"Submitted damage",className:"w-full max-h-56 object-cover rounded-lg border border-slate-200"}),ie&&r.jsx("p",{className:"text-[10px] text-slate-500 mt-1",children:"Private link expires in 1 hour."})]}),r.jsxs("div",{className:"flex justify-between mb-3 border-b border-slate-100 pb-2",children:[r.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase",children:"Type"}),r.jsx("span",{className:"text-sm font-bold text-slate-900",children:R})]}),r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase",children:"Est. Severity"}),r.jsx("span",{className:"text-xs font-bold px-3 py-1 rounded-full uppercase "+(3===C?"bg-red-100 text-red-700":2===C?"bg-yellow-100 text-yellow-700":"bg-green-100 text-green-700"),children:3===C?"Critical":2===C?"Moderate":"Minor"})]})]}),r.jsx(d,{fullWidth:!0,variant:"outline",onClick:()=>e("DASHBOARD"),className:"border-slate-300 text-slate-700 font-bold",children:"Return to Dashboard"})]})]})]})})}}});
