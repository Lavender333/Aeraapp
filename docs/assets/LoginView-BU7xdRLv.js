import{a as t,j as s,aJ as L,aa as k,aK as z,aG as A,aI as F}from"./vendor-react-DZ0IVLBb.js";import{B as d}from"./Button-BzswROfv.js";import{I as m}from"./Input-D28zJcRZ.js";import{m as q,S as p}from"./index-D_urGLpe.js";import{t as l}from"./translations-CdcWkPcN.js";import"./vendor-CCVjAPEY.js";import"./vendor-maps-S3fC-LOA.js";import"./vendor-jspdf-Bd23t5aa.js";import"./vendor-supabase-ChvUvA8t.js";const U=({setView:f})=>{const[B,D]=t.useState(""),[r,R]=t.useState(""),[n,C]=t.useState(""),[w,a]=t.useState(""),[b,o]=t.useState(""),[u,E]=t.useState(""),[j,g]=t.useState(!1),[I,y]=t.useState(!1),[h,v]=t.useState(""),[S,N]=t.useState(!1),[x,i]=t.useState(!1);t.useEffect(()=>{const e=window.location.hash||"",c=window.location.search||"";(e.includes("type=recovery")||c.includes("type=recovery"))&&(y(!0),g(!0),o("Enter a new password to finish resetting your account."))},[]);const P=async()=>{a(""),o("");try{if(N(!0),!r||!n){a("Email and password are required.");return}console.log("Attempting login with email:",r),await p.loginWithCredentials(r,n);const e=p.getProfile();console.log("Login successful! Profile:",{id:e.id,name:e.fullName,role:e.role,onboardComplete:e.onboardComplete}),console.log("Redirecting to DASHBOARD"),f("DASHBOARD")}catch(e){console.error("Login error:",e),a((e==null?void 0:e.message)||"Login failed.")}finally{N(!1)}};return s.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col p-6 animate-fade-in pb-safe justify-center max-w-sm mx-auto w-full",children:[s.jsxs("div",{className:"text-center mb-8",children:[s.jsx("div",{className:"w-16 h-16 bg-brand-100 rounded-full flex items-center justify-center mx-auto mb-4 text-brand-700 border border-brand-200",children:s.jsx(L,{size:32})}),s.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:l("login.welcome")}),s.jsx("p",{className:"text-slate-600 font-medium",children:l("login.subtitle")})]}),s.jsxs("div",{className:"bg-white p-6 rounded-xl border border-slate-200 shadow-sm space-y-4",children:[s.jsx("h2",{className:"text-sm font-bold text-slate-700 uppercase",children:"Email Login"}),s.jsx(m,{label:"Email",placeholder:"you@example.com",value:r,onChange:e=>R(e.target.value),className:"border-slate-300",leftIcon:s.jsx(k,{size:16})}),s.jsx(m,{label:"Password",type:"password",placeholder:"Your password",value:n,onChange:e=>C(e.target.value),className:"border-slate-300",leftIcon:s.jsx(z,{size:16})}),w&&s.jsxs("div",{className:"flex items-start gap-2 text-sm text-red-600 bg-red-50 p-3 rounded-lg",children:[s.jsx(A,{size:16,className:"mt-0.5 shrink-0"}),s.jsx("span",{children:w})]}),b&&s.jsxs("div",{className:"flex items-start gap-2 text-sm text-emerald-700 bg-emerald-50 p-3 rounded-lg",children:[s.jsx(F,{size:16,className:"mt-0.5 shrink-0"}),s.jsx("span",{children:b})]}),s.jsx(d,{fullWidth:!0,size:"lg",onClick:P,className:"font-bold shadow-md",disabled:!r||!n||S,children:S?"Signing in…":l("login.btn")}),s.jsx("button",{className:"text-sm text-brand-600 font-semibold underline",onClick:()=>g(!j),children:"Forgot password?"}),j&&s.jsx("div",{className:"space-y-3 border border-slate-200 rounded-lg p-3 bg-slate-50",children:I?s.jsxs(s.Fragment,{children:[s.jsx(m,{label:"New Password",type:"password",placeholder:"New password",value:h,onChange:e=>v(e.target.value)}),s.jsx(d,{size:"sm",onClick:async()=>{a(""),o("");try{i(!0);const{error:e}=await q.auth.updateUser({password:h});if(e)throw e;o("Password updated. You can log in now."),y(!1),g(!1),v(""),window.history.replaceState({},document.title,window.location.pathname)}catch(e){a((e==null?void 0:e.message)||"Password reset failed")}finally{i(!1)}},disabled:!h,children:x?"Saving…":"Set new password"})]}):s.jsxs(s.Fragment,{children:[s.jsx(m,{label:"Email for reset",placeholder:"you@example.com",value:u,onChange:e=>E(e.target.value)}),s.jsx(d,{size:"sm",onClick:async()=>{a(""),o("");try{i(!0),await p.requestPasswordReset(u),o("Check your email to reset your password.")}catch(e){const c=String((e==null?void 0:e.message)||"").toLowerCase();c.includes("rate")&&c.includes("limit")?a("Too many reset requests. Please wait a few minutes and try again."):a((e==null?void 0:e.message)||"Reset request failed")}finally{i(!1)}},disabled:!u||x,children:x?"Sending…":"Send reset email"})]})})]}),s.jsxs("div",{className:"mt-8 text-center",children:[s.jsx("p",{className:"text-slate-600",children:l("login.no_account")}),s.jsx(d,{variant:"ghost",onClick:()=>f("REGISTRATION"),className:"text-brand-700 font-bold hover:bg-brand-50 mt-1",children:l("login.create")})]})]})};export{U as LoginView};
