System.register(["./index-legacy-BC6n9_Fz.js","./Button-legacy-TMRSLogx.js","./Input-legacy-CRMIvJst.js","./HouseholdManager-legacy-zKvgXL4u.js","./translations-legacy-DOH-4GSU.js","./user-legacy-DpSAeiIv.js","./save-legacy-BwNvDHpS.js","./x-legacy-D0EAXDA5.js"],function(e,a){"use strict";var t,s,l,n,i,o,r,d,c,m,u,h,x,g,p;return{setters:[e=>{t=e.r,s=e.S,l=e.j,n=e.x,i=e.C,o=e.G,r=e.I,d=e.k},e=>{c=e.B},e=>{m=e.I,u=e.T},e=>{h=e.H},e=>{x=e.t},e=>{g=e.U},e=>{p=e.H},null],execute:function(){const a=e=>{if(!e)return e;const a=e.replace(/[^\d]/g,""),t=a.length;return t<4?a:t<7?`(${a.slice(0,3)}) ${a.slice(3)}`:`(${a.slice(0,3)}) ${a.slice(3,6)}-${a.slice(6,10)}`};e("RegistrationView",({setView:e,mode:f="REGISTRATION"})=>{var b;const[N,j]=t.useState(1),[v,y]=t.useState({id:"",fullName:"",email:"",phone:"",address:"",householdMembers:1,household:[],petDetails:"",medicalNeeds:"",emergencyContactName:"",emergencyContactPhone:"",emergencyContactRelation:"",communityId:"",role:"GENERAL_USER",language:"en",active:!0,onboardComplete:!1,notifications:{push:!0,sms:!0,email:!0}}),[C,w]=t.useState(null),[I,S]=t.useState("IDLE"),[A,P]=t.useState(""),[D,k]=t.useState(""),[E,R]=t.useState(""),[L,H]=t.useState(""),[O,U]=t.useState(null),[T,G]=t.useState(null),[M,V]=t.useState(!1),[$,z]=t.useState(!1);t.useEffect(()=>{const e=s.getProfile();e.language&&y(a=>({...a,language:e.language})),"SETUP"===f&&e.email&&y(a=>({...a,id:e.id||a.id,fullName:e.fullName||a.fullName,email:e.email||a.email,phone:e.phone||a.phone,communityId:e.communityId||a.communityId,role:e.role||a.role}))},[]);const B=(e,a)=>{y(t=>({...t,[e]:a})),"phone"===e&&w(null),"address"===e&&(String(a||"").trim()?(S("VALID"),P("")):(S("IDLE"),P("")))},Y=e=>!!/^[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}$/.test(e)||(w("Please enter a valid mobile number (e.g., 555-123-4567)"),!1),q=async()=>{if(U(null),G(null),D&&E&&L)if(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$/.test(E))if(E===L)try{z(!0);const a=await s.registerWithCredentials(D,E,v.fullName);if(null!=a&&a.needsEmailConfirm)return V(!0),void G("Check your email to confirm your account before continuing.");G("Account created. Continue with required setup."),e("ACCOUNT_SETUP")}catch(a){U((null==a?void 0:a.message)||"Registration failed.")}finally{z(!1)}else U("Passwords do not match.");else U("Use at least 8 characters with uppercase, lowercase, and a number.");else U("Email and password required.")};return"REGISTRATION"===f?l.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col p-6 animate-fade-in pb-safe",children:[l.jsxs("div",{className:"flex items-center justify-between mb-6",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-xs font-bold text-slate-500 uppercase tracking-wide",children:"Create Account"}),l.jsx("h1",{className:"text-3xl font-black text-slate-900",children:"Email & Password"})]}),l.jsx(c,{variant:"ghost",onClick:()=>e("LOGIN"),className:"font-semibold text-brand-600",children:"Have an account? Log in"})]}),l.jsxs("div",{className:"bg-white border border-slate-200 rounded-xl p-5 shadow-sm space-y-4 max-w-lg w-full",children:[l.jsx(m,{label:"Email",placeholder:"you@example.com",value:D,onChange:e=>k(e.target.value)}),l.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[l.jsx(m,{label:"Password",type:"password",placeholder:"••••••••",value:E,onChange:e=>R(e.target.value)}),l.jsx(m,{label:"Confirm Password",type:"password",placeholder:"••••••••",value:L,onChange:e=>H(e.target.value)})]}),l.jsx(c,{size:"lg",onClick:q,className:"font-bold",disabled:$,children:$?"Creating…":"Create Account & Continue"}),l.jsx("p",{className:"text-xs text-slate-500",children:"Password must be 8+ characters and include uppercase, lowercase, and a number."}),O&&l.jsx("p",{className:"text-sm text-red-600",children:O}),T&&l.jsx("p",{className:"text-sm text-emerald-600",children:T}),M&&l.jsx(c,{variant:"ghost",onClick:()=>e("LOGIN"),className:"font-semibold text-brand-600",children:"Go to Log In"}),l.jsx("p",{className:"text-xs text-slate-500",children:"Next: complete Identity, Home, and Safety setup."})]})]}):l.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col p-6 animate-fade-in pb-safe",children:[l.jsxs("div",{className:"flex items-center justify-between mb-8 pt-4",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-xl font-bold text-slate-900",children:x("reg.title")}),l.jsx("p",{className:"text-xs text-slate-500 mt-0.5",children:"Identity → Home & Safety"}),l.jsx("div",{className:"flex gap-2 mt-1",children:["en","es","fr"].map(e=>l.jsx("button",{onClick:()=>(e=>{const a=s.getProfile();s.saveProfile({...a,language:e}),y(a=>({...a,language:e}))})(e),className:"text-[10px] font-bold uppercase px-2 py-0.5 rounded border "+(v.language===e?"bg-slate-800 text-white border-slate-800":"bg-white text-slate-500 border-slate-200"),children:e},e))})]}),l.jsx("div",{className:"flex gap-2",children:[1,2].map(e=>l.jsx("div",{className:"h-2 w-8 rounded-full transition-colors "+(e<=N?"bg-brand-600":"bg-slate-300")},e))})]}),l.jsxs("div",{className:"flex-1 flex flex-col justify-center max-w-sm mx-auto w-full",children:[1===N&&l.jsxs("div",{className:"space-y-6 animate-slide-up",children:[l.jsxs("div",{className:"text-center mb-6",children:[l.jsx("div",{className:"w-16 h-16 bg-brand-100 rounded-full flex items-center justify-center mx-auto mb-4 text-brand-700 border border-brand-200",children:l.jsx(g,{size:32})}),l.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"Identity"}),l.jsx("p",{className:"text-slate-600 font-medium",children:"Your account and contact details."})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsx(m,{label:"Full Name",placeholder:"Jane Doe",value:v.fullName,onChange:e=>B("fullName",e.target.value),className:"text-slate-900 placeholder:text-slate-400 font-medium"}),l.jsx(m,{label:"Mobile Phone",placeholder:"(555) 123-4567",type:"tel",value:v.phone,onChange:e=>B("phone",a(e.target.value)),onBlur:()=>Y(v.phone),className:"text-slate-900 placeholder:text-slate-400 font-medium "+(C?"border-red-500 bg-red-50":""),error:C||void 0}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1.5",children:"Home Address"}),l.jsx("input",{placeholder:"123 Main St, City, State, Zip",value:v.address,onChange:e=>B("address",e.target.value),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 outline-none transition-all font-medium "+("VALID"===I?"border-green-500 bg-green-50 focus:ring-green-500":"INVALID"===I?"border-red-500 bg-red-50 focus:ring-red-500":"border-slate-300 focus:ring-brand-500 focus:border-brand-500")}),"INVALID"===I&&l.jsx("p",{className:"text-xs text-red-600 font-bold mt-1",children:A||"Address is required"})]}),l.jsxs("div",{className:"border-t border-slate-200 pt-4",children:[l.jsx("p",{className:"text-xs font-bold text-slate-500 uppercase mb-2",children:"Emergency Contact"}),l.jsxs("div",{className:"space-y-3",children:[l.jsx(m,{placeholder:"Contact Name",value:v.emergencyContactName,onChange:e=>B("emergencyContactName",e.target.value),className:"text-slate-900 placeholder:text-slate-400 font-medium"}),l.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[l.jsx(m,{placeholder:"Mobile Phone",type:"tel",value:v.emergencyContactPhone,onChange:e=>B("emergencyContactPhone",a(e.target.value)),className:"text-slate-900 placeholder:text-slate-400 font-medium"}),l.jsx(m,{placeholder:"Relationship",value:v.emergencyContactRelation,onChange:e=>B("emergencyContactRelation",e.target.value),className:"text-slate-900 placeholder:text-slate-400 font-medium"})]})]})]}),l.jsxs("div",{className:"border-t border-slate-200 pt-4",children:[l.jsx(m,{label:"Organization Code (Optional)",placeholder:"e.g. CH-1001",value:v.communityId,onChange:e=>B("communityId",e.target.value.toUpperCase()),className:"text-slate-900 placeholder:text-slate-400 font-medium"}),l.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Optional during signup. You can join or disconnect anytime in Settings."})]})]}),l.jsxs("div",{className:"pt-4 text-center",children:[l.jsx("p",{className:"text-sm text-slate-500 mb-2",children:"Already have an account?"}),l.jsx(c,{variant:"ghost",onClick:()=>e("LOGIN"),className:"text-brand-600 font-bold",children:"Log In Here"})]}),l.jsx(c,{fullWidth:!0,size:"lg",onClick:()=>{if(1===N){var e;if(!Y(v.phone))return;if(null===(e=v.address)||void 0===e||!e.trim())return S("INVALID"),void P("Address is required.")}j(e=>e+1)},disabled:!v.fullName||!v.phone||!(null!==(b=v.address)&&void 0!==b&&b.trim()),className:"mt-6 font-bold shadow-md",children:"Continue to Home Setup"})]}),2===N&&l.jsxs("div",{className:"space-y-6 animate-slide-up",children:[l.jsxs("div",{className:"text-center mb-6",children:[l.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4 text-red-600 border border-red-200",children:l.jsx(p,{size:32})}),l.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"Home & Safety Setup"}),l.jsx("p",{className:"text-slate-600 font-medium",children:"Add who lives in your home with DOB (MM/DD/YYYY) and required mobility/medical flags."})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Who lives in your home"}),l.jsx(h,{members:v.household,onChange:e=>B("household",e)})]}),l.jsx(m,{label:"Pets",placeholder:"e.g. 2 Dogs",value:v.petDetails,onChange:e=>B("petDetails",e.target.value)}),l.jsx(u,{label:"Medical Needs / Disabilities",placeholder:"E.g. Insulin dependent, wheelchair user, oxygen tank...",value:v.medicalNeeds,onChange:e=>B("medicalNeeds",e.target.value),className:"min-h-[120px]"}),l.jsx("p",{className:"text-xs text-slate-500 italic",children:"This information is only shared with responders during an emergency."})]}),l.jsxs("div",{className:"flex gap-3 mt-6",children:[l.jsx(c,{variant:"ghost",onClick:()=>j(1),children:x("btn.back")}),l.jsx(c,{fullWidth:!0,onClick:async()=>{const a={...v,onboardComplete:!0},t=n(a.household||[]);if(t.ok)try{var l;const t=s.getProfile(),{data:n}=await i.auth.getUser(),c=(null==n||null===(l=n.user)||void 0===l?void 0:l.id)||(a.id&&"guest"!==a.id?a.id:t.id);await o({id:c,email:a.email,phone:a.phone,fullName:a.fullName,role:a.role,communityId:a.communityId}),await r(a.household||[]);const m=await d();s.saveProfile({...a,id:c,householdId:m.householdId,householdName:m.householdName,householdCode:m.householdCode,householdRole:m.householdRole}),e("DASHBOARD")}catch(m){var c;const t=s.getProfile(),{data:l}=await i.auth.getUser(),n=(null==l||null===(c=l.user)||void 0===c?void 0:c.id)||(a.id&&"guest"!==a.id?a.id:t.id);s.saveProfile({...a,id:n}),U("Profile saved locally. Sync will resume when available."),e("DASHBOARD")}else U(t.error)},className:"font-bold shadow-md",children:x("reg.complete")})]}),O&&l.jsx("p",{className:"text-xs text-red-600 font-semibold mt-1",children:O})]})]})]})})}}});
