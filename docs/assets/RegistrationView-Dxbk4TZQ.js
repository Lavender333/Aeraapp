import{r as l,S as d,j as t,z as _,E as M,J as K,K as Q,k as X}from"./index-CJzEU5Yr.js";import{B as h}from"./Button-CnRUMJhP.js";import{I as i,T as ee}from"./Input-BlISMA55.js";import{H as te}from"./HouseholdManager-ClllYexm.js";import{t as S}from"./translations-Btzq2RVP.js";import{U as se}from"./user-jnEtzzBn.js";import{H as ae}from"./save-CJzrS06H.js";import"./x-pd8-DY5F.js";const T=r=>{if(!r)return r;const o=r.replace(/[^\d]/g,""),c=o.length;return c<4?o:c<7?"(".concat(o.slice(0,3),") ").concat(o.slice(3)):"(".concat(o.slice(0,3),") ").concat(o.slice(3,6),"-").concat(o.slice(6,10))},ue=({setView:r,mode:o="REGISTRATION"})=>{var O;const[c,A]=l.useState(1),[a,g]=l.useState({id:"",fullName:"",email:"",phone:"",address:"",householdMembers:1,household:[],petDetails:"",medicalNeeds:"",emergencyContactName:"",emergencyContactPhone:"",emergencyContactRelation:"",communityId:"",role:"GENERAL_USER",language:"en",active:!0,onboardComplete:!1,notifications:{push:!0,sms:!0,email:!0}}),[E,R]=l.useState(null),[j,v]=l.useState("IDLE"),[z,y]=l.useState(""),[C,F]=l.useState(""),[f,G]=l.useState(""),[w,B]=l.useState(""),[b,m]=l.useState(null),[D,I]=l.useState(null),[Y,q]=l.useState(!1),[k,H]=l.useState(!1);l.useEffect(()=>{const e=d.getProfile();e.language&&g(s=>({...s,language:e.language})),o==="SETUP"&&e.email&&g(s=>({...s,id:e.id||s.id,fullName:e.fullName||s.fullName,email:e.email||s.email,phone:e.phone||s.phone,communityId:e.communityId||s.communityId,role:e.role||s.role}))},[]);const V=e=>{const s=d.getProfile();d.saveProfile({...s,language:e}),g(u=>({...u,language:e}))},n=(e,s)=>{g(u=>({...u,[e]:s})),e==="phone"&&R(null),e==="address"&&(String(s||"").trim()?(v("VALID"),y("")):(v("IDLE"),y("")))},L=e=>/^[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}$/.test(e)?!0:(R("Please enter a valid mobile number (e.g., 555-123-4567)"),!1),W=()=>{var e;if(c===1){if(!L(a.phone))return;if(!((e=a.address)!=null&&e.trim())){v("INVALID"),y("Address is required.");return}}A(s=>s+1)},J=async()=>{if(m(null),I(null),!C||!f||!w){m("Email and password required.");return}if(!/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$/.test(f)){m("Use at least 8 characters with uppercase, lowercase, and a number.");return}if(f!==w){m("Passwords do not match.");return}try{H(!0);const s=await d.registerWithCredentials(C,f,a.fullName);if(s!=null&&s.needsEmailConfirm){q(!0),I("Check your email to confirm your account before continuing.");return}I("Account created. Continue with required setup."),r("ACCOUNT_SETUP")}catch(s){m((s==null?void 0:s.message)||"Registration failed.")}finally{H(!1)}},Z=async()=>{var u,U;const e={...a,onboardComplete:!0},s=_(e.household||[]);if(!s.ok){m(s.error);return}try{const $=d.getProfile(),{data:p}=await M.auth.getUser(),P=((u=p==null?void 0:p.user)==null?void 0:u.id)||null||(e.id&&e.id!=="guest"?e.id:$.id);await K({id:P,email:e.email,phone:e.phone,fullName:e.fullName,role:e.role,communityId:e.communityId}),await Q(e.household||[]);const x=await X();d.saveProfile({...e,id:P,householdId:x.householdId,householdName:x.householdName,householdCode:x.householdCode,householdRole:x.householdRole}),r("DASHBOARD")}catch($){const p=d.getProfile(),{data:N}=await M.auth.getUser(),x=((U=N==null?void 0:N.user)==null?void 0:U.id)||null||(e.id&&e.id!=="guest"?e.id:p.id);d.saveProfile({...e,id:x}),m("Profile saved locally. Sync will resume when available."),r("DASHBOARD")}};return o==="REGISTRATION"?t.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col p-6 animate-fade-in pb-safe",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs font-bold text-slate-500 uppercase tracking-wide",children:"Create Account"}),t.jsx("h1",{className:"text-3xl font-black text-slate-900",children:"Email & Password"})]}),t.jsx(h,{variant:"ghost",onClick:()=>r("LOGIN"),className:"font-semibold text-brand-600",children:"Have an account? Log in"})]}),t.jsxs("div",{className:"bg-white border border-slate-200 rounded-xl p-5 shadow-sm space-y-4 max-w-lg w-full",children:[t.jsx(i,{label:"Email",placeholder:"you@example.com",value:C,onChange:e=>F(e.target.value)}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsx(i,{label:"Password",type:"password",placeholder:"••••••••",value:f,onChange:e=>G(e.target.value)}),t.jsx(i,{label:"Confirm Password",type:"password",placeholder:"••••••••",value:w,onChange:e=>B(e.target.value)})]}),t.jsx(h,{size:"lg",onClick:J,className:"font-bold",disabled:k,children:k?"Creating…":"Create Account & Continue"}),t.jsx("p",{className:"text-xs text-slate-500",children:"Password must be 8+ characters and include uppercase, lowercase, and a number."}),b&&t.jsx("p",{className:"text-sm text-red-600",children:b}),D&&t.jsx("p",{className:"text-sm text-emerald-600",children:D}),Y&&t.jsx(h,{variant:"ghost",onClick:()=>r("LOGIN"),className:"font-semibold text-brand-600",children:"Go to Log In"}),t.jsx("p",{className:"text-xs text-slate-500",children:"Next: complete Identity, Home, and Safety setup."})]})]}):t.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col p-6 animate-fade-in pb-safe",children:[t.jsxs("div",{className:"flex items-center justify-between mb-8 pt-4",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-xl font-bold text-slate-900",children:S("reg.title")}),t.jsx("p",{className:"text-xs text-slate-500 mt-0.5",children:"Identity → Home & Safety"}),t.jsx("div",{className:"flex gap-2 mt-1",children:["en","es","fr"].map(e=>t.jsx("button",{onClick:()=>V(e),className:"text-[10px] font-bold uppercase px-2 py-0.5 rounded border ".concat(a.language===e?"bg-slate-800 text-white border-slate-800":"bg-white text-slate-500 border-slate-200"),children:e},e))})]}),t.jsx("div",{className:"flex gap-2",children:[1,2].map(e=>t.jsx("div",{className:"h-2 w-8 rounded-full transition-colors ".concat(e<=c?"bg-brand-600":"bg-slate-300")},e))})]}),t.jsxs("div",{className:"flex-1 flex flex-col justify-center max-w-sm mx-auto w-full",children:[c===1&&t.jsxs("div",{className:"space-y-6 animate-slide-up",children:[t.jsxs("div",{className:"text-center mb-6",children:[t.jsx("div",{className:"w-16 h-16 bg-brand-100 rounded-full flex items-center justify-center mx-auto mb-4 text-brand-700 border border-brand-200",children:t.jsx(se,{size:32})}),t.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"Identity"}),t.jsx("p",{className:"text-slate-600 font-medium",children:"Your account and contact details."})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsx(i,{label:"Full Name",placeholder:"Jane Doe",value:a.fullName,onChange:e=>n("fullName",e.target.value),className:"text-slate-900 placeholder:text-slate-400 font-medium"}),t.jsx(i,{label:"Mobile Phone",placeholder:"(555) 123-4567",type:"tel",value:a.phone,onChange:e=>n("phone",T(e.target.value)),onBlur:()=>L(a.phone),className:"text-slate-900 placeholder:text-slate-400 font-medium ".concat(E?"border-red-500 bg-red-50":""),error:E||void 0}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1.5",children:"Home Address"}),t.jsx("input",{placeholder:"123 Main St, City, State, Zip",value:a.address,onChange:e=>n("address",e.target.value),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 outline-none transition-all font-medium ".concat(j==="VALID"?"border-green-500 bg-green-50 focus:ring-green-500":j==="INVALID"?"border-red-500 bg-red-50 focus:ring-red-500":"border-slate-300 focus:ring-brand-500 focus:border-brand-500")}),j==="INVALID"&&t.jsx("p",{className:"text-xs text-red-600 font-bold mt-1",children:z||"Address is required"})]}),t.jsxs("div",{className:"border-t border-slate-200 pt-4",children:[t.jsx("p",{className:"text-xs font-bold text-slate-500 uppercase mb-2",children:"Emergency Contact"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx(i,{placeholder:"Contact Name",value:a.emergencyContactName,onChange:e=>n("emergencyContactName",e.target.value),className:"text-slate-900 placeholder:text-slate-400 font-medium"}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsx(i,{placeholder:"Mobile Phone",type:"tel",value:a.emergencyContactPhone,onChange:e=>n("emergencyContactPhone",T(e.target.value)),className:"text-slate-900 placeholder:text-slate-400 font-medium"}),t.jsx(i,{placeholder:"Relationship",value:a.emergencyContactRelation,onChange:e=>n("emergencyContactRelation",e.target.value),className:"text-slate-900 placeholder:text-slate-400 font-medium"})]})]})]}),t.jsxs("div",{className:"border-t border-slate-200 pt-4",children:[t.jsx(i,{label:"Organization Code (Optional)",placeholder:"e.g. CH-1001",value:a.communityId,onChange:e=>n("communityId",e.target.value.toUpperCase()),className:"text-slate-900 placeholder:text-slate-400 font-medium"}),t.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Optional during signup. You can join or disconnect anytime in Settings."})]})]}),t.jsxs("div",{className:"pt-4 text-center",children:[t.jsx("p",{className:"text-sm text-slate-500 mb-2",children:"Already have an account?"}),t.jsx(h,{variant:"ghost",onClick:()=>r("LOGIN"),className:"text-brand-600 font-bold",children:"Log In Here"})]}),t.jsx(h,{fullWidth:!0,size:"lg",onClick:W,disabled:!a.fullName||!a.phone||!((O=a.address)!=null&&O.trim()),className:"mt-6 font-bold shadow-md",children:"Continue to Home Setup"})]}),c===2&&t.jsxs("div",{className:"space-y-6 animate-slide-up",children:[t.jsxs("div",{className:"text-center mb-6",children:[t.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4 text-red-600 border border-red-200",children:t.jsx(ae,{size:32})}),t.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"Home & Safety Setup"}),t.jsx("p",{className:"text-slate-600 font-medium",children:"Add who lives in your home with DOB (MM/DD/YYYY) and required mobility/medical flags."})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Who lives in your home"}),t.jsx(te,{members:a.household,onChange:e=>n("household",e)})]}),t.jsx(i,{label:"Pets",placeholder:"e.g. 2 Dogs",value:a.petDetails,onChange:e=>n("petDetails",e.target.value)}),t.jsx(ee,{label:"Medical Needs / Disabilities",placeholder:"E.g. Insulin dependent, wheelchair user, oxygen tank...",value:a.medicalNeeds,onChange:e=>n("medicalNeeds",e.target.value),className:"min-h-[120px]"}),t.jsx("p",{className:"text-xs text-slate-500 italic",children:"This information is only shared with responders during an emergency."})]}),t.jsxs("div",{className:"flex gap-3 mt-6",children:[t.jsx(h,{variant:"ghost",onClick:()=>A(1),children:S("btn.back")}),t.jsx(h,{fullWidth:!0,onClick:Z,className:"font-bold shadow-md",children:S("reg.complete")})]}),b&&t.jsx("p",{className:"text-xs text-red-600 font-semibold mt-1",children:b})]})]})]})};export{ue as RegistrationView};
