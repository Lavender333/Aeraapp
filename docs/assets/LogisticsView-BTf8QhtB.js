import{r as l,S as r,j as e}from"./index-CJzEU5Yr.js";import{t as m}from"./translations-Btzq2RVP.js";import{g as y}from"./inventoryStatus-BGlXoNrp.js";import{A as p}from"./arrow-left-BvMvYESN.js";import{T as k}from"./truck-DXMNKKFf.js";import{M as E}from"./map-pin-CUrl_rxU.js";import{N as O}from"./navigation-bRHTcuFG.js";const a={water:42,food:35,blankets:28,medicalKits:18},L=({setView:x})=>{const[n,g]=l.useState(null),[h,i]=l.useState({water:0,food:0,blankets:0,medicalKits:0}),[u,d]=l.useState(0);l.useEffect(()=>{const s=r.getProfile().communityId||"CH-9921",c=r.getOrganization(s);g(c),i(r.getOrgInventory(s)),d(r.getOrgMembers(s).length),r.fetchOrgInventoryRemote(s).then(({inventory:b})=>{i(b)}),r.fetchOrgMembersRemote(s).then(({members:b})=>{d(b.length)});const o=()=>{i(r.getOrgInventory(s)),d(r.getOrgMembers(s).length)};return window.addEventListener("inventory-update",o),window.addEventListener("storage",o),()=>{window.removeEventListener("inventory-update",o),window.removeEventListener("storage",o)}},[]);const f=()=>{if(n!=null&&n.address){const t="https://www.google.com/maps/dir/?api=1&destination=".concat(encodeURIComponent(n.address));window.open(t,"_blank")}},j=u||(n==null?void 0:n.registeredPopulation)||0,v=y(h,j),N=a.water+a.food+a.blankets+a.medicalKits,w=[{label:"Water",key:"water",unit:"cases",count:a.water},{label:"Food",key:"food",unit:"boxes",count:a.food},{label:"Blankets",key:"blankets",unit:"units",count:a.blankets},{label:"Med Kits",key:"medicalKits",unit:"kits",count:a.medicalKits}].map(t=>({...t,percentage:Number((t.count/N*100).toFixed(1))}));return e.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col pb-safe animate-fade-in",children:[e.jsx("div",{className:"bg-white border-b border-slate-200 p-4 sticky top-0 z-20",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>x("DASHBOARD"),className:"p-2 -ml-2 text-slate-500 hover:text-slate-800",children:e.jsx(p,{size:24})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-bold text-lg text-slate-900",children:m("logistics.title")}),e.jsx("p",{className:"text-xs text-slate-500",children:m("logistics.subtitle")})]})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"bg-brand-50 border border-brand-100 p-4 rounded-xl shadow-sm",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-3 bg-brand-100 rounded-lg text-brand-700",children:e.jsx(k,{size:24})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-brand-900",children:m("logistics.depot")}),n?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-lg font-bold text-brand-800 leading-tight mt-1",children:n.name}),e.jsxs("div",{className:"flex items-start gap-1.5 mt-2 text-brand-700",children:[e.jsx(E,{size:16,className:"mt-0.5 shrink-0"}),e.jsx("p",{className:"text-sm font-medium",children:n.address})]}),e.jsxs("button",{onClick:f,className:"mt-3 flex items-center gap-1 text-xs font-bold text-brand-700 bg-white/50 px-3 py-1.5 rounded border border-brand-200 hover:bg-white transition-colors",children:[e.jsx(O,{size:12})," Get Directions"]})]}):e.jsx("p",{className:"text-sm text-brand-700 animate-pulse mt-1",children:"Locating nearest hub..."}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-brand-200/50",children:[e.jsx("p",{className:"text-[10px] uppercase font-bold text-brand-600 mb-2",children:"Current Stock Levels"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{label:"Water",key:"water",unit:"cases"},{label:"Food",key:"food",unit:"boxes"},{label:"Blankets",key:"blankets",unit:"units"},{label:"Med Kits",key:"medicalKits",unit:"kits"}].map(t=>{const s=v[t.key].level,c=s==="HIGH"?"text-green-700 border-green-200 bg-green-50":s==="MEDIUM"?"text-amber-700 border-amber-200 bg-amber-50":s==="LOW"?"text-red-700 border-red-200 bg-red-50":"text-slate-500 border-slate-200 bg-white";return e.jsxs("div",{className:"text-xs px-3 py-2 rounded border font-bold shadow-sm ".concat(c," flex justify-between"),children:[e.jsx("span",{children:t.label}),e.jsx("span",{children:s==="UNKNOWN"?"N/A":s})]},t.label)})})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-brand-200/50 space-y-2",children:[e.jsx("p",{className:"text-[10px] uppercase font-bold text-brand-600",children:"Nearest Resource Depot"}),w.map(t=>e.jsxs("div",{className:"rounded-lg border border-brand-100 bg-white p-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs font-semibold text-slate-700 mb-1",children:[e.jsxs("span",{children:[t.label," (",t.count," ",t.unit,")"]}),e.jsxs("span",{children:[t.percentage.toFixed(1),"%"]})]}),e.jsx("div",{className:"h-2 rounded bg-brand-100 overflow-hidden",children:e.jsx("div",{className:"h-full bg-brand-600",style:{width:"".concat(t.percentage,"%")}})})]},t.key))]})]})]})}),e.jsx("div",{className:"pt-2",children:e.jsxs("button",{onClick:()=>x("DASHBOARD"),className:"w-full inline-flex items-center justify-center gap-2 rounded-xl border border-slate-300 bg-white px-4 py-3 text-sm font-semibold text-slate-700 hover:bg-slate-100 transition-colors",children:[e.jsx(p,{size:16})," Back to Dashboard"]})})]})]})};export{L as LogisticsView};
